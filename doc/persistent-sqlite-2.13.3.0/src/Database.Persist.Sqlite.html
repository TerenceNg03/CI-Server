<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE PatternGuards #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Strictly, this could go as low as GHC 8.6.1, which is when DerivingVia was</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- introduced - this base version requires 8.6.5+</span><span class="hs-cpp">
#if MIN_VERSION_base(4,12,0)
</span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- | A sqlite backend for persistent.</span><span>
</span><span id="line-23"></span><span class="hs-comment">--</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- Note: If you prepend @WAL=off @ to your connection string, it will disable</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- the write-ahead log. This functionality is now deprecated in favour of using SqliteConnectionInfo.</span><span>
</span><span id="line-26"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.Persist.Sqlite</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#withSqlitePool"><span class="hs-identifier">withSqlitePool</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#withSqlitePoolInfo"><span class="hs-identifier">withSqlitePoolInfo</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#withSqliteConn"><span class="hs-identifier">withSqliteConn</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#withSqliteConnInfo"><span class="hs-identifier">withSqliteConnInfo</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#createSqlitePool"><span class="hs-identifier">createSqlitePool</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#createSqlitePoolFromInfo"><span class="hs-identifier">createSqlitePoolFromInfo</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#createSqlitePoolWithConfig"><span class="hs-identifier">createSqlitePoolWithConfig</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><span class="hs-identifier">Database.Persist.Sql</span></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConf"><span class="hs-identifier">SqliteConf</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#mkSqliteConnectionInfo"><span class="hs-identifier">mkSqliteConnectionInfo</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#sqlConnectionStr"><span class="hs-identifier">sqlConnectionStr</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#walEnabled"><span class="hs-identifier">walEnabled</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#fkEnabled"><span class="hs-identifier">fkEnabled</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#extraPragmas"><span class="hs-identifier">extraPragmas</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#runSqlite"><span class="hs-identifier">runSqlite</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#runSqliteInfo"><span class="hs-identifier">runSqliteInfo</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#wrapConnection"><span class="hs-identifier">wrapConnection</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#wrapConnectionInfo"><span class="hs-identifier">wrapConnectionInfo</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#mockMigration"><span class="hs-identifier">mockMigration</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#retryOnBusy"><span class="hs-identifier">retryOnBusy</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#waitForDatabase"><span class="hs-identifier">waitForDatabase</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#ForeignKeyViolation"><span class="hs-identifier">ForeignKeyViolation</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#checkForeignKeys"><span class="hs-identifier">checkForeignKeys</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier">RawSqlite</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#openRawSqliteConn"><span class="hs-identifier">openRawSqliteConn</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#persistentBackend"><span class="hs-identifier">persistentBackend</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#rawSqliteConnection"><span class="hs-identifier">rawSqliteConnection</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#withRawSqliteConnInfo"><span class="hs-identifier">withRawSqliteConnInfo</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#createRawSqlitePoolFromInfo"><span class="hs-identifier">createRawSqlitePoolFromInfo</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#createRawSqlitePoolFromInfo_"><span class="hs-identifier">createRawSqlitePoolFromInfo_</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#withRawSqlitePoolInfo"><span class="hs-identifier">withRawSqlitePoolInfo</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#withRawSqlitePoolInfo_"><span class="hs-identifier">withRawSqlitePoolInfo_</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">threadDelay</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Unlift</span></span><span>
</span><span id="line-66"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadUnliftIO</span></span><span>
</span><span id="line-68"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">askRunInIO</span></span><span>
</span><span id="line-69"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unliftIO</span></span><span>
</span><span id="line-70"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withRunInIO</span></span><span>
</span><span id="line-71"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withUnliftIO</span></span><span>
</span><span id="line-72"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Logger</span></span><span>
</span><span id="line-74"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadLoggerIO</span></span><span>
</span><span id="line-75"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">NoLoggingT</span></span><span>
</span><span id="line-76"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">askLoggerIO</span></span><span>
</span><span id="line-77"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">logWarn</span></span><span>
</span><span id="line-78"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runLoggingT</span></span><span>
</span><span id="line-79"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runNoLoggingT</span></span><span>
</span><span id="line-80"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadReader</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runReaderT</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Resource</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadResource</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if !MIN_VERSION_base(4,12,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Reader</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">withReaderT</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Writer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runWriterT</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Acquire</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Acquire</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkAcquire</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">with</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span class="hs-cpp">
#if MIN_VERSION_aeson(2,0,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.KeyMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KeyMap</span></span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">modifyFailure</span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Conduit</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Conduit.Combinators</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Conduit.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CL</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newIORef</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Pool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Pool</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TIO</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Lens.Micro.TH</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">makeLenses</span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO.Resource</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ResourceT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runResourceT</span></span><span class="hs-special">)</span><span class="hs-cpp">

#if MIN_VERSION_base(4,12,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.Persist.Compatible</span></span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.Persist.Sql</span></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Database.Persist.Sql.Util</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Util</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.Persist.SqlBackend</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Database.Sqlite.html"><span class="hs-identifier">Database.Sqlite</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">-- | Create a pool of SQLite connections.</span><span>
</span><span id="line-118"></span><span class="hs-comment">--</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- Note that this should not be used with the @:memory:@ connection string, as</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- the pool will regularly remove connections, destroying your database.</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- Instead, use 'withSqliteConn'.</span><span>
</span><span id="line-122"></span><span id="local-6989586621679143993"><span class="annot"><a href="Database.Persist.Sqlite.html#createSqlitePool"><span class="hs-identifier hs-type">createSqlitePool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679143993"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679143993"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679143993"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-124"></span><span id="createSqlitePool"><span class="annot"><span class="annottext">createSqlitePool :: forall (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m) =&gt;
Text -&gt; Int -&gt; m (Pool SqlBackend)
</span><a href="Database.Persist.Sqlite.html#createSqlitePool"><span class="hs-identifier hs-var hs-var">createSqlitePool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Int -&gt; m (Pool SqlBackend)
forall (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m) =&gt;
SqliteConnectionInfo -&gt; Int -&gt; m (Pool SqlBackend)
</span><a href="Database.Persist.Sqlite.html#createSqlitePoolFromInfo"><span class="hs-identifier hs-var">createSqlitePoolFromInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(SqliteConnectionInfo -&gt; Int -&gt; m (Pool SqlBackend))
-&gt; (Text -&gt; SqliteConnectionInfo)
-&gt; Text
-&gt; Int
-&gt; m (Pool SqlBackend)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#conStringToInfo"><span class="hs-identifier hs-var">conStringToInfo</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | Create a pool of SQLite connections.</span><span>
</span><span id="line-127"></span><span class="hs-comment">--</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- Note that this should not be used with the @:memory:@ connection string, as</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- the pool will regularly remove connections, destroying your database.</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- Instead, use 'withSqliteConn'.</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- @since 2.6.2</span><span>
</span><span id="line-133"></span><span id="local-6989586621679143998"><span class="annot"><a href="Database.Persist.Sqlite.html#createSqlitePoolFromInfo"><span class="hs-identifier hs-type">createSqlitePoolFromInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679143998"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679143998"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>                         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679143998"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-135"></span><span id="createSqlitePoolFromInfo"><span class="annot"><span class="annottext">createSqlitePoolFromInfo :: forall (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m) =&gt;
SqliteConnectionInfo -&gt; Int -&gt; m (Pool SqlBackend)
</span><a href="Database.Persist.Sqlite.html#createSqlitePoolFromInfo"><span class="hs-identifier hs-var hs-var">createSqlitePoolFromInfo</span></a></span></span><span> </span><span id="local-6989586621679144902"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679144902"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LogFunc -&gt; IO SqlBackend) -&gt; Int -&gt; m (Pool SqlBackend)
forall backend (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m,
 BackendCompatible SqlBackend backend) =&gt;
(LogFunc -&gt; IO backend) -&gt; Int -&gt; m (Pool backend)
</span><span class="hs-identifier hs-var">createSqlPool</span></span><span> </span><span class="annot"><span class="annottext">((LogFunc -&gt; IO SqlBackend) -&gt; Int -&gt; m (Pool SqlBackend))
-&gt; (LogFunc -&gt; IO SqlBackend) -&gt; Int -&gt; m (Pool SqlBackend)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; Connection -&gt; SqlBackend)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO SqlBackend
forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var">openWith</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; SqlBackend
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679144902"><span class="hs-identifier hs-var">connInfo</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | Create a pool of SQLite connections.</span><span>
</span><span id="line-138"></span><span class="hs-comment">--</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- @since 2.13.4.0</span><span>
</span><span id="line-140"></span><span id="local-6989586621679144014"><span class="annot"><a href="Database.Persist.Sqlite.html#createSqlitePoolWithConfig"><span class="hs-identifier hs-type">createSqlitePoolWithConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144014"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144014"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>                           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ connection string</span></span><span>
</span><span id="line-142"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConnectionPoolConfig</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144014"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-143"></span><span id="createSqlitePoolWithConfig"><span class="annot"><span class="annottext">createSqlitePoolWithConfig :: forall (m :: * -&gt; *).
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
Text -&gt; ConnectionPoolConfig -&gt; m (Pool SqlBackend)
</span><a href="Database.Persist.Sqlite.html#createSqlitePoolWithConfig"><span class="hs-identifier hs-var hs-var">createSqlitePoolWithConfig</span></a></span></span><span> </span><span id="local-6989586621679144911"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679144911"><span class="hs-identifier hs-var">connString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">(LogFunc -&gt; IO SqlBackend)
-&gt; ConnectionPoolConfig -&gt; m (Pool SqlBackend)
forall (m :: * -&gt; *) backend.
(MonadLoggerIO m, MonadUnliftIO m,
 BackendCompatible SqlBackend backend) =&gt;
(LogFunc -&gt; IO backend) -&gt; ConnectionPoolConfig -&gt; m (Pool backend)
</span><span class="hs-identifier hs-var">createSqlPoolWithConfig</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SqlBackend -&gt; Connection -&gt; SqlBackend)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO SqlBackend
forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var">openWith</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; SqlBackend
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#conStringToInfo"><span class="hs-identifier hs-var">conStringToInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679144911"><span class="hs-identifier hs-var">connString</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | Run the given action with a connection pool.</span><span>
</span><span id="line-147"></span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- Like 'createSqlitePool', this should not be used with @:memory:@.</span><span>
</span><span id="line-149"></span><span id="local-6989586621679144019"><span id="local-6989586621679144020"><span class="annot"><a href="Database.Persist.Sqlite.html#withSqlitePool"><span class="hs-identifier hs-type">withSqlitePool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144019"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144019"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-151"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ number of connections to open</span></span><span>
</span><span id="line-152"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144019"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144020"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144019"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144020"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-153"></span><span id="withSqlitePool"><span class="annot"><span class="annottext">withSqlitePool :: forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
Text -&gt; Int -&gt; (Pool SqlBackend -&gt; m a) -&gt; m a
</span><a href="Database.Persist.Sqlite.html#withSqlitePool"><span class="hs-identifier hs-var hs-var">withSqlitePool</span></a></span></span><span> </span><span id="local-6989586621679144918"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679144918"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LogFunc -&gt; IO SqlBackend)
-&gt; Int -&gt; (Pool SqlBackend -&gt; m a) -&gt; m a
forall backend (m :: * -&gt; *) a.
(MonadLoggerIO m, MonadUnliftIO m,
 BackendCompatible SqlBackend backend) =&gt;
(LogFunc -&gt; IO backend) -&gt; Int -&gt; (Pool backend -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">withSqlPool</span></span><span> </span><span class="annot"><span class="annottext">((LogFunc -&gt; IO SqlBackend)
 -&gt; Int -&gt; (Pool SqlBackend -&gt; m a) -&gt; m a)
-&gt; (SqliteConnectionInfo -&gt; LogFunc -&gt; IO SqlBackend)
-&gt; SqliteConnectionInfo
-&gt; Int
-&gt; (Pool SqlBackend -&gt; m a)
-&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; Connection -&gt; SqlBackend)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO SqlBackend
forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var">openWith</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; SqlBackend
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(SqliteConnectionInfo -&gt; Int -&gt; (Pool SqlBackend -&gt; m a) -&gt; m a)
-&gt; SqliteConnectionInfo -&gt; Int -&gt; (Pool SqlBackend -&gt; m a) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#conStringToInfo"><span class="hs-identifier hs-var">conStringToInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679144918"><span class="hs-identifier hs-var">connInfo</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">-- | Run the given action with a connection pool.</span><span>
</span><span id="line-156"></span><span class="hs-comment">--</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- Like 'createSqlitePool', this should not be used with @:memory:@.</span><span>
</span><span id="line-158"></span><span class="hs-comment">--</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- @since 2.6.2</span><span>
</span><span id="line-160"></span><span id="local-6989586621679144026"><span id="local-6989586621679144027"><span class="annot"><a href="Database.Persist.Sqlite.html#withSqlitePoolInfo"><span class="hs-identifier hs-type">withSqlitePoolInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144026"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144026"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-162"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ number of connections to open</span></span><span>
</span><span id="line-163"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144026"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144027"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144026"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144027"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-164"></span><span id="withSqlitePoolInfo"><span class="annot"><span class="annottext">withSqlitePoolInfo :: forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
SqliteConnectionInfo -&gt; Int -&gt; (Pool SqlBackend -&gt; m a) -&gt; m a
</span><a href="Database.Persist.Sqlite.html#withSqlitePoolInfo"><span class="hs-identifier hs-var hs-var">withSqlitePoolInfo</span></a></span></span><span> </span><span id="local-6989586621679144925"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679144925"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LogFunc -&gt; IO SqlBackend)
-&gt; Int -&gt; (Pool SqlBackend -&gt; m a) -&gt; m a
forall backend (m :: * -&gt; *) a.
(MonadLoggerIO m, MonadUnliftIO m,
 BackendCompatible SqlBackend backend) =&gt;
(LogFunc -&gt; IO backend) -&gt; Int -&gt; (Pool backend -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">withSqlPool</span></span><span> </span><span class="annot"><span class="annottext">((LogFunc -&gt; IO SqlBackend)
 -&gt; Int -&gt; (Pool SqlBackend -&gt; m a) -&gt; m a)
-&gt; (LogFunc -&gt; IO SqlBackend)
-&gt; Int
-&gt; (Pool SqlBackend -&gt; m a)
-&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; Connection -&gt; SqlBackend)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO SqlBackend
forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var">openWith</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; SqlBackend
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679144925"><span class="hs-identifier hs-var">connInfo</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span id="local-6989586621679144030"><span id="local-6989586621679144031"><span class="annot"><a href="Database.Persist.Sqlite.html#withSqliteConn"><span class="hs-identifier hs-type">withSqliteConn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144030"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144030"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144030"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144031"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144030"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144031"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-168"></span><span id="withSqliteConn"><span class="annot"><span class="annottext">withSqliteConn :: forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
Text -&gt; (SqlBackend -&gt; m a) -&gt; m a
</span><a href="Database.Persist.Sqlite.html#withSqliteConn"><span class="hs-identifier hs-var hs-var">withSqliteConn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; (SqlBackend -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
SqliteConnectionInfo -&gt; (SqlBackend -&gt; m a) -&gt; m a
</span><a href="Database.Persist.Sqlite.html#withSqliteConnInfo"><span class="hs-identifier hs-var">withSqliteConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(SqliteConnectionInfo -&gt; (SqlBackend -&gt; m a) -&gt; m a)
-&gt; (Text -&gt; SqliteConnectionInfo)
-&gt; Text
-&gt; (SqlBackend -&gt; m a)
-&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#conStringToInfo"><span class="hs-identifier hs-var">conStringToInfo</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><span class="hs-comment">-- | @since 2.6.2</span></span><span>
</span><span id="line-171"></span><span id="local-6989586621679144034"><span id="local-6989586621679144035"><span class="annot"><a href="Database.Persist.Sqlite.html#withSqliteConnInfo"><span class="hs-identifier hs-type">withSqliteConnInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144034"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144034"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144034"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144035"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144034"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144035"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-173"></span><span id="withSqliteConnInfo"><span class="annot"><span class="annottext">withSqliteConnInfo :: forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
SqliteConnectionInfo -&gt; (SqlBackend -&gt; m a) -&gt; m a
</span><a href="Database.Persist.Sqlite.html#withSqliteConnInfo"><span class="hs-identifier hs-var hs-var">withSqliteConnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LogFunc -&gt; IO SqlBackend) -&gt; (SqlBackend -&gt; m a) -&gt; m a
forall backend (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m,
 BackendCompatible SqlBackend backend) =&gt;
(LogFunc -&gt; IO backend) -&gt; (backend -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">withSqlConn</span></span><span> </span><span class="annot"><span class="annottext">((LogFunc -&gt; IO SqlBackend) -&gt; (SqlBackend -&gt; m a) -&gt; m a)
-&gt; (SqliteConnectionInfo -&gt; LogFunc -&gt; IO SqlBackend)
-&gt; SqliteConnectionInfo
-&gt; (SqlBackend -&gt; m a)
-&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; Connection -&gt; SqlBackend)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO SqlBackend
forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var">openWith</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; SqlBackend
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span id="local-6989586621679144011"><span class="annot"><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-type">openWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Sqlite.Internal.html#Connection"><span class="hs-identifier hs-type">Sqlite.Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144011"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-177"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogFunc</span></span><span>
</span><span id="line-178"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144011"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-179"></span><span id="openWith"><span class="annot"><span class="annottext">openWith :: forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var hs-var">openWith</span></a></span></span><span> </span><span id="local-6989586621679144939"><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; r
</span><a href="#local-6989586621679144939"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679144940"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679144940"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span id="local-6989586621679144941"><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679144941"><span class="hs-identifier hs-var">logFunc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679144942"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679144942"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Connection
</span><a href="Database.Sqlite.html#open"><span class="hs-identifier hs-var">Sqlite.open</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO Connection) -&gt; Text -&gt; IO Connection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Text
</span><a href="Database.Persist.Sqlite.html#_sqlConnectionStr"><span class="hs-identifier hs-var">_sqlConnectionStr</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679144940"><span class="hs-identifier hs-var">connInfo</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679144945"><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679144945"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Connection -&gt; LogFunc -&gt; IO SqlBackend
</span><a href="Database.Persist.Sqlite.html#wrapConnectionInfo"><span class="hs-identifier hs-var">wrapConnectionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679144940"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679144942"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679144941"><span class="hs-identifier hs-var">logFunc</span></a></span><span> </span><span class="annot"><span class="annottext">IO SqlBackend -&gt; IO () -&gt; IO SqlBackend
forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-operator hs-var">`E.onException`</span></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.Sqlite.html#close"><span class="hs-identifier hs-var">Sqlite.close</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679144942"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">r -&gt; IO r
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; IO r) -&gt; r -&gt; IO r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; r
</span><a href="#local-6989586621679144939"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679144945"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679144942"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-comment">-- | Wrap up a raw 'Sqlite.Connection' as a Persistent SQL 'Connection'.</span><span>
</span><span id="line-185"></span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- === __Example usage__</span><span>
</span><span id="line-187"></span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- &gt; {-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- &gt; {-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- &gt; {-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- &gt; {-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- &gt; {-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- &gt; {-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- &gt; {-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- &gt; {-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- &gt; import Control.Monad.IO.Class  (liftIO)</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- &gt; import Database.Persist</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- &gt; import Database.Sqlite</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- &gt; import Database.Persist.Sqlite</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- &gt; import Database.Persist.TH</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- &gt; share [mkPersist sqlSettings, mkMigrate &quot;migrateAll&quot;] [persistLowerCase|</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- &gt; Person</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- &gt;   name String</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- &gt;   age Int Maybe</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- &gt;   deriving Show</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- &gt; |]</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- &gt; main :: IO ()</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- &gt; main = do</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- &gt;   conn &lt;- open &quot;/home/sibi/test.db&quot;</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- &gt;   (backend :: SqlBackend) &lt;- wrapConnection conn (\_ _ _ _ -&gt; return ())</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- &gt;   flip runSqlPersistM backend $ do</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- &gt;          runMigration migrateAll</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- &gt;          insert_ $ Person &quot;John doe&quot; $ Just 35</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- &gt;          insert_ $ Person &quot;Hema&quot; $ Just 36</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- &gt;          (pers :: [Entity Person]) &lt;- selectList [] []</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- &gt;          liftIO $ print pers</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- &gt;   close' backend</span><span>
</span><span id="line-221"></span><span class="hs-comment">--</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- On executing it, you get this output:</span><span>
</span><span id="line-223"></span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- &gt; Migrating: CREATE TABLE &quot;person&quot;(&quot;id&quot; INTEGER PRIMARY KEY,&quot;name&quot; VARCHAR NOT NULL,&quot;age&quot; INTEGER NULL)</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- &gt; [Entity {entityKey = PersonKey {unPersonKey = SqlBackendKey {unSqlBackendKey = 1}}, entityVal = Person {personName = &quot;John doe&quot;, personAge = Just 35}},Entity {entityKey = PersonKey {unPersonKey = SqlBackendKey {unSqlBackendKey = 2}}, entityVal = Person {personName = &quot;Hema&quot;, personAge = Just 36}}]</span><span>
</span><span id="line-226"></span><span class="hs-comment">--</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- @since 1.1.5</span><span>
</span><span id="line-228"></span><span class="annot"><a href="Database.Persist.Sqlite.html#wrapConnection"><span class="hs-identifier hs-type">wrapConnection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Sqlite.Internal.html#Connection"><span class="hs-identifier hs-type">Sqlite.Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogFunc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span>
</span><span id="line-229"></span><span id="wrapConnection"><span class="annot"><span class="annottext">wrapConnection :: Connection -&gt; LogFunc -&gt; IO SqlBackend
</span><a href="Database.Persist.Sqlite.html#wrapConnection"><span class="hs-identifier hs-var hs-var">wrapConnection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Connection -&gt; LogFunc -&gt; IO SqlBackend
</span><a href="Database.Persist.Sqlite.html#wrapConnectionInfo"><span class="hs-identifier hs-var">wrapConnectionInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#mkSqliteConnectionInfo"><span class="hs-identifier hs-var">mkSqliteConnectionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-comment">-- | Retry if a Busy is thrown, following an exponential backoff strategy.</span><span>
</span><span id="line-232"></span><span class="hs-comment">--</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- @since 2.9.3</span><span>
</span><span id="line-234"></span><span id="local-6989586621679144046"><span id="local-6989586621679144047"><span class="annot"><a href="Database.Persist.Sqlite.html#retryOnBusy"><span class="hs-identifier hs-type">retryOnBusy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144046"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144046"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144046"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144047"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144046"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144047"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-235"></span><span id="retryOnBusy"><span class="annot"><span class="annottext">retryOnBusy :: forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
m a -&gt; m a
</span><a href="Database.Persist.Sqlite.html#retryOnBusy"><span class="hs-identifier hs-var hs-var">retryOnBusy</span></a></span></span><span> </span><span id="local-6989586621679144979"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679144979"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="annottext">[Int] -&gt; m a
</span><a href="#local-6989586621679144980"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; m a) -&gt; [Int] -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall {t}. (Ord t, Num t) =&gt; t -&gt; [t]
</span><a href="#local-6989586621679144982"><span class="hs-identifier hs-var">delays</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-238"></span><span>    </span><span id="local-6989586621679144982"><span class="annot"><span class="annottext">delays :: t -&gt; [t]
</span><a href="#local-6989586621679144982"><span class="hs-identifier hs-var hs-var">delays</span></a></span></span><span> </span><span id="local-6989586621679144992"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679144992"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679144992"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1000000</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; [t]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679144992"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679144992"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; [t] -&gt; [t]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; [t]
</span><a href="#local-6989586621679144982"><span class="hs-identifier hs-var">delays</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679144992"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679144980"><span class="annot"><span class="annottext">start :: [Int] -&gt; m a
</span><a href="#local-6989586621679144980"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-special">$</span><span class="annot"><span class="annottext">Int
String
LogLevel
String -&gt; Text
String -&gt; String -&gt; String -&gt; CharPos -&gt; CharPos -&gt; Loc
Text -&gt; Text
Loc -&gt; Text -&gt; LogLevel -&gt; Text -&gt; m ()
(Text -&gt; m ()) -&gt; (Text -&gt; Text) -&gt; Text -&gt; m ()
forall a. a -&gt; a
forall msg. ToLogStr msg =&gt; Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
forall (m :: * -&gt; *) msg.
(MonadLogger m, ToLogStr msg) =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; m ()
. :: forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
id :: forall a. a -&gt; a
monadLoggerLog :: forall (m :: * -&gt; *) msg.
(MonadLogger m, ToLogStr msg) =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; m ()
pack :: String -&gt; Text
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">logWarn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Out of retry attempts&quot;</span></span><span>
</span><span id="line-244"></span><span>      </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679144979"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="#local-6989586621679144980"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679145000"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145000"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679145001"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679145001"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>      </span><span class="hs-comment">-- Using try instead of catch to avoid creating a stack overflow</span><span>
</span><span id="line-247"></span><span>      </span><span id="local-6989586621679145002"><span class="annot"><span class="annottext">Either SqliteException a
</span><a href="#local-6989586621679145002"><span class="hs-identifier hs-var">eres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((forall a. m a -&gt; IO a) -&gt; IO (Either SqliteException a))
-&gt; m (Either SqliteException a)
forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b
forall (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b
</span><span class="hs-identifier hs-var">withRunInIO</span></span><span> </span><span class="annot"><span class="annottext">(((forall a. m a -&gt; IO a) -&gt; IO (Either SqliteException a))
 -&gt; m (Either SqliteException a))
-&gt; ((forall a. m a -&gt; IO a) -&gt; IO (Either SqliteException a))
-&gt; m (Either SqliteException a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679145003"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621679145003"><span class="hs-identifier hs-var">run</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO (Either SqliteException a)
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">E.try</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO (Either SqliteException a))
-&gt; IO a -&gt; IO (Either SqliteException a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m a -&gt; IO a
forall a. m a -&gt; IO a
</span><a href="#local-6989586621679145003"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679144979"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SqliteException a
</span><a href="#local-6989586621679145002"><span class="hs-identifier hs-var">eres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-249"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Sqlite.html#SqliteException"><span class="hs-identifier hs-type">Sqlite.SqliteException</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">seError :: SqliteException -&gt; Error
</span><a href="Database.Sqlite.html#seError"><span class="hs-identifier hs-var">Sqlite.seError</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Error
</span><a href="Database.Sqlite.html#ErrorBusy"><span class="hs-identifier hs-var">Sqlite.ErrorBusy</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>          </span><span class="hs-special">$</span><span class="annot"><span class="annottext">Int
String
LogLevel
String -&gt; Text
String -&gt; String -&gt; String -&gt; CharPos -&gt; CharPos -&gt; Loc
Text -&gt; Text
Loc -&gt; Text -&gt; LogLevel -&gt; Text -&gt; m ()
(Text -&gt; m ()) -&gt; (Text -&gt; Text) -&gt; Text -&gt; m ()
forall a. a -&gt; a
forall msg. ToLogStr msg =&gt; Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
forall (m :: * -&gt; *) msg.
(MonadLogger m, ToLogStr msg) =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; m ()
. :: forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
id :: forall a. a -&gt; a
monadLoggerLog :: forall (m :: * -&gt; *) msg.
(MonadLogger m, ToLogStr msg) =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; m ()
pack :: String -&gt; Text
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">logWarn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Encountered an SQLITE_BUSY, going to retry...&quot;</span></span><span>
</span><span id="line-251"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145000"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-252"></span><span>          </span><span class="annot"><span class="annottext">[Int] -&gt; m a
</span><a href="#local-6989586621679144980"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679145001"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679145009"><span class="annot"><span class="annottext">SqliteException
</span><a href="#local-6989586621679145009"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; m a
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; m a) -&gt; IO a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SqliteException -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">SqliteException
</span><a href="#local-6989586621679145009"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679145011"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679145011"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679145011"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">-- | Wait until some noop action on the database does not return an 'Sqlite.ErrorBusy'. See 'retryOnBusy'.</span><span>
</span><span id="line-257"></span><span class="hs-comment">--</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- @since 2.9.3</span><span>
</span><span id="line-259"></span><span id="local-6989586621679144077"><span id="local-6989586621679144078"><span class="annot"><a href="Database.Persist.Sqlite.html#waitForDatabase"><span class="hs-identifier hs-type">waitForDatabase</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144077"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144077"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BackendCompatible</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="annot"><a href="#local-6989586621679144078"><span class="hs-identifier hs-type">backend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679144078"><span class="hs-identifier hs-type">backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144077"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-262"></span><span id="waitForDatabase"><span class="annot"><span class="annottext">waitForDatabase :: forall (m :: * -&gt; *) backend.
(MonadUnliftIO m, MonadLoggerIO m,
 BackendCompatible SqlBackend backend) =&gt;
ReaderT backend m ()
</span><a href="Database.Persist.Sqlite.html#waitForDatabase"><span class="hs-identifier hs-var hs-var">waitForDatabase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT backend m () -&gt; ReaderT backend m ()
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
m a -&gt; m a
</span><a href="Database.Persist.Sqlite.html#retryOnBusy"><span class="hs-identifier hs-var">retryOnBusy</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT backend m () -&gt; ReaderT backend m ())
-&gt; ReaderT backend m () -&gt; ReaderT backend m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [PersistValue] -&gt; ReaderT backend m ()
forall (m :: * -&gt; *) backend.
(MonadIO m, BackendCompatible SqlBackend backend) =&gt;
Text -&gt; [PersistValue] -&gt; ReaderT backend m ()
</span><span class="hs-identifier hs-var">rawExecute</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SELECT 42&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | Wrap up a raw 'Sqlite.Connection' as a Persistent SQL</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- 'Connection', allowing full control over WAL and FK constraints.</span><span>
</span><span id="line-266"></span><span class="hs-comment">--</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- @since 2.6.2</span><span>
</span><span id="line-268"></span><span class="annot"><a href="Database.Persist.Sqlite.html#wrapConnectionInfo"><span class="hs-identifier hs-type">wrapConnectionInfo</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Sqlite.Internal.html#Connection"><span class="hs-identifier hs-type">Sqlite.Connection</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogFunc</span></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span>
</span><span id="line-273"></span><span id="wrapConnectionInfo"><span class="annot"><span class="annottext">wrapConnectionInfo :: SqliteConnectionInfo -&gt; Connection -&gt; LogFunc -&gt; IO SqlBackend
</span><a href="Database.Persist.Sqlite.html#wrapConnectionInfo"><span class="hs-identifier hs-var hs-var">wrapConnectionInfo</span></a></span></span><span> </span><span id="local-6989586621679145024"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145024"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span id="local-6989586621679145025"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145025"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679145026"><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145026"><span class="hs-identifier hs-var">logFunc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-275"></span><span>        </span><span class="hs-comment">-- Turn on the write-ahead log</span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-comment">-- https://github.com/yesodweb/persistent/issues/363</span><span>
</span><span id="line-277"></span><span>        </span><span id="local-6989586621679145027"><span class="annot"><span class="annottext">walPragma :: [(Text, Bool)] -&gt; [(Text, Bool)]
</span><a href="#local-6989586621679145027"><span class="hs-identifier hs-var hs-var">walPragma</span></a></span></span><span>
</span><span id="line-278"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Bool
</span><a href="Database.Persist.Sqlite.html#_walEnabled"><span class="hs-identifier hs-var">_walEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145024"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;PRAGMA journal_mode=WAL;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Text, Bool) -&gt; [(Text, Bool)] -&gt; [(Text, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Text, Bool)] -&gt; [(Text, Bool)]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-comment">-- Turn on foreign key constraints</span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-comment">-- https://github.com/yesodweb/persistent/issues/646</span><span>
</span><span id="line-283"></span><span>        </span><span id="local-6989586621679145029"><span class="annot"><span class="annottext">fkPragma :: [(Text, Bool)] -&gt; [(Text, Bool)]
</span><a href="#local-6989586621679145029"><span class="hs-identifier hs-var hs-var">fkPragma</span></a></span></span><span>
</span><span id="line-284"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Bool
</span><a href="Database.Persist.Sqlite.html#_fkEnabled"><span class="hs-identifier hs-var">_fkEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145024"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;PRAGMA foreign_keys = on;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Text, Bool) -&gt; [(Text, Bool)] -&gt; [(Text, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Text, Bool)] -&gt; [(Text, Bool)]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-comment">-- Allow arbitrary additional pragmas to be set</span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-comment">-- https://github.com/commercialhaskell/stack/issues/4247</span><span>
</span><span id="line-289"></span><span>        </span><span id="local-6989586621679145031"><span class="annot"><span class="annottext">pragmas :: [(Text, Bool)]
</span><a href="#local-6989586621679145031"><span class="hs-identifier hs-var hs-var">pragmas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Text, Bool)] -&gt; [(Text, Bool)]
</span><a href="#local-6989586621679145027"><span class="hs-identifier hs-var">walPragma</span></a></span><span> </span><span class="annot"><span class="annottext">([(Text, Bool)] -&gt; [(Text, Bool)])
-&gt; [(Text, Bool)] -&gt; [(Text, Bool)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Bool)] -&gt; [(Text, Bool)]
</span><a href="#local-6989586621679145029"><span class="hs-identifier hs-var">fkPragma</span></a></span><span> </span><span class="annot"><span class="annottext">([(Text, Bool)] -&gt; [(Text, Bool)])
-&gt; [(Text, Bool)] -&gt; [(Text, Bool)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; (Text, Bool)) -&gt; [Text] -&gt; [(Text, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [(Text, Bool)]) -&gt; [Text] -&gt; [(Text, Bool)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; [Text]
</span><a href="Database.Persist.Sqlite.html#_extraPragmas"><span class="hs-identifier hs-var">_extraPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145024"><span class="hs-identifier hs-var">connInfo</span></a></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><span class="annottext">[(Text, Bool)] -&gt; ((Text, Bool) -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Bool)]
</span><a href="#local-6989586621679145031"><span class="hs-identifier hs-var">pragmas</span></a></span><span> </span><span class="annot"><span class="annottext">(((Text, Bool) -&gt; IO ()) -&gt; IO ())
-&gt; ((Text, Bool) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679145033"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145033"><span class="hs-identifier hs-var">pragma</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145034"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145034"><span class="hs-identifier hs-var">shouldRetry</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(LoggingT IO () -&gt; LogFunc -&gt; IO ())
-&gt; LogFunc -&gt; LoggingT IO () -&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">LoggingT IO () -&gt; LogFunc -&gt; IO ()
forall (m :: * -&gt; *) a. LoggingT m a -&gt; LogFunc -&gt; m a
</span><span class="hs-identifier hs-var">runLoggingT</span></span><span> </span><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145026"><span class="hs-identifier hs-var">logFunc</span></a></span><span> </span><span class="annot"><span class="annottext">(LoggingT IO () -&gt; IO ()) -&gt; LoggingT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145034"><span class="hs-identifier hs-var">shouldRetry</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LoggingT IO () -&gt; LoggingT IO ()
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
m a -&gt; m a
</span><a href="Database.Persist.Sqlite.html#retryOnBusy"><span class="hs-identifier hs-var">retryOnBusy</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LoggingT IO () -&gt; LoggingT IO ()
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LoggingT IO () -&gt; LoggingT IO ())
-&gt; LoggingT IO () -&gt; LoggingT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; LoggingT IO ()
forall a. IO a -&gt; LoggingT IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; LoggingT IO ()) -&gt; IO () -&gt; LoggingT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>        </span><span id="local-6989586621679145036"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145036"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Text -&gt; IO Statement
</span><a href="Database.Sqlite.html#prepare"><span class="hs-identifier hs-var">Sqlite.prepare</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145025"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145033"><span class="hs-identifier hs-var">pragma</span></a></span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="annottext">StepResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Statement -&gt; IO StepResult
</span><a href="Database.Sqlite.html#stepConn"><span class="hs-identifier hs-var">Sqlite.stepConn</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145025"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145036"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-295"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Statement -&gt; IO ()
</span><a href="Database.Sqlite.html#reset"><span class="hs-identifier hs-var">Sqlite.reset</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145025"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145036"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="annot"><span class="annottext">Statement -&gt; IO ()
</span><a href="Database.Sqlite.html#finalize"><span class="hs-identifier hs-var">Sqlite.finalize</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145036"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621679145041"><span class="annot"><span class="annottext">IORef (Map Text Statement)
</span><a href="#local-6989586621679145041"><span class="hs-identifier hs-var">smap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Text Statement -&gt; IO (IORef (Map Text Statement))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Map Text Statement
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">SqlBackend -&gt; IO SqlBackend
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; IO SqlBackend) -&gt; SqlBackend -&gt; IO SqlBackend
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; SqlBackend -&gt; SqlBackend
</span><span class="hs-identifier hs-var">setConnMaxParams</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">999</span></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; SqlBackend) -&gt; SqlBackend -&gt; SqlBackend
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">(EntityDef -&gt; Int -&gt; Text) -&gt; SqlBackend -&gt; SqlBackend
</span><span class="hs-identifier hs-var">setConnPutManySql</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; Int -&gt; Text
</span><a href="Database.Persist.Sqlite.html#putManySql"><span class="hs-identifier hs-var">putManySql</span></a></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; SqlBackend) -&gt; SqlBackend -&gt; SqlBackend
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><span class="annottext">(EntityDef -&gt; Int -&gt; Text) -&gt; SqlBackend -&gt; SqlBackend
</span><span class="hs-identifier hs-var">setConnRepsertManySql</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; Int -&gt; Text
</span><a href="Database.Persist.Sqlite.html#repsertManySql"><span class="hs-identifier hs-var">repsertManySql</span></a></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; SqlBackend) -&gt; SqlBackend -&gt; SqlBackend
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="annottext">MkSqlBackendArgs -&gt; SqlBackend
</span><span class="hs-identifier hs-var">mkSqlBackend</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MkSqlBackendArgs</span></span><span>
</span><span id="line-304"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">connPrepare :: Text -&gt; IO Statement
</span><span class="hs-identifier hs-var">connPrepare</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Text -&gt; IO Statement
</span><a href="Database.Persist.Sqlite.html#prepare%27"><span class="hs-identifier hs-var">prepare'</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145025"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-305"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connStmtMap :: IORef (Map Text Statement)
</span><span class="hs-identifier hs-var">connStmtMap</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Map Text Statement)
</span><a href="#local-6989586621679145041"><span class="hs-identifier hs-var">smap</span></a></span><span>
</span><span id="line-306"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connInsertSql :: EntityDef -&gt; [PersistValue] -&gt; InsertSqlResult
</span><span class="hs-identifier hs-var">connInsertSql</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [PersistValue] -&gt; InsertSqlResult
</span><a href="Database.Persist.Sqlite.html#insertSql%27"><span class="hs-identifier hs-var">insertSql'</span></a></span><span>
</span><span id="line-307"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connClose :: IO ()
</span><span class="hs-identifier hs-var">connClose</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.Sqlite.html#close"><span class="hs-identifier hs-var">Sqlite.close</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145025"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-308"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connMigrateSql :: [EntityDef]
-&gt; (Text -&gt; IO Statement)
-&gt; EntityDef
-&gt; IO (Either [Text] [(Bool, Text)])
</span><span class="hs-identifier hs-var">connMigrateSql</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EntityDef]
-&gt; (Text -&gt; IO Statement)
-&gt; EntityDef
-&gt; IO (Either [Text] [(Bool, Text)])
</span><a href="Database.Persist.Sqlite.html#migrate%27"><span class="hs-identifier hs-var">migrate'</span></a></span><span>
</span><span id="line-309"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connBegin :: (Text -&gt; IO Statement) -&gt; Maybe IsolationLevel -&gt; IO ()
</span><span class="hs-identifier hs-var">connBegin</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679145058"><span class="annot"><span class="annottext">Text -&gt; IO Statement
</span><a href="#local-6989586621679145058"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe IsolationLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; IO Statement) -&gt; IO ()
forall {t}. t -&gt; (t -&gt; IO Statement) -&gt; IO ()
</span><a href="#local-6989586621679145059"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;BEGIN&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Statement
</span><a href="#local-6989586621679145058"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-310"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connCommit :: (Text -&gt; IO Statement) -&gt; IO ()
</span><span class="hs-identifier hs-var">connCommit</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; IO Statement) -&gt; IO ()
forall {t}. t -&gt; (t -&gt; IO Statement) -&gt; IO ()
</span><a href="#local-6989586621679145059"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;COMMIT&quot;</span></span><span>
</span><span id="line-311"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connRollback :: (Text -&gt; IO Statement) -&gt; IO ()
</span><span class="hs-identifier hs-var">connRollback</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="#local-6989586621679145062"><span class="hs-identifier hs-var">ignoreExceptions</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ())
-&gt; ((Text -&gt; IO Statement) -&gt; IO ())
-&gt; (Text -&gt; IO Statement)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; IO Statement) -&gt; IO ()
forall {t}. t -&gt; (t -&gt; IO Statement) -&gt; IO ()
</span><a href="#local-6989586621679145059"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ROLLBACK&quot;</span></span><span>
</span><span id="line-312"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connEscapeFieldName :: FieldNameDB -&gt; Text
</span><span class="hs-identifier hs-var">connEscapeFieldName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (FieldNameDB -&gt; Text) -&gt; FieldNameDB -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><span class="hs-identifier hs-var">unFieldNameDB</span></span><span>
</span><span id="line-313"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connEscapeTableName :: EntityDef -&gt; Text
</span><span class="hs-identifier hs-var">connEscapeTableName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (EntityDef -&gt; Text) -&gt; EntityDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><span class="hs-identifier hs-var">unEntityNameDB</span></span><span> </span><span class="annot"><span class="annottext">(EntityNameDB -&gt; Text)
-&gt; (EntityDef -&gt; EntityNameDB) -&gt; EntityDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span>
</span><span id="line-314"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connEscapeRawName :: Text -&gt; Text
</span><span class="hs-identifier hs-var">connEscapeRawName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var">escape</span></a></span><span>
</span><span id="line-315"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connNoLimit :: Text
</span><span class="hs-identifier hs-var">connNoLimit</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;LIMIT -1&quot;</span></span><span>
</span><span id="line-316"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connRDBMS :: Text
</span><span class="hs-identifier hs-var">connRDBMS</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sqlite&quot;</span></span><span>
</span><span id="line-317"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connLimitOffset :: CharPos -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">connLimitOffset</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; CharPos -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">decorateSQLWithLimitOffset</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;LIMIT -1&quot;</span></span><span>
</span><span id="line-318"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connLogFunc :: LogFunc
</span><span class="hs-identifier hs-var">connLogFunc</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145026"><span class="hs-identifier hs-var">logFunc</span></a></span><span>
</span><span id="line-319"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621679145059"><span class="annot"><span class="annottext">helper :: t -&gt; (t -&gt; IO Statement) -&gt; IO ()
</span><a href="#local-6989586621679145059"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span id="local-6989586621679145077"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679145077"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679145078"><span class="annot"><span class="annottext">t -&gt; IO Statement
</span><a href="#local-6989586621679145078"><span class="hs-identifier hs-var">getter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>        </span><span id="local-6989586621679145079"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145079"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t -&gt; IO Statement
</span><a href="#local-6989586621679145078"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679145077"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Statement -&gt; [PersistValue] -&gt; IO Int64
</span><span class="hs-identifier hs-var">stmtExecute</span></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145079"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-324"></span><span>        </span><span class="annot"><span class="annottext">Statement -&gt; IO ()
</span><span class="hs-identifier hs-var">stmtReset</span></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145079"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621679145062"><span class="annot"><span class="annottext">ignoreExceptions :: IO () -&gt; IO ()
</span><a href="#local-6989586621679145062"><span class="hs-identifier hs-var hs-var">ignoreExceptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">E.handle</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.SomeException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">-- | A convenience helper which creates a new database connection and runs the</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- given block, handling @MonadResource@ and @MonadLogger@ requirements. Note</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- that all log messages are discarded.</span><span>
</span><span id="line-330"></span><span class="hs-comment">--</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- @since 1.1.4</span><span>
</span><span id="line-332"></span><span id="local-6989586621679144113"><span id="local-6989586621679144116"><span class="annot"><a href="Database.Persist.Sqlite.html#runSqlite"><span class="hs-identifier hs-type">runSqlite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144113"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ connection string</span></span><span>
</span><span id="line-334"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NoLoggingT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ResourceT</span></span><span> </span><span class="annot"><a href="#local-6989586621679144113"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679144116"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ database action</span></span><span>
</span><span id="line-335"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144113"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144116"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-336"></span><span id="runSqlite"><span class="annot"><span class="annottext">runSqlite :: forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
Text -&gt; ReaderT SqlBackend (NoLoggingT (ResourceT m)) a -&gt; m a
</span><a href="Database.Persist.Sqlite.html#runSqlite"><span class="hs-identifier hs-var hs-var">runSqlite</span></a></span></span><span> </span><span id="local-6989586621679145099"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145099"><span class="hs-identifier hs-var">connstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceT m a -&gt; m a
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><span class="hs-identifier hs-var">runResourceT</span></span><span>
</span><span id="line-337"></span><span>                  </span><span class="annot"><span class="annottext">(ResourceT m a -&gt; m a)
-&gt; (ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
    -&gt; ResourceT m a)
-&gt; ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
-&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NoLoggingT (ResourceT m) a -&gt; ResourceT m a
forall (m :: * -&gt; *) a. NoLoggingT m a -&gt; m a
</span><span class="hs-identifier hs-var">runNoLoggingT</span></span><span>
</span><span id="line-338"></span><span>                  </span><span class="annot"><span class="annottext">(NoLoggingT (ResourceT m) a -&gt; ResourceT m a)
-&gt; (ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
    -&gt; NoLoggingT (ResourceT m) a)
-&gt; ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
-&gt; ResourceT m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; (SqlBackend -&gt; NoLoggingT (ResourceT m) a)
-&gt; NoLoggingT (ResourceT m) a
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
Text -&gt; (SqlBackend -&gt; m a) -&gt; m a
</span><a href="Database.Persist.Sqlite.html#withSqliteConn"><span class="hs-identifier hs-var">withSqliteConn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145099"><span class="hs-identifier hs-var">connstr</span></a></span><span>
</span><span id="line-339"></span><span>                  </span><span class="annot"><span class="annottext">((SqlBackend -&gt; NoLoggingT (ResourceT m) a)
 -&gt; NoLoggingT (ResourceT m) a)
-&gt; (ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
    -&gt; SqlBackend -&gt; NoLoggingT (ResourceT m) a)
-&gt; ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
-&gt; NoLoggingT (ResourceT m) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
-&gt; SqlBackend -&gt; NoLoggingT (ResourceT m) a
forall backend (m :: * -&gt; *) a.
(MonadUnliftIO m, BackendCompatible SqlBackend backend) =&gt;
ReaderT backend m a -&gt; backend -&gt; m a
</span><span class="hs-identifier hs-var">runSqlConn</span></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-comment">-- | A convenience helper which creates a new database connection and runs the</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- given block, handling @MonadResource@ and @MonadLogger@ requirements. Note</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- that all log messages are discarded.</span><span>
</span><span id="line-344"></span><span class="hs-comment">--</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- @since 2.6.2</span><span>
</span><span id="line-346"></span><span id="local-6989586621679144130"><span id="local-6989586621679144131"><span class="annot"><a href="Database.Persist.Sqlite.html#runSqliteInfo"><span class="hs-identifier hs-type">runSqliteInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144130"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-348"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NoLoggingT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ResourceT</span></span><span> </span><span class="annot"><a href="#local-6989586621679144130"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679144131"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ database action</span></span><span>
</span><span id="line-349"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144130"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144131"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-350"></span><span id="runSqliteInfo"><span class="annot"><span class="annottext">runSqliteInfo :: forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
SqliteConnectionInfo
-&gt; ReaderT SqlBackend (NoLoggingT (ResourceT m)) a -&gt; m a
</span><a href="Database.Persist.Sqlite.html#runSqliteInfo"><span class="hs-identifier hs-var hs-var">runSqliteInfo</span></a></span></span><span> </span><span id="local-6989586621679145110"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145110"><span class="hs-identifier hs-var">conInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceT m a -&gt; m a
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><span class="hs-identifier hs-var">runResourceT</span></span><span>
</span><span id="line-351"></span><span>                      </span><span class="annot"><span class="annottext">(ResourceT m a -&gt; m a)
-&gt; (ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
    -&gt; ResourceT m a)
-&gt; ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
-&gt; m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NoLoggingT (ResourceT m) a -&gt; ResourceT m a
forall (m :: * -&gt; *) a. NoLoggingT m a -&gt; m a
</span><span class="hs-identifier hs-var">runNoLoggingT</span></span><span>
</span><span id="line-352"></span><span>                      </span><span class="annot"><span class="annottext">(NoLoggingT (ResourceT m) a -&gt; ResourceT m a)
-&gt; (ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
    -&gt; NoLoggingT (ResourceT m) a)
-&gt; ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
-&gt; ResourceT m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
-&gt; (SqlBackend -&gt; NoLoggingT (ResourceT m) a)
-&gt; NoLoggingT (ResourceT m) a
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
SqliteConnectionInfo -&gt; (SqlBackend -&gt; m a) -&gt; m a
</span><a href="Database.Persist.Sqlite.html#withSqliteConnInfo"><span class="hs-identifier hs-var">withSqliteConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145110"><span class="hs-identifier hs-var">conInfo</span></a></span><span>
</span><span id="line-353"></span><span>                      </span><span class="annot"><span class="annottext">((SqlBackend -&gt; NoLoggingT (ResourceT m) a)
 -&gt; NoLoggingT (ResourceT m) a)
-&gt; (ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
    -&gt; SqlBackend -&gt; NoLoggingT (ResourceT m) a)
-&gt; ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
-&gt; NoLoggingT (ResourceT m) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ReaderT SqlBackend (NoLoggingT (ResourceT m)) a
-&gt; SqlBackend -&gt; NoLoggingT (ResourceT m) a
forall backend (m :: * -&gt; *) a.
(MonadUnliftIO m, BackendCompatible SqlBackend backend) =&gt;
ReaderT backend m a -&gt; backend -&gt; m a
</span><span class="hs-identifier hs-var">runSqlConn</span></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><a href="Database.Persist.Sqlite.html#prepare%27"><span class="hs-identifier hs-type">prepare'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Sqlite.Internal.html#Connection"><span class="hs-identifier hs-type">Sqlite.Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Statement</span></span><span>
</span><span id="line-356"></span><span id="prepare%27"><span class="annot"><span class="annottext">prepare' :: Connection -&gt; Text -&gt; IO Statement
</span><a href="Database.Persist.Sqlite.html#prepare%27"><span class="hs-identifier hs-var hs-var">prepare'</span></a></span></span><span> </span><span id="local-6989586621679145111"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145111"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679145112"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145112"><span class="hs-identifier hs-var">sql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621679145113"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145113"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Text -&gt; IO Statement
</span><a href="Database.Sqlite.html#prepare"><span class="hs-identifier hs-var">Sqlite.prepare</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145111"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145112"><span class="hs-identifier hs-var">sql</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><span class="annottext">Statement -&gt; IO Statement
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Statement</span></span><span>
</span><span id="line-359"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stmtFinalize :: IO ()
</span><span class="hs-identifier hs-var">stmtFinalize</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Statement -&gt; IO ()
</span><a href="Database.Sqlite.html#finalize"><span class="hs-identifier hs-var">Sqlite.finalize</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145113"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-360"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stmtReset :: IO ()
</span><span class="hs-identifier hs-var">stmtReset</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Statement -&gt; IO ()
</span><a href="Database.Sqlite.html#reset"><span class="hs-identifier hs-var">Sqlite.reset</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145111"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145113"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-361"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stmtExecute :: [PersistValue] -&gt; IO Int64
</span><span class="hs-identifier hs-var">stmtExecute</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Statement -&gt; [PersistValue] -&gt; IO Int64
</span><a href="Database.Persist.Sqlite.html#execute%27"><span class="hs-identifier hs-var">execute'</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145111"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145113"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stmtQuery :: forall (m :: * -&gt; *).
MonadIO m =&gt;
[PersistValue] -&gt; Acquire (ConduitM () [PersistValue] m ())
</span><span class="hs-identifier hs-var">stmtQuery</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection
-&gt; Statement
-&gt; [PersistValue]
-&gt; Acquire (ConduitM () [PersistValue] m ())
forall (m :: * -&gt; *).
MonadIO m =&gt;
Connection
-&gt; Statement
-&gt; [PersistValue]
-&gt; Acquire (ConduitM () [PersistValue] m ())
</span><a href="Database.Persist.Sqlite.html#withStmt%27"><span class="hs-identifier hs-var">withStmt'</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145111"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145113"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="annot"><a href="Database.Persist.Sqlite.html#insertSql%27"><span class="hs-identifier hs-type">insertSql'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PersistValue</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InsertSqlResult</span></span><span>
</span><span id="line-366"></span><span id="insertSql%27"><span class="annot"><span class="annottext">insertSql' :: EntityDef -&gt; [PersistValue] -&gt; InsertSqlResult
</span><a href="Database.Persist.Sqlite.html#insertSql%27"><span class="hs-identifier hs-var hs-var">insertSql'</span></a></span></span><span> </span><span id="local-6989586621679145121"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145121"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span id="local-6989586621679145122"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145122"><span class="hs-identifier hs-var">vals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityIdDef
</span><span class="hs-identifier hs-var">getEntityId</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145121"><span class="hs-identifier hs-var">ent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-368"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">EntityIdNaturalKey</span></span><span> </span><span class="annot"><span class="annottext">CompositeDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-369"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; [PersistValue] -&gt; InsertSqlResult
</span><span class="hs-identifier hs-var">ISRManyKeys</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145126"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145122"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-370"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679145126"><span class="annot"><span class="annottext">sql :: Text
</span><a href="#local-6989586621679145126"><span class="hs-identifier hs-var hs-var">sql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-371"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;INSERT INTO &quot;</span></span><span>
</span><span id="line-372"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">(EntityNameDB -&gt; Text) -&gt; EntityNameDB -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145121"><span class="hs-identifier hs-var">ent</span></a></span><span>
</span><span id="line-373"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(&quot;</span></span><span>
</span><span id="line-374"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; Text) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text)
-&gt; (FieldDef -&gt; FieldNameDB) -&gt; FieldDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">fieldDB</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145132"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-375"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) VALUES(&quot;</span></span><span>
</span><span id="line-376"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldDef -&gt; Text) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldDef -&gt; Text
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;?&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145132"><span class="hs-identifier hs-var">cols</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-378"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-379"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">EntityIdField</span></span><span> </span><span id="local-6989586621679145134"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679145134"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-380"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; InsertSqlResult
</span><span class="hs-identifier hs-var">ISRInsertGet</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145136"><span class="hs-identifier hs-var">ins</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145137"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-381"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-382"></span><span>              </span><span id="local-6989586621679145137"><span class="annot"><span class="annottext">sel :: Text
</span><a href="#local-6989586621679145137"><span class="hs-identifier hs-var hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-383"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SELECT &quot;</span></span><span>
</span><span id="line-384"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text) -&gt; FieldNameDB -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">fieldDB</span></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679145134"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-385"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; FROM &quot;</span></span><span>
</span><span id="line-386"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">(EntityNameDB -&gt; Text) -&gt; EntityNameDB -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145121"><span class="hs-identifier hs-var">ent</span></a></span><span>
</span><span id="line-387"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; WHERE _ROWID_=last_insert_rowid()&quot;</span></span><span>
</span><span id="line-388"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-389"></span><span>              </span><span id="local-6989586621679145136"><span class="annot"><span class="annottext">ins :: Text
</span><a href="#local-6989586621679145136"><span class="hs-identifier hs-var hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-390"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;INSERT INTO &quot;</span></span><span>
</span><span id="line-391"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">(EntityNameDB -&gt; Text) -&gt; EntityNameDB -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145121"><span class="hs-identifier hs-var">ent</span></a></span><span>
</span><span id="line-392"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[FieldDef] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145132"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-393"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; VALUES(null)&quot;</span></span><span>
</span><span id="line-394"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-395"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(&quot;</span></span><span>
</span><span id="line-396"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; Text) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text)
-&gt; (FieldDef -&gt; FieldNameDB) -&gt; FieldDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">fieldDB</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FieldDef] -&gt; [Text]) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145132"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-397"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) VALUES(&quot;</span></span><span>
</span><span id="line-398"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldDef -&gt; Text) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldDef -&gt; Text
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;?&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145132"><span class="hs-identifier hs-var">cols</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-400"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-401"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621679145139"><span class="annot"><span class="annottext">notGenerated :: FieldDef -&gt; Bool
</span><a href="#local-6989586621679145139"><span class="hs-identifier hs-var hs-var">notGenerated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-404"></span><span>        </span><span class="annot"><span class="annottext">Maybe Text -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Bool)
-&gt; (FieldDef -&gt; Maybe Text) -&gt; FieldDef -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Maybe Text
</span><span class="hs-identifier hs-var">fieldGenerated</span></span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621679145132"><span class="annot"><span class="annottext">cols :: [FieldDef]
</span><a href="#local-6989586621679145132"><span class="hs-identifier hs-var hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-406"></span><span>        </span><span class="annot"><span class="annottext">(FieldDef -&gt; Bool) -&gt; [FieldDef] -&gt; [FieldDef]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Bool
</span><a href="#local-6989586621679145139"><span class="hs-identifier hs-var">notGenerated</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldDef] -&gt; [FieldDef]) -&gt; [FieldDef] -&gt; [FieldDef]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [FieldDef]
</span><span class="hs-identifier hs-var">getEntityFields</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145121"><span class="hs-identifier hs-var">ent</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="annot"><a href="Database.Persist.Sqlite.html#execute%27"><span class="hs-identifier hs-type">execute'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Sqlite.Internal.html#Connection"><span class="hs-identifier hs-type">Sqlite.Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Sqlite.Internal.html#Statement"><span class="hs-identifier hs-type">Sqlite.Statement</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PersistValue</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span>
</span><span id="line-409"></span><span id="execute%27"><span class="annot"><span class="annottext">execute' :: Connection -&gt; Statement -&gt; [PersistValue] -&gt; IO Int64
</span><a href="Database.Persist.Sqlite.html#execute%27"><span class="hs-identifier hs-var hs-var">execute'</span></a></span></span><span> </span><span id="local-6989586621679145143"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145143"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679145144"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145144"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span id="local-6989586621679145145"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145145"><span class="hs-identifier hs-var">vals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IO Int64 -&gt; IO () -&gt; IO Int64) -&gt; IO () -&gt; IO Int64 -&gt; IO Int64
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">IO Int64 -&gt; IO () -&gt; IO Int64
forall (m :: * -&gt; *) a b. MonadUnliftIO m =&gt; m a -&gt; m b -&gt; m a
</span><a href="Database.Persist.Sqlite.html#finally"><span class="hs-identifier hs-var">finally</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Statement -&gt; IO ()
</span><a href="Database.Sqlite.html#reset"><span class="hs-identifier hs-var">Sqlite.reset</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145143"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145144"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO Int64 -&gt; IO Int64) -&gt; IO Int64 -&gt; IO Int64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="annottext">Statement -&gt; [PersistValue] -&gt; IO ()
</span><a href="Database.Sqlite.html#bind"><span class="hs-identifier hs-var">Sqlite.bind</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145144"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145145"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><span class="annottext">StepResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Statement -&gt; IO StepResult
</span><a href="Database.Sqlite.html#stepConn"><span class="hs-identifier hs-var">Sqlite.stepConn</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145143"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145144"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; IO Int64
</span><a href="Database.Sqlite.html#changes"><span class="hs-identifier hs-var">Sqlite.changes</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145143"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span id="local-6989586621679144138"><span class="annot"><a href="Database.Persist.Sqlite.html#withStmt%27"><span class="hs-identifier hs-type">withStmt'</span></a></span><span>
</span><span id="line-415"></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144138"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-416"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Sqlite.Internal.html#Connection"><span class="hs-identifier hs-type">Sqlite.Connection</span></a></span><span>
</span><span id="line-417"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Sqlite.Internal.html#Statement"><span class="hs-identifier hs-type">Sqlite.Statement</span></a></span><span>
</span><span id="line-418"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PersistValue</span></span><span class="hs-special">]</span><span>
</span><span id="line-419"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Acquire</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConduitM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PersistValue</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679144138"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-420"></span><span id="withStmt%27"><span class="annot"><span class="annottext">withStmt' :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Connection
-&gt; Statement
-&gt; [PersistValue]
-&gt; Acquire (ConduitM () [PersistValue] m ())
</span><a href="Database.Persist.Sqlite.html#withStmt%27"><span class="hs-identifier hs-var hs-var">withStmt'</span></a></span></span><span> </span><span id="local-6989586621679145165"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145165"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679145166"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145166"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span id="local-6989586621679145167"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145167"><span class="hs-identifier hs-var">vals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">Statement
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Statement -&gt; (Statement -&gt; IO ()) -&gt; Acquire Statement
forall a. IO a -&gt; (a -&gt; IO ()) -&gt; Acquire a
</span><span class="hs-identifier hs-var">mkAcquire</span></span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Statement -&gt; [PersistValue] -&gt; IO ()
</span><a href="Database.Sqlite.html#bind"><span class="hs-identifier hs-var">Sqlite.bind</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145166"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145167"><span class="hs-identifier hs-var">vals</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO Statement -&gt; IO Statement
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Statement -&gt; IO Statement
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145166"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Statement -&gt; IO ()
</span><a href="Database.Sqlite.html#reset"><span class="hs-identifier hs-var">Sqlite.reset</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145165"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><span class="annottext">ConduitM () [PersistValue] m ()
-&gt; Acquire (ConduitM () [PersistValue] m ())
forall a. a -&gt; Acquire a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ConduitM () [PersistValue] m ()
</span><a href="#local-6989586621679145168"><span class="hs-identifier hs-var">pull</span></a></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-426"></span><span>    </span><span id="local-6989586621679145168"><span class="annot"><span class="annottext">pull :: ConduitM () [PersistValue] m ()
</span><a href="#local-6989586621679145168"><span class="hs-identifier hs-var hs-var">pull</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>        </span><span id="local-6989586621679145169"><span class="annot"><span class="annottext">StepResult
</span><a href="#local-6989586621679145169"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO StepResult -&gt; ConduitT () [PersistValue] m StepResult
forall a. IO a -&gt; ConduitT () [PersistValue] m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO StepResult -&gt; ConduitT () [PersistValue] m StepResult)
-&gt; IO StepResult -&gt; ConduitT () [PersistValue] m StepResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Statement -&gt; IO StepResult
</span><a href="Database.Sqlite.html#stepConn"><span class="hs-identifier hs-var">Sqlite.stepConn</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679145165"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145166"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StepResult
</span><a href="#local-6989586621679145169"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-429"></span><span>            </span><span class="annot"><span class="annottext">StepResult
</span><a href="Database.Sqlite.html#Done"><span class="hs-identifier hs-var">Sqlite.Done</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ConduitM () [PersistValue] m ()
forall a. a -&gt; ConduitT () [PersistValue] m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>            </span><span class="annot"><span class="annottext">StepResult
</span><a href="Database.Sqlite.html#Row"><span class="hs-identifier hs-var">Sqlite.Row</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-431"></span><span>                </span><span id="local-6989586621679145172"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145172"><span class="hs-identifier hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [PersistValue] -&gt; ConduitT () [PersistValue] m [PersistValue]
forall a. IO a -&gt; ConduitT () [PersistValue] m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [PersistValue] -&gt; ConduitT () [PersistValue] m [PersistValue])
-&gt; IO [PersistValue] -&gt; ConduitT () [PersistValue] m [PersistValue]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Statement -&gt; IO [PersistValue]
</span><a href="Database.Sqlite.html#columns"><span class="hs-identifier hs-var">Sqlite.columns</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145166"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-432"></span><span>                </span><span class="annot"><span class="annottext">[PersistValue] -&gt; ConduitM () [PersistValue] m ()
forall (m :: * -&gt; *) o i. Monad m =&gt; o -&gt; ConduitT i o m ()
</span><span class="hs-identifier hs-var">yield</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145172"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-433"></span><span>                </span><span class="annot"><span class="annottext">ConduitM () [PersistValue] m ()
</span><a href="#local-6989586621679145168"><span class="hs-identifier hs-var">pull</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-type">showSqlType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-436"></span><span id="showSqlType"><span class="annot"><span class="annottext">showSqlType :: SqlType -&gt; Text
</span><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var hs-var">showSqlType</span></a></span></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier hs-var">SqlString</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;VARCHAR&quot;</span></span><span>
</span><span id="line-437"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier hs-var">SqlInt32</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;INTEGER&quot;</span></span><span>
</span><span id="line-438"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier hs-var">SqlInt64</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;INTEGER&quot;</span></span><span>
</span><span id="line-439"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier hs-var">SqlReal</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;REAL&quot;</span></span><span>
</span><span id="line-440"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SqlNumeric</span></span><span> </span><span id="local-6989586621679145181"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679145181"><span class="hs-identifier hs-var">precision</span></a></span></span><span> </span><span id="local-6989586621679145182"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679145182"><span class="hs-identifier hs-var">scale</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;NUMERIC(&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679145181"><span class="hs-identifier hs-var">precision</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679145182"><span class="hs-identifier hs-var">scale</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-441"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier hs-var">SqlDay</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DATE&quot;</span></span><span>
</span><span id="line-442"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier hs-var">SqlTime</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TIME&quot;</span></span><span>
</span><span id="line-443"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier hs-var">SqlDayTime</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TIMESTAMP&quot;</span></span><span>
</span><span id="line-444"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier hs-var">SqlBlob</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;BLOB&quot;</span></span><span>
</span><span id="line-445"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier hs-var">SqlBool</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;BOOLEAN&quot;</span></span><span>
</span><span id="line-446"></span><span class="annot"><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SqlOther</span></span><span> </span><span id="local-6989586621679145190"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145190"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145190"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="annot"><a href="Database.Persist.Sqlite.html#sqliteMkColumns"><span class="hs-identifier hs-type">sqliteMkColumns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Column</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">UniqueDef</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ForeignDef</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span id="sqliteMkColumns"><span class="annot"><span class="annottext">sqliteMkColumns :: [EntityDef] -&gt; EntityDef -&gt; ([Column], [UniqueDef], [ForeignDef])
</span><a href="Database.Persist.Sqlite.html#sqliteMkColumns"><span class="hs-identifier hs-var hs-var">sqliteMkColumns</span></a></span></span><span> </span><span id="local-6989586621679145192"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679145192"><span class="hs-identifier hs-var">allDefs</span></a></span></span><span> </span><span id="local-6989586621679145193"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145193"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EntityDef]
-&gt; EntityDef
-&gt; BackendSpecificOverrides
-&gt; ([Column], [UniqueDef], [ForeignDef])
</span><span class="hs-identifier hs-var">mkColumns</span></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679145192"><span class="hs-identifier hs-var">allDefs</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145193"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSpecificOverrides
</span><span class="hs-identifier hs-var">emptyBackendSpecificOverrides</span></span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span class="annot"><a href="Database.Persist.Sqlite.html#migrate%27"><span class="hs-identifier hs-type">migrate'</span></a></span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span class="hs-special">]</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Statement</span></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CautiousMigration</span></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span id="migrate%27"><span class="annot"><span class="annottext">migrate' :: [EntityDef]
-&gt; (Text -&gt; IO Statement)
-&gt; EntityDef
-&gt; IO (Either [Text] [(Bool, Text)])
</span><a href="Database.Persist.Sqlite.html#migrate%27"><span class="hs-identifier hs-var hs-var">migrate'</span></a></span></span><span> </span><span id="local-6989586621679145197"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679145197"><span class="hs-identifier hs-var">allDefs</span></a></span></span><span> </span><span id="local-6989586621679145198"><span class="annot"><span class="annottext">Text -&gt; IO Statement
</span><a href="#local-6989586621679145198"><span class="hs-identifier hs-var">getter</span></a></span></span><span> </span><span id="local-6989586621679145199"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145199"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679145200"><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145200"><span class="hs-identifier hs-var">cols</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145201"><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679145201"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145202"><span class="annot"><span class="annottext">[ForeignDef]
</span><a href="#local-6989586621679145202"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EntityDef] -&gt; EntityDef -&gt; ([Column], [UniqueDef], [ForeignDef])
</span><a href="Database.Persist.Sqlite.html#sqliteMkColumns"><span class="hs-identifier hs-var">sqliteMkColumns</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679145197"><span class="hs-identifier hs-var">allDefs</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145199"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679145203"><span class="annot"><span class="annottext">newSql :: Text
</span><a href="#local-6989586621679145203"><span class="hs-identifier hs-var hs-var">newSql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; EntityDef -&gt; ([Column], [UniqueDef], [ForeignDef]) -&gt; Text
</span><a href="Database.Persist.Sqlite.html#mkCreateTable"><span class="hs-identifier hs-var">mkCreateTable</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145205"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Column -&gt; Bool) -&gt; [Column] -&gt; [Column]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Column -&gt; Bool) -&gt; Column -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; FieldNameDB -&gt; Bool
</span><a href="Database.Persist.Sqlite.html#safeToRemove"><span class="hs-identifier hs-var">safeToRemove</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145199"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Bool) -&gt; (Column -&gt; FieldNameDB) -&gt; Column -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Column -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">cName</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145200"><span class="hs-identifier hs-var">cols</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679145201"><span class="hs-identifier hs-var">uniqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ForeignDef]
</span><a href="#local-6989586621679145202"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>    </span><span id="local-6989586621679145209"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145209"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Statement
</span><a href="#local-6989586621679145198"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SELECT sql FROM sqlite_master WHERE type='table' AND name=?&quot;</span></span><span>
</span><span id="line-460"></span><span>    </span><span id="local-6989586621679145210"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145210"><span class="hs-identifier hs-var">oldSql'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Acquire (ConduitM () [PersistValue] IO ())
-&gt; (ConduitM () [PersistValue] IO () -&gt; IO (Maybe Text))
-&gt; IO (Maybe Text)
forall (m :: * -&gt; *) a b.
MonadUnliftIO m =&gt;
Acquire a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">with</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Statement
-&gt; forall (m :: * -&gt; *).
   MonadIO m =&gt;
   [PersistValue] -&gt; Acquire (ConduitM () [PersistValue] m ())
</span><span class="hs-identifier hs-var">stmtQuery</span></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145209"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; PersistValue
</span><span class="hs-identifier hs-var">PersistText</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; PersistValue) -&gt; Text -&gt; PersistValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><span class="hs-identifier hs-var">unEntityNameDB</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145212"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679145213"><span class="annot"><span class="annottext">ConduitM () [PersistValue] IO ()
</span><a href="#local-6989586621679145213"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConduitT () Void IO (Maybe Text) -&gt; IO (Maybe Text)
forall (m :: * -&gt; *) r. Monad m =&gt; ConduitT () Void m r -&gt; m r
</span><span class="hs-identifier hs-var">runConduit</span></span><span> </span><span class="annot"><span class="annottext">(ConduitT () Void IO (Maybe Text) -&gt; IO (Maybe Text))
-&gt; ConduitT () Void IO (Maybe Text) -&gt; IO (Maybe Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConduitM () [PersistValue] IO ()
</span><a href="#local-6989586621679145213"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitM () [PersistValue] IO ()
-&gt; ConduitT [PersistValue] Void IO (Maybe Text)
-&gt; ConduitT () Void IO (Maybe Text)
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">ConduitT [PersistValue] Void IO (Maybe Text)
forall {o}. ConduitT [PersistValue] o IO (Maybe Text)
</span><a href="#local-6989586621679145216"><span class="hs-identifier hs-var">go</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145210"><span class="hs-identifier hs-var">oldSql'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-463"></span><span>        </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either [Text] [(Bool, Text)] -&gt; IO (Either [Text] [(Bool, Text)])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either [Text] [(Bool, Text)] -&gt; IO (Either [Text] [(Bool, Text)]))
-&gt; Either [Text] [(Bool, Text)]
-&gt; IO (Either [Text] [(Bool, Text)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Bool, Text)] -&gt; Either [Text] [(Bool, Text)]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145203"><span class="hs-identifier hs-var">newSql</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-464"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679145217"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145217"><span class="hs-identifier hs-var">oldSql</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-465"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145217"><span class="hs-identifier hs-var">oldSql</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145203"><span class="hs-identifier hs-var">newSql</span></a></span><span>
</span><span id="line-466"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Either [Text] [(Bool, Text)] -&gt; IO (Either [Text] [(Bool, Text)])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either [Text] [(Bool, Text)] -&gt; IO (Either [Text] [(Bool, Text)]))
-&gt; Either [Text] [(Bool, Text)]
-&gt; IO (Either [Text] [(Bool, Text)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Bool, Text)] -&gt; Either [Text] [(Bool, Text)]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-467"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-468"></span><span>                    </span><span id="local-6989586621679145218"><span class="annot"><span class="annottext">[(Bool, Text)]
</span><a href="#local-6989586621679145218"><span class="hs-identifier hs-var">sql</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[EntityDef]
-&gt; (Text -&gt; IO Statement) -&gt; EntityDef -&gt; IO [(Bool, Text)]
</span><a href="Database.Persist.Sqlite.html#getCopyTable"><span class="hs-identifier hs-var">getCopyTable</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679145197"><span class="hs-identifier hs-var">allDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Statement
</span><a href="#local-6989586621679145198"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145199"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-469"></span><span>                    </span><span class="annot"><span class="annottext">Either [Text] [(Bool, Text)] -&gt; IO (Either [Text] [(Bool, Text)])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either [Text] [(Bool, Text)] -&gt; IO (Either [Text] [(Bool, Text)]))
-&gt; Either [Text] [(Bool, Text)]
-&gt; IO (Either [Text] [(Bool, Text)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Bool, Text)] -&gt; Either [Text] [(Bool, Text)]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">[(Bool, Text)]
</span><a href="#local-6989586621679145218"><span class="hs-identifier hs-var">sql</span></a></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621679145205"><span class="annot"><span class="annottext">def :: EntityDef
</span><a href="#local-6989586621679145205"><span class="hs-identifier hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145199"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-472"></span><span>    </span><span id="local-6989586621679145212"><span class="annot"><span class="annottext">table :: EntityNameDB
</span><a href="#local-6989586621679145212"><span class="hs-identifier hs-var hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145205"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-473"></span><span>    </span><span id="local-6989586621679145216"><span class="annot"><span class="annottext">go :: ConduitT [PersistValue] o IO (Maybe Text)
</span><a href="#local-6989586621679145216"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-474"></span><span>        </span><span id="local-6989586621679145237"><span class="annot"><span class="annottext">Maybe [PersistValue]
</span><a href="#local-6989586621679145237"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConduitT [PersistValue] o IO (Maybe [PersistValue])
forall (m :: * -&gt; *) a o. Monad m =&gt; ConduitT a o m (Maybe a)
</span><span class="hs-identifier hs-var">CL.head</span></span><span>
</span><span id="line-475"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [PersistValue]
</span><a href="#local-6989586621679145237"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-476"></span><span>            </span><span class="annot"><span class="annottext">Maybe [PersistValue]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; ConduitT [PersistValue] o IO (Maybe Text)
forall a. a -&gt; ConduitT [PersistValue] o IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-477"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PersistText</span></span><span> </span><span id="local-6989586621679145239"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145239"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; ConduitT [PersistValue] o IO (Maybe Text)
forall a. a -&gt; ConduitT [PersistValue] o IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; ConduitT [PersistValue] o IO (Maybe Text))
-&gt; Maybe Text -&gt; ConduitT [PersistValue] o IO (Maybe Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145239"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-478"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679145240"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145240"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ConduitT [PersistValue] o IO (Maybe Text)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ConduitT [PersistValue] o IO (Maybe Text))
-&gt; String -&gt; ConduitT [PersistValue] o IO (Maybe Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected result from sqlite_master: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145240"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="hs-comment">-- | Mock a migration even when the database is not present.</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- This function performs the same functionality of 'printMigration'</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- with the difference that an actual database isn't needed for it.</span><span>
</span><span id="line-483"></span><span class="annot"><a href="Database.Persist.Sqlite.html#mockMigration"><span class="hs-identifier hs-type">mockMigration</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Migration</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span id="mockMigration"><span class="annot"><span class="annottext">mockMigration :: Migration -&gt; IO ()
</span><a href="Database.Persist.Sqlite.html#mockMigration"><span class="hs-identifier hs-var hs-var">mockMigration</span></a></span></span><span> </span><span id="local-6989586621679145243"><span class="annot"><span class="annottext">Migration
</span><a href="#local-6989586621679145243"><span class="hs-identifier hs-var">mig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-485"></span><span>    </span><span id="local-6989586621679145244"><span class="annot"><span class="annottext">IORef (Map Text Statement)
</span><a href="#local-6989586621679145244"><span class="hs-identifier hs-var">smap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Text Statement -&gt; IO (IORef (Map Text Statement))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Map Text Statement
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-486"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679145245"><span class="annot"><span class="annottext">sqlbackend :: SqlBackend
</span><a href="#local-6989586621679145245"><span class="hs-identifier hs-var hs-var">sqlbackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-487"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; SqlBackend -&gt; SqlBackend
</span><span class="hs-identifier hs-var">setConnMaxParams</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">999</span></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; SqlBackend) -&gt; SqlBackend -&gt; SqlBackend
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-488"></span><span>            </span><span class="annot"><span class="annottext">MkSqlBackendArgs -&gt; SqlBackend
</span><span class="hs-identifier hs-var">mkSqlBackend</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MkSqlBackendArgs</span></span><span>
</span><span id="line-489"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">connPrepare :: Text -&gt; IO Statement
</span><span class="hs-identifier hs-var">connPrepare</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-490"></span><span>                    </span><span class="annot"><span class="annottext">Statement -&gt; IO Statement
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Statement</span></span><span>
</span><span id="line-491"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stmtFinalize :: IO ()
</span><span class="hs-identifier hs-var">stmtFinalize</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stmtReset :: IO ()
</span><span class="hs-identifier hs-var">stmtReset</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stmtExecute :: [PersistValue] -&gt; IO Int64
</span><span class="hs-identifier hs-var">stmtExecute</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PersistValue] -&gt; IO Int64
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-494"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stmtQuery :: forall (m :: * -&gt; *).
MonadIO m =&gt;
[PersistValue] -&gt; Acquire (ConduitM () [PersistValue] m ())
</span><span class="hs-identifier hs-var">stmtQuery</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[PersistValue]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConduitM () [PersistValue] m ()
-&gt; Acquire (ConduitM () [PersistValue] m ())
forall a. a -&gt; Acquire a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ConduitM () [PersistValue] m ()
 -&gt; Acquire (ConduitM () [PersistValue] m ()))
-&gt; ConduitM () [PersistValue] m ()
-&gt; Acquire (ConduitM () [PersistValue] m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; ConduitM () [PersistValue] m ()
forall a. a -&gt; ConduitT () [PersistValue] m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-496"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connStmtMap :: IORef (Map Text Statement)
</span><span class="hs-identifier hs-var">connStmtMap</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Map Text Statement)
</span><a href="#local-6989586621679145244"><span class="hs-identifier hs-var">smap</span></a></span><span>
</span><span id="line-497"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connInsertSql :: EntityDef -&gt; [PersistValue] -&gt; InsertSqlResult
</span><span class="hs-identifier hs-var">connInsertSql</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [PersistValue] -&gt; InsertSqlResult
</span><a href="Database.Persist.Sqlite.html#insertSql%27"><span class="hs-identifier hs-var">insertSql'</span></a></span><span>
</span><span id="line-498"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connClose :: IO ()
</span><span class="hs-identifier hs-var">connClose</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-499"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connMigrateSql :: [EntityDef]
-&gt; (Text -&gt; IO Statement)
-&gt; EntityDef
-&gt; IO (Either [Text] [(Bool, Text)])
</span><span class="hs-identifier hs-var">connMigrateSql</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EntityDef]
-&gt; (Text -&gt; IO Statement)
-&gt; EntityDef
-&gt; IO (Either [Text] [(Bool, Text)])
</span><a href="Database.Persist.Sqlite.html#migrate%27"><span class="hs-identifier hs-var">migrate'</span></a></span><span>
</span><span id="line-500"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connBegin :: (Text -&gt; IO Statement) -&gt; Maybe IsolationLevel -&gt; IO ()
</span><span class="hs-identifier hs-var">connBegin</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679145250"><span class="annot"><span class="annottext">Text -&gt; IO Statement
</span><a href="#local-6989586621679145250"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe IsolationLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; IO Statement) -&gt; IO ()
forall {t}. t -&gt; (t -&gt; IO Statement) -&gt; IO ()
</span><a href="#local-6989586621679145251"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;BEGIN&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Statement
</span><a href="#local-6989586621679145250"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-501"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connCommit :: (Text -&gt; IO Statement) -&gt; IO ()
</span><span class="hs-identifier hs-var">connCommit</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; IO Statement) -&gt; IO ()
forall {t}. t -&gt; (t -&gt; IO Statement) -&gt; IO ()
</span><a href="#local-6989586621679145251"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;COMMIT&quot;</span></span><span>
</span><span id="line-502"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connRollback :: (Text -&gt; IO Statement) -&gt; IO ()
</span><span class="hs-identifier hs-var">connRollback</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="#local-6989586621679145252"><span class="hs-identifier hs-var">ignoreExceptions</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ())
-&gt; ((Text -&gt; IO Statement) -&gt; IO ())
-&gt; (Text -&gt; IO Statement)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; IO Statement) -&gt; IO ()
forall {t}. t -&gt; (t -&gt; IO Statement) -&gt; IO ()
</span><a href="#local-6989586621679145251"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ROLLBACK&quot;</span></span><span>
</span><span id="line-503"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connEscapeFieldName :: FieldNameDB -&gt; Text
</span><span class="hs-identifier hs-var">connEscapeFieldName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (FieldNameDB -&gt; Text) -&gt; FieldNameDB -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><span class="hs-identifier hs-var">unFieldNameDB</span></span><span>
</span><span id="line-504"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connEscapeTableName :: EntityDef -&gt; Text
</span><span class="hs-identifier hs-var">connEscapeTableName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (EntityDef -&gt; Text) -&gt; EntityDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><span class="hs-identifier hs-var">unEntityNameDB</span></span><span> </span><span class="annot"><span class="annottext">(EntityNameDB -&gt; Text)
-&gt; (EntityDef -&gt; EntityNameDB) -&gt; EntityDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span>
</span><span id="line-505"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connEscapeRawName :: Text -&gt; Text
</span><span class="hs-identifier hs-var">connEscapeRawName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var">escape</span></a></span><span>
</span><span id="line-506"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connNoLimit :: Text
</span><span class="hs-identifier hs-var">connNoLimit</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;LIMIT -1&quot;</span></span><span>
</span><span id="line-507"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connRDBMS :: Text
</span><span class="hs-identifier hs-var">connRDBMS</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sqlite&quot;</span></span><span>
</span><span id="line-508"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connLimitOffset :: CharPos -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">connLimitOffset</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; CharPos -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">decorateSQLWithLimitOffset</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;LIMIT -1&quot;</span></span><span>
</span><span id="line-509"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connLogFunc :: LogFunc
</span><span class="hs-identifier hs-var">connLogFunc</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogFunc
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-510"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-511"></span><span>        </span><span id="local-6989586621679145253"><span class="annot"><span class="annottext">result :: SqlBackend -&gt; IO (((), [Text]), [(Bool, Text)])
</span><a href="#local-6989586621679145253"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT SqlBackend IO (((), [Text]), [(Bool, Text)])
-&gt; SqlBackend -&gt; IO (((), [Text]), [(Bool, Text)])
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">(ReaderT SqlBackend IO (((), [Text]), [(Bool, Text)])
 -&gt; SqlBackend -&gt; IO (((), [Text]), [(Bool, Text)]))
-&gt; (Migration
    -&gt; ReaderT SqlBackend IO (((), [Text]), [(Bool, Text)]))
-&gt; Migration
-&gt; SqlBackend
-&gt; IO (((), [Text]), [(Bool, Text)])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WriterT [(Bool, Text)] (ReaderT SqlBackend IO) ((), [Text])
-&gt; ReaderT SqlBackend IO (((), [Text]), [(Bool, Text)])
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">runWriterT</span></span><span> </span><span class="annot"><span class="annottext">(WriterT [(Bool, Text)] (ReaderT SqlBackend IO) ((), [Text])
 -&gt; ReaderT SqlBackend IO (((), [Text]), [(Bool, Text)]))
-&gt; (Migration
    -&gt; WriterT [(Bool, Text)] (ReaderT SqlBackend IO) ((), [Text]))
-&gt; Migration
-&gt; ReaderT SqlBackend IO (((), [Text]), [(Bool, Text)])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Migration
-&gt; WriterT [(Bool, Text)] (ReaderT SqlBackend IO) ((), [Text])
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">runWriterT</span></span><span> </span><span class="annot"><span class="annottext">(Migration -&gt; SqlBackend -&gt; IO (((), [Text]), [(Bool, Text)]))
-&gt; Migration -&gt; SqlBackend -&gt; IO (((), [Text]), [(Bool, Text)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Migration
</span><a href="#local-6989586621679145243"><span class="hs-identifier hs-var">mig</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span id="local-6989586621679145254"><span class="annot"><span class="annottext">(((), [Text]), [(Bool, Text)])
</span><a href="#local-6989586621679145254"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; IO (((), [Text]), [(Bool, Text)])
</span><a href="#local-6989586621679145253"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679145245"><span class="hs-identifier hs-var">sqlbackend</span></a></span><span>
</span><span id="line-513"></span><span>    </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; [Text] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">TIO.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; IO ()) -&gt; [Text] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Bool, Text) -&gt; Text) -&gt; [(Bool, Text)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Bool, Text) -&gt; Text
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Bool, Text)] -&gt; [Text]) -&gt; [(Bool, Text)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(((), [Text]), [(Bool, Text)]) -&gt; [(Bool, Text)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(((), [Text]), [(Bool, Text)])
</span><a href="#local-6989586621679145254"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-515"></span><span>    </span><span id="local-6989586621679145251"><span class="annot"><span class="annottext">helper :: t -&gt; (t -&gt; IO Statement) -&gt; IO ()
</span><a href="#local-6989586621679145251"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span id="local-6989586621679145260"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679145260"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679145261"><span class="annot"><span class="annottext">t -&gt; IO Statement
</span><a href="#local-6989586621679145261"><span class="hs-identifier hs-var">getter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-516"></span><span>        </span><span id="local-6989586621679145262"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145262"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t -&gt; IO Statement
</span><a href="#local-6989586621679145261"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679145260"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Statement -&gt; [PersistValue] -&gt; IO Int64
</span><span class="hs-identifier hs-var">stmtExecute</span></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145262"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-518"></span><span>        </span><span class="annot"><span class="annottext">Statement -&gt; IO ()
</span><span class="hs-identifier hs-var">stmtReset</span></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145262"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-519"></span><span>    </span><span id="local-6989586621679145252"><span class="annot"><span class="annottext">ignoreExceptions :: IO () -&gt; IO ()
</span><a href="#local-6989586621679145252"><span class="hs-identifier hs-var hs-var">ignoreExceptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-520"></span><span>        </span><span class="annot"><span class="annottext">(SomeException -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">E.handle</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.SomeException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="hs-comment">-- | Check if a column name is listed as the &quot;safe to remove&quot; in the entity</span><span>
</span><span id="line-523"></span><span class="hs-comment">-- list.</span><span>
</span><span id="line-524"></span><span class="annot"><a href="Database.Persist.Sqlite.html#safeToRemove"><span class="hs-identifier hs-type">safeToRemove</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FieldNameDB</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-525"></span><span id="safeToRemove"><span class="annot"><span class="annottext">safeToRemove :: EntityDef -&gt; FieldNameDB -&gt; Bool
</span><a href="Database.Persist.Sqlite.html#safeToRemove"><span class="hs-identifier hs-var hs-var">safeToRemove</span></a></span></span><span> </span><span id="local-6989586621679145265"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145265"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FieldNameDB</span></span><span> </span><span id="local-6989586621679145267"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145267"><span class="hs-identifier hs-var">colName</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; Bool) -&gt; [FieldDef] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldAttr -&gt; [FieldAttr] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">elem</span></span><span> </span><span class="annot"><span class="annottext">FieldAttr
</span><span class="hs-identifier hs-var">FieldAttrSafeToRemove</span></span><span> </span><span class="annot"><span class="annottext">([FieldAttr] -&gt; Bool)
-&gt; (FieldDef -&gt; [FieldAttr]) -&gt; FieldDef -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; [FieldAttr]
</span><span class="hs-identifier hs-var">fieldAttrs</span></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><span class="annottext">([FieldDef] -&gt; Bool) -&gt; [FieldDef] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; Bool) -&gt; [FieldDef] -&gt; [FieldDef]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameDB -&gt; FieldNameDB -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">FieldNameDB</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145267"><span class="hs-identifier hs-var">colName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Bool)
-&gt; (FieldDef -&gt; FieldNameDB) -&gt; FieldDef -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">fieldDB</span></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>    </span><span class="annot"><span class="annottext">([FieldDef] -&gt; [FieldDef]) -&gt; [FieldDef] -&gt; [FieldDef]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145272"><span class="hs-identifier hs-var">allEntityFields</span></a></span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-530"></span><span>    </span><span id="local-6989586621679145272"><span class="annot"><span class="annottext">allEntityFields :: [FieldDef]
</span><a href="#local-6989586621679145272"><span class="hs-identifier hs-var hs-var">allEntityFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-531"></span><span>        </span><span class="annot"><span class="annottext">EntityDef -&gt; [FieldDef]
</span><span class="hs-identifier hs-var">getEntityFieldsDatabase</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145265"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldDef] -&gt; [FieldDef] -&gt; [FieldDef]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityIdDef
</span><span class="hs-identifier hs-var">getEntityId</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145265"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-532"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">EntityIdField</span></span><span> </span><span id="local-6989586621679145274"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679145274"><span class="hs-identifier hs-var">fdef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-533"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679145274"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-534"></span><span>            </span><span class="annot"><span class="annottext">EntityIdDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-535"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="annot"><a href="Database.Persist.Sqlite.html#getCopyTable"><span class="hs-identifier hs-type">getCopyTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span class="hs-special">]</span><span>
</span><span id="line-538"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Statement</span></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span>
</span><span id="line-540"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-541"></span><span id="getCopyTable"><span class="annot"><span class="annottext">getCopyTable :: [EntityDef]
-&gt; (Text -&gt; IO Statement) -&gt; EntityDef -&gt; IO [(Bool, Text)]
</span><a href="Database.Persist.Sqlite.html#getCopyTable"><span class="hs-identifier hs-var hs-var">getCopyTable</span></a></span></span><span> </span><span id="local-6989586621679145275"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679145275"><span class="hs-identifier hs-var">allDefs</span></a></span></span><span> </span><span id="local-6989586621679145276"><span class="annot"><span class="annottext">Text -&gt; IO Statement
</span><a href="#local-6989586621679145276"><span class="hs-identifier hs-var">getter</span></a></span></span><span> </span><span id="local-6989586621679145277"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145277"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-542"></span><span>    </span><span id="local-6989586621679145278"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145278"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO Statement
</span><a href="#local-6989586621679145276"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO Statement) -&gt; Text -&gt; IO Statement
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;PRAGMA table_info(&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145279"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-543"></span><span>    </span><span id="local-6989586621679145280"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145280"><span class="hs-identifier hs-var">oldCols'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Acquire (ConduitM () [PersistValue] IO ())
-&gt; (ConduitM () [PersistValue] IO () -&gt; IO [Text]) -&gt; IO [Text]
forall (m :: * -&gt; *) a b.
MonadUnliftIO m =&gt;
Acquire a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">with</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Statement
-&gt; forall (m :: * -&gt; *).
   MonadIO m =&gt;
   [PersistValue] -&gt; Acquire (ConduitM () [PersistValue] m ())
</span><span class="hs-identifier hs-var">stmtQuery</span></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679145278"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679145281"><span class="annot"><span class="annottext">ConduitM () [PersistValue] IO ()
</span><a href="#local-6989586621679145281"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConduitT () Void IO [Text] -&gt; IO [Text]
forall (m :: * -&gt; *) r. Monad m =&gt; ConduitT () Void m r -&gt; m r
</span><span class="hs-identifier hs-var">runConduit</span></span><span> </span><span class="annot"><span class="annottext">(ConduitT () Void IO [Text] -&gt; IO [Text])
-&gt; ConduitT () Void IO [Text] -&gt; IO [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConduitM () [PersistValue] IO ()
</span><a href="#local-6989586621679145281"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitM () [PersistValue] IO ()
-&gt; ConduitT [PersistValue] Void IO [Text]
-&gt; ConduitT () Void IO [Text]
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">ConduitT [PersistValue] Void IO [Text]
forall {o}. ConduitT [PersistValue] o IO [Text]
</span><a href="#local-6989586621679145282"><span class="hs-identifier hs-var">getCols</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679145283"><span class="annot"><span class="annottext">oldCols :: [FieldNameDB]
</span><a href="#local-6989586621679145283"><span class="hs-identifier hs-var hs-var">oldCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FieldNameDB) -&gt; [Text] -&gt; [FieldNameDB]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">FieldNameDB</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145280"><span class="hs-identifier hs-var">oldCols'</span></a></span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679145284"><span class="annot"><span class="annottext">newCols :: [FieldNameDB]
</span><a href="#local-6989586621679145284"><span class="hs-identifier hs-var hs-var">newCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Bool) -&gt; [FieldNameDB] -&gt; [FieldNameDB]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (FieldNameDB -&gt; Bool) -&gt; FieldNameDB -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; FieldNameDB -&gt; Bool
</span><a href="Database.Persist.Sqlite.html#safeToRemove"><span class="hs-identifier hs-var">safeToRemove</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145277"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FieldNameDB] -&gt; [FieldNameDB]) -&gt; [FieldNameDB] -&gt; [FieldNameDB]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Column -&gt; FieldNameDB) -&gt; [Column] -&gt; [FieldNameDB]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Column -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">cName</span></span><span> </span><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145285"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679145286"><span class="annot"><span class="annottext">common :: [FieldNameDB]
</span><a href="#local-6989586621679145286"><span class="hs-identifier hs-var hs-var">common</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Bool) -&gt; [FieldNameDB] -&gt; [FieldNameDB]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameDB -&gt; [FieldNameDB] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145283"><span class="hs-identifier hs-var">oldCols</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145284"><span class="hs-identifier hs-var">newCols</span></a></span><span>
</span><span id="line-547"></span><span>    </span><span class="annot"><span class="annottext">[(Bool, Text)] -&gt; IO [(Bool, Text)]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145287"><span class="hs-identifier hs-var">tmpSql</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FieldNameDB] -&gt; Text
</span><a href="#local-6989586621679145288"><span class="hs-identifier hs-var">copyToTemp</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145286"><span class="hs-identifier hs-var">common</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145286"><span class="hs-identifier hs-var">common</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldNameDB] -&gt; [FieldNameDB] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Bool) -&gt; [FieldNameDB] -&gt; [FieldNameDB]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (FieldNameDB -&gt; Bool) -&gt; FieldNameDB -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; FieldNameDB -&gt; Bool
</span><a href="Database.Persist.Sqlite.html#safeToRemove"><span class="hs-identifier hs-var">safeToRemove</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145277"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145283"><span class="hs-identifier hs-var">oldCols</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145290"><span class="hs-identifier hs-var">dropOld</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145291"><span class="hs-identifier hs-var">newSql</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FieldNameDB] -&gt; Text
</span><a href="#local-6989586621679145292"><span class="hs-identifier hs-var">copyToFinal</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145284"><span class="hs-identifier hs-var">newCols</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145293"><span class="hs-identifier hs-var">dropTmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>           </span><span class="hs-special">]</span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-555"></span><span>    </span><span id="local-6989586621679145282"><span class="annot"><span class="annottext">getCols :: ConduitT [PersistValue] o IO [Text]
</span><a href="#local-6989586621679145282"><span class="hs-identifier hs-var hs-var">getCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-556"></span><span>        </span><span id="local-6989586621679145307"><span class="annot"><span class="annottext">Maybe [PersistValue]
</span><a href="#local-6989586621679145307"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConduitT [PersistValue] o IO (Maybe [PersistValue])
forall (m :: * -&gt; *) a o. Monad m =&gt; ConduitT a o m (Maybe a)
</span><span class="hs-identifier hs-var">CL.head</span></span><span>
</span><span id="line-557"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [PersistValue]
</span><a href="#local-6989586621679145307"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-558"></span><span>            </span><span class="annot"><span class="annottext">Maybe [PersistValue]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; ConduitT [PersistValue] o IO [Text]
forall a. a -&gt; ConduitT [PersistValue] o IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-559"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PersistValue
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="hs-identifier hs-type">PersistText</span></span><span> </span><span id="local-6989586621679145308"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145308"><span class="hs-identifier hs-var">name</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[PersistValue]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-560"></span><span>                </span><span id="local-6989586621679145309"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145309"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConduitT [PersistValue] o IO [Text]
</span><a href="#local-6989586621679145282"><span class="hs-identifier hs-var">getCols</span></a></span><span>
</span><span id="line-561"></span><span>                </span><span class="annot"><span class="annottext">[Text] -&gt; ConduitT [PersistValue] o IO [Text]
forall a. a -&gt; ConduitT [PersistValue] o IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; ConduitT [PersistValue] o IO [Text])
-&gt; [Text] -&gt; ConduitT [PersistValue] o IO [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145308"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145309"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-562"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679145310"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145310"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ConduitT [PersistValue] o IO [Text]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ConduitT [PersistValue] o IO [Text])
-&gt; String -&gt; ConduitT [PersistValue] o IO [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid result from PRAGMA table_info: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145310"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-563"></span><span>    </span><span id="local-6989586621679145279"><span class="annot"><span class="annottext">table :: EntityNameDB
</span><a href="#local-6989586621679145279"><span class="hs-identifier hs-var hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145277"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-564"></span><span>    </span><span id="local-6989586621679145311"><span class="annot"><span class="annottext">tableTmp :: EntityNameDB
</span><a href="#local-6989586621679145311"><span class="hs-identifier hs-var hs-var">tableTmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">EntityNameDB</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; EntityNameDB) -&gt; Text -&gt; EntityNameDB
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><span class="hs-identifier hs-var">unEntityNameDB</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145279"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_backup&quot;</span></span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679145285"><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145285"><span class="hs-identifier hs-var">cols</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145313"><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679145313"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145314"><span class="annot"><span class="annottext">[ForeignDef]
</span><a href="#local-6989586621679145314"><span class="hs-identifier hs-var">fdef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EntityDef] -&gt; EntityDef -&gt; ([Column], [UniqueDef], [ForeignDef])
</span><a href="Database.Persist.Sqlite.html#sqliteMkColumns"><span class="hs-identifier hs-var">sqliteMkColumns</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679145275"><span class="hs-identifier hs-var">allDefs</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145277"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-566"></span><span>    </span><span id="local-6989586621679145315"><span class="annot"><span class="annottext">cols' :: [Column]
</span><a href="#local-6989586621679145315"><span class="hs-identifier hs-var hs-var">cols'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Column -&gt; Bool) -&gt; [Column] -&gt; [Column]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Column -&gt; Bool) -&gt; Column -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; FieldNameDB -&gt; Bool
</span><a href="Database.Persist.Sqlite.html#safeToRemove"><span class="hs-identifier hs-var">safeToRemove</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145277"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Bool) -&gt; (Column -&gt; FieldNameDB) -&gt; Column -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Column -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">cName</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145285"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-567"></span><span>    </span><span id="local-6989586621679145291"><span class="annot"><span class="annottext">newSql :: Text
</span><a href="#local-6989586621679145291"><span class="hs-identifier hs-var hs-var">newSql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; EntityDef -&gt; ([Column], [UniqueDef], [ForeignDef]) -&gt; Text
</span><a href="Database.Persist.Sqlite.html#mkCreateTable"><span class="hs-identifier hs-var">mkCreateTable</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145277"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145315"><span class="hs-identifier hs-var">cols'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679145313"><span class="hs-identifier hs-var">uniqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ForeignDef]
</span><a href="#local-6989586621679145314"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>    </span><span id="local-6989586621679145287"><span class="annot"><span class="annottext">tmpSql :: Text
</span><a href="#local-6989586621679145287"><span class="hs-identifier hs-var hs-var">tmpSql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; EntityDef -&gt; ([Column], [UniqueDef], [ForeignDef]) -&gt; Text
</span><a href="Database.Persist.Sqlite.html#mkCreateTable"><span class="hs-identifier hs-var">mkCreateTable</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameDB -&gt; EntityDef -&gt; EntityDef
</span><span class="hs-identifier hs-var">setEntityDBName</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145311"><span class="hs-identifier hs-var">tableTmp</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145277"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145315"><span class="hs-identifier hs-var">cols'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679145313"><span class="hs-identifier hs-var">uniqs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>    </span><span id="local-6989586621679145293"><span class="annot"><span class="annottext">dropTmp :: Text
</span><a href="#local-6989586621679145293"><span class="hs-identifier hs-var hs-var">dropTmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DROP TABLE &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145311"><span class="hs-identifier hs-var">tableTmp</span></a></span><span>
</span><span id="line-570"></span><span>    </span><span id="local-6989586621679145290"><span class="annot"><span class="annottext">dropOld :: Text
</span><a href="#local-6989586621679145290"><span class="hs-identifier hs-var hs-var">dropOld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DROP TABLE &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145279"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span id="local-6989586621679145288"><span class="annot"><span class="annottext">copyToTemp :: [FieldNameDB] -&gt; Text
</span><a href="#local-6989586621679145288"><span class="hs-identifier hs-var hs-var">copyToTemp</span></a></span></span><span> </span><span id="local-6989586621679145317"><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145317"><span class="hs-identifier hs-var">common</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-572"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;INSERT INTO &quot;</span></span><span>
</span><span id="line-573"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145311"><span class="hs-identifier hs-var">tableTmp</span></a></span><span>
</span><span id="line-574"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(&quot;</span></span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text) -&gt; [FieldNameDB] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145317"><span class="hs-identifier hs-var">common</span></a></span><span>
</span><span id="line-576"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) SELECT &quot;</span></span><span>
</span><span id="line-577"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text) -&gt; [FieldNameDB] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145317"><span class="hs-identifier hs-var">common</span></a></span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; FROM &quot;</span></span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145279"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-580"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-581"></span><span>    </span><span id="local-6989586621679145292"><span class="annot"><span class="annottext">copyToFinal :: [FieldNameDB] -&gt; Text
</span><a href="#local-6989586621679145292"><span class="hs-identifier hs-var hs-var">copyToFinal</span></a></span></span><span> </span><span id="local-6989586621679145318"><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145318"><span class="hs-identifier hs-var">newCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-582"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;INSERT INTO &quot;</span></span><span>
</span><span id="line-583"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145279"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-584"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; SELECT &quot;</span></span><span>
</span><span id="line-585"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text) -&gt; [FieldNameDB] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldNameDB]
</span><a href="#local-6989586621679145318"><span class="hs-identifier hs-var">newCols</span></a></span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; FROM &quot;</span></span><span>
</span><span id="line-587"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145311"><span class="hs-identifier hs-var">tableTmp</span></a></span><span>
</span><span id="line-588"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span class="annot"><a href="Database.Persist.Sqlite.html#mkCreateTable"><span class="hs-identifier hs-type">mkCreateTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Column</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">UniqueDef</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ForeignDef</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-591"></span><span id="mkCreateTable"><span class="annot"><span class="annottext">mkCreateTable :: Bool -&gt; EntityDef -&gt; ([Column], [UniqueDef], [ForeignDef]) -&gt; Text
</span><a href="Database.Persist.Sqlite.html#mkCreateTable"><span class="hs-identifier hs-var hs-var">mkCreateTable</span></a></span></span><span> </span><span id="local-6989586621679145319"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145319"><span class="hs-identifier hs-var">isTemp</span></a></span></span><span> </span><span id="local-6989586621679145320"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145320"><span class="hs-identifier hs-var">entity</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679145321"><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145321"><span class="hs-identifier hs-var">cols</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145322"><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679145322"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145323"><span class="annot"><span class="annottext">[ForeignDef]
</span><a href="#local-6989586621679145323"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-592"></span><span>    </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145324"><span class="hs-identifier hs-var">header</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145325"><span class="hs-identifier hs-var">columns</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145326"><span class="hs-identifier hs-var">footer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-594"></span><span>    </span><span id="local-6989586621679145324"><span class="annot"><span class="annottext">header :: [Text]
</span><a href="#local-6989586621679145324"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-595"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;CREATE&quot;</span></span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145319"><span class="hs-identifier hs-var">isTemp</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; TEMP&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; TABLE &quot;</span></span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">(EntityNameDB -&gt; Text) -&gt; EntityNameDB -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145320"><span class="hs-identifier hs-var">entity</span></a></span><span>
</span><span id="line-599"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(&quot;</span></span><span>
</span><span id="line-600"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>    </span><span id="local-6989586621679145326"><span class="annot"><span class="annottext">footer :: [Text]
</span><a href="#local-6989586621679145326"><span class="hs-identifier hs-var hs-var">footer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(UniqueDef -&gt; Text) -&gt; [UniqueDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">UniqueDef -&gt; Text
</span><a href="Database.Persist.Sqlite.html#sqlUnique"><span class="hs-identifier hs-var">sqlUnique</span></a></span><span> </span><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679145322"><span class="hs-identifier hs-var">uniqs</span></a></span><span>
</span><span id="line-604"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ForeignDef -&gt; Text) -&gt; [ForeignDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; Text
</span><a href="Database.Persist.Sqlite.html#sqlForeign"><span class="hs-identifier hs-var">sqlForeign</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignDef]
</span><a href="#local-6989586621679145323"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-606"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span>    </span><span id="local-6989586621679145325"><span class="annot"><span class="annottext">columns :: [Text]
</span><a href="#local-6989586621679145325"><span class="hs-identifier hs-var hs-var">columns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityIdDef
</span><span class="hs-identifier hs-var">getEntityId</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145320"><span class="hs-identifier hs-var">entity</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-609"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">EntityIdNaturalKey</span></span><span> </span><span id="local-6989586621679145329"><span class="annot"><span class="annottext">CompositeDef
</span><a href="#local-6989586621679145329"><span class="hs-identifier hs-var">pdef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-610"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Column -&gt; Text) -&gt; [Column] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Column -&gt; Text
</span><a href="Database.Persist.Sqlite.html#sqlColumn"><span class="hs-identifier hs-var">sqlColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145319"><span class="hs-identifier hs-var">isTemp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145321"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-611"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, PRIMARY KEY &quot;</span></span><span>
</span><span id="line-612"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(&quot;</span></span><span>
</span><span id="line-613"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; Text) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text)
-&gt; (FieldDef -&gt; FieldNameDB) -&gt; FieldDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">fieldDB</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FieldDef] -&gt; [Text]) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldDef -&gt; [FieldDef]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty FieldDef -&gt; [FieldDef])
-&gt; NonEmpty FieldDef -&gt; [FieldDef]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompositeDef -&gt; NonEmpty FieldDef
</span><span class="hs-identifier hs-var">compositeFields</span></span><span> </span><span class="annot"><span class="annottext">CompositeDef
</span><a href="#local-6989586621679145329"><span class="hs-identifier hs-var">pdef</span></a></span><span>
</span><span id="line-614"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-615"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">EntityIdField</span></span><span> </span><span id="local-6989586621679145333"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679145333"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-618"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text) -&gt; FieldNameDB -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">fieldDB</span></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679145333"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-619"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-620"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SqlType -&gt; Text
</span><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">(SqlType -&gt; Text) -&gt; SqlType -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; SqlType
</span><span class="hs-identifier hs-var">fieldSqlType</span></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679145333"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-621"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; PRIMARY KEY&quot;</span></span><span>
</span><span id="line-622"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#mayDefault"><span class="hs-identifier hs-var">mayDefault</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FieldAttr] -&gt; Maybe Text
</span><span class="hs-identifier hs-var">defaultAttribute</span></span><span> </span><span class="annot"><span class="annottext">([FieldAttr] -&gt; Maybe Text) -&gt; [FieldAttr] -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; [FieldAttr]
</span><span class="hs-identifier hs-var">fieldAttrs</span></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679145333"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-623"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Column -&gt; Text) -&gt; [Column] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Column -&gt; Text
</span><a href="Database.Persist.Sqlite.html#sqlColumn"><span class="hs-identifier hs-var">sqlColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145319"><span class="hs-identifier hs-var">isTemp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145337"><span class="hs-identifier hs-var">nonIdCols</span></a></span><span>
</span><span id="line-624"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>    </span><span id="local-6989586621679145337"><span class="annot"><span class="annottext">nonIdCols :: [Column]
</span><a href="#local-6989586621679145337"><span class="hs-identifier hs-var hs-var">nonIdCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Column -&gt; Bool) -&gt; [Column] -&gt; [Column]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679145338"><span class="annot"><span class="annottext">Column
</span><a href="#local-6989586621679145338"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Maybe FieldNameDB
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Column -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">cName</span></span><span> </span><span class="annot"><span class="annottext">Column
</span><a href="#local-6989586621679145338"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe FieldNameDB -&gt; Maybe FieldNameDB -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; FieldNameDB) -&gt; Maybe FieldDef -&gt; Maybe FieldNameDB
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">fieldDB</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; Maybe FieldDef
</span><span class="hs-identifier hs-var">getEntityIdField</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145320"><span class="hs-identifier hs-var">entity</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679145321"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="annot"><a href="Database.Persist.Sqlite.html#mayDefault"><span class="hs-identifier hs-type">mayDefault</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-629"></span><span id="mayDefault"><span class="annot"><span class="annottext">mayDefault :: Maybe Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#mayDefault"><span class="hs-identifier hs-var hs-var">mayDefault</span></a></span></span><span> </span><span id="local-6989586621679145340"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145340"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145340"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-630"></span><span>    </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-631"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679145341"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145341"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; DEFAULT &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145341"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="annot"><a href="Database.Persist.Sqlite.html#mayGenerated"><span class="hs-identifier hs-type">mayGenerated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-634"></span><span id="mayGenerated"><span class="annot"><span class="annottext">mayGenerated :: Maybe Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#mayGenerated"><span class="hs-identifier hs-var hs-var">mayGenerated</span></a></span></span><span> </span><span id="local-6989586621679145343"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145343"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145343"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-635"></span><span>    </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-636"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679145344"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145344"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; GENERATED ALWAYS AS (&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145344"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) STORED&quot;</span></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span class="annot"><a href="Database.Persist.Sqlite.html#sqlColumn"><span class="hs-identifier hs-type">sqlColumn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Column</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-639"></span><span id="sqlColumn"><span class="annot"><span class="annottext">sqlColumn :: Bool -&gt; Column -&gt; Text
</span><a href="Database.Persist.Sqlite.html#sqlColumn"><span class="hs-identifier hs-var hs-var">sqlColumn</span></a></span></span><span> </span><span id="local-6989586621679145345"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145345"><span class="hs-identifier hs-var">noRef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Column</span></span><span> </span><span id="local-6989586621679145347"><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679145347"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679145348"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145348"><span class="hs-identifier hs-var">isNull</span></a></span></span><span> </span><span id="local-6989586621679145349"><span class="annot"><span class="annottext">SqlType
</span><a href="#local-6989586621679145349"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621679145350"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145350"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621679145351"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145351"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span id="local-6989586621679145352"><span class="annot"><span class="annottext">Maybe ConstraintNameDB
</span><a href="#local-6989586621679145352"><span class="hs-identifier hs-var">_cn</span></a></span></span><span> </span><span id="local-6989586621679145353"><span class="annot"><span class="annottext">Maybe Integer
</span><a href="#local-6989586621679145353"><span class="hs-identifier hs-var">_maxLen</span></a></span></span><span> </span><span id="local-6989586621679145354"><span class="annot"><span class="annottext">Maybe ColumnReference
</span><a href="#local-6989586621679145354"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-640"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-641"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679145347"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-642"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-643"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SqlType -&gt; Text
</span><a href="Database.Persist.Sqlite.html#showSqlType"><span class="hs-identifier hs-var">showSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><a href="#local-6989586621679145349"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-644"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145348"><span class="hs-identifier hs-var">isNull</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; NULL&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; NOT NULL&quot;</span></span><span>
</span><span id="line-645"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#mayDefault"><span class="hs-identifier hs-var">mayDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145350"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#mayGenerated"><span class="hs-identifier hs-var">mayGenerated</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679145351"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ColumnReference
</span><a href="#local-6989586621679145354"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-648"></span><span>        </span><span class="annot"><span class="annottext">Maybe ColumnReference
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-649"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColumnReference</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">crTableName :: ColumnReference -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">crTableName</span></span><span class="hs-glyph">=</span><span id="local-6989586621679145357"><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145357"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">crFieldCascade :: ColumnReference -&gt; FieldCascade
</span><span class="hs-identifier hs-var">crFieldCascade</span></span><span class="hs-glyph">=</span><span id="local-6989586621679145359"><span class="annot"><span class="annottext">FieldCascade
</span><a href="#local-6989586621679145359"><span class="hs-identifier hs-var">cascadeOpts</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-650"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145345"><span class="hs-identifier hs-var">noRef</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; REFERENCES &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679145357"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-651"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FieldCascade -&gt; Text
</span><a href="#local-6989586621679145360"><span class="hs-identifier hs-var">onDelete</span></a></span><span> </span><span class="annot"><span class="annottext">FieldCascade
</span><a href="#local-6989586621679145359"><span class="hs-identifier hs-var">cascadeOpts</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FieldCascade -&gt; Text
</span><a href="#local-6989586621679145361"><span class="hs-identifier hs-var">onUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">FieldCascade
</span><a href="#local-6989586621679145359"><span class="hs-identifier hs-var">cascadeOpts</span></a></span><span>
</span><span id="line-652"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-653"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-654"></span><span>    </span><span id="local-6989586621679145360"><span class="annot"><span class="annottext">onDelete :: FieldCascade -&gt; Text
</span><a href="#local-6989586621679145360"><span class="hs-identifier hs-var hs-var">onDelete</span></a></span></span><span> </span><span id="local-6989586621679145364"><span class="annot"><span class="annottext">FieldCascade
</span><a href="#local-6989586621679145364"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (CascadeAction -&gt; Text) -&gt; Maybe CascadeAction -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.append</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; ON DELETE &quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (CascadeAction -&gt; Text) -&gt; CascadeAction -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CascadeAction -&gt; Text
</span><span class="hs-identifier hs-var">renderCascadeAction</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldCascade -&gt; Maybe CascadeAction
</span><span class="hs-identifier hs-var">fcOnDelete</span></span><span> </span><span class="annot"><span class="annottext">FieldCascade
</span><a href="#local-6989586621679145364"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>    </span><span id="local-6989586621679145361"><span class="annot"><span class="annottext">onUpdate :: FieldCascade -&gt; Text
</span><a href="#local-6989586621679145361"><span class="hs-identifier hs-var hs-var">onUpdate</span></a></span></span><span> </span><span id="local-6989586621679145371"><span class="annot"><span class="annottext">FieldCascade
</span><a href="#local-6989586621679145371"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (CascadeAction -&gt; Text) -&gt; Maybe CascadeAction -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.append</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; ON UPDATE &quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (CascadeAction -&gt; Text) -&gt; CascadeAction -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CascadeAction -&gt; Text
</span><span class="hs-identifier hs-var">renderCascadeAction</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldCascade -&gt; Maybe CascadeAction
</span><span class="hs-identifier hs-var">fcOnUpdate</span></span><span> </span><span class="annot"><span class="annottext">FieldCascade
</span><a href="#local-6989586621679145371"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span class="annot"><a href="Database.Persist.Sqlite.html#sqlForeign"><span class="hs-identifier hs-type">sqlForeign</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ForeignDef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-658"></span><span id="sqlForeign"><span class="annot"><span class="annottext">sqlForeign :: ForeignDef -&gt; Text
</span><a href="Database.Persist.Sqlite.html#sqlForeign"><span class="hs-identifier hs-var hs-var">sqlForeign</span></a></span></span><span> </span><span id="local-6989586621679145373"><span class="annot"><span class="annottext">ForeignDef
</span><a href="#local-6989586621679145373"><span class="hs-identifier hs-var">fdef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-659"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, CONSTRAINT &quot;</span></span><span>
</span><span id="line-660"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeC"><span class="hs-identifier hs-var">escapeC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConstraintNameDB -&gt; Text) -&gt; ConstraintNameDB -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; ConstraintNameDB
</span><span class="hs-identifier hs-var">foreignConstraintNameDBName</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef
</span><a href="#local-6989586621679145373"><span class="hs-identifier hs-var">fdef</span></a></span><span>
</span><span id="line-661"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; FOREIGN KEY(&quot;</span></span><span>
</span><span id="line-662"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((ForeignFieldDef, ForeignFieldDef) -&gt; Text)
-&gt; [(ForeignFieldDef, ForeignFieldDef)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text)
-&gt; ((ForeignFieldDef, ForeignFieldDef) -&gt; FieldNameDB)
-&gt; (ForeignFieldDef, ForeignFieldDef)
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ForeignFieldDef -&gt; FieldNameDB
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="annot"><span class="annottext">(ForeignFieldDef -&gt; FieldNameDB)
-&gt; ((ForeignFieldDef, ForeignFieldDef) -&gt; ForeignFieldDef)
-&gt; (ForeignFieldDef, ForeignFieldDef)
-&gt; FieldNameDB
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ForeignFieldDef, ForeignFieldDef) -&gt; ForeignFieldDef
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ForeignFieldDef, ForeignFieldDef)] -&gt; [Text])
-&gt; [(ForeignFieldDef, ForeignFieldDef)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; [(ForeignFieldDef, ForeignFieldDef)]
</span><span class="hs-identifier hs-var">foreignFields</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef
</span><a href="#local-6989586621679145373"><span class="hs-identifier hs-var">fdef</span></a></span><span>
</span><span id="line-663"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) REFERENCES &quot;</span></span><span>
</span><span id="line-664"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">(EntityNameDB -&gt; Text) -&gt; EntityNameDB -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">foreignRefTableDBName</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef
</span><a href="#local-6989586621679145373"><span class="hs-identifier hs-var">fdef</span></a></span><span>
</span><span id="line-665"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(&quot;</span></span><span>
</span><span id="line-666"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((ForeignFieldDef, ForeignFieldDef) -&gt; Text)
-&gt; [(ForeignFieldDef, ForeignFieldDef)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text)
-&gt; ((ForeignFieldDef, ForeignFieldDef) -&gt; FieldNameDB)
-&gt; (ForeignFieldDef, ForeignFieldDef)
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ForeignFieldDef -&gt; FieldNameDB
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(ForeignFieldDef -&gt; FieldNameDB)
-&gt; ((ForeignFieldDef, ForeignFieldDef) -&gt; ForeignFieldDef)
-&gt; (ForeignFieldDef, ForeignFieldDef)
-&gt; FieldNameDB
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ForeignFieldDef, ForeignFieldDef) -&gt; ForeignFieldDef
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ForeignFieldDef, ForeignFieldDef)] -&gt; [Text])
-&gt; [(ForeignFieldDef, ForeignFieldDef)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; [(ForeignFieldDef, ForeignFieldDef)]
</span><span class="hs-identifier hs-var">foreignFields</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef
</span><a href="#local-6989586621679145373"><span class="hs-identifier hs-var">fdef</span></a></span><span>
</span><span id="line-667"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-668"></span><span>    </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145379"><span class="hs-identifier hs-var">onDelete</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145380"><span class="hs-identifier hs-var">onUpdate</span></a></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-670"></span><span>    </span><span id="local-6989586621679145379"><span class="annot"><span class="annottext">onDelete :: [Text]
</span><a href="#local-6989586621679145379"><span class="hs-identifier hs-var hs-var">onDelete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-671"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.append</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; ON DELETE &quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>        </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe CascadeAction -&gt; [Text]
</span><a href="#local-6989586621679145381"><span class="hs-identifier hs-var">showAction</span></a></span><span>
</span><span id="line-673"></span><span>        </span><span class="annot"><span class="annottext">(Maybe CascadeAction -&gt; [Text]) -&gt; Maybe CascadeAction -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldCascade -&gt; Maybe CascadeAction
</span><span class="hs-identifier hs-var">fcOnDelete</span></span><span>
</span><span id="line-674"></span><span>        </span><span class="annot"><span class="annottext">(FieldCascade -&gt; Maybe CascadeAction)
-&gt; FieldCascade -&gt; Maybe CascadeAction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; FieldCascade
</span><span class="hs-identifier hs-var">foreignFieldCascade</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef
</span><a href="#local-6989586621679145373"><span class="hs-identifier hs-var">fdef</span></a></span><span>
</span><span id="line-675"></span><span>    </span><span id="local-6989586621679145380"><span class="annot"><span class="annottext">onUpdate :: [Text]
</span><a href="#local-6989586621679145380"><span class="hs-identifier hs-var hs-var">onUpdate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-676"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.append</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; ON UPDATE &quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>        </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe CascadeAction -&gt; [Text]
</span><a href="#local-6989586621679145381"><span class="hs-identifier hs-var">showAction</span></a></span><span>
</span><span id="line-678"></span><span>        </span><span class="annot"><span class="annottext">(Maybe CascadeAction -&gt; [Text]) -&gt; Maybe CascadeAction -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldCascade -&gt; Maybe CascadeAction
</span><span class="hs-identifier hs-var">fcOnUpdate</span></span><span>
</span><span id="line-679"></span><span>        </span><span class="annot"><span class="annottext">(FieldCascade -&gt; Maybe CascadeAction)
-&gt; FieldCascade -&gt; Maybe CascadeAction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; FieldCascade
</span><span class="hs-identifier hs-var">foreignFieldCascade</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef
</span><a href="#local-6989586621679145373"><span class="hs-identifier hs-var">fdef</span></a></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span>    </span><span id="local-6989586621679145381"><span class="annot"><span class="annottext">showAction :: Maybe CascadeAction -&gt; [Text]
</span><a href="#local-6989586621679145381"><span class="hs-identifier hs-var hs-var">showAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; [Text]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; [Text])
-&gt; (Maybe CascadeAction -&gt; Maybe Text)
-&gt; Maybe CascadeAction
-&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CascadeAction -&gt; Text) -&gt; Maybe CascadeAction -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CascadeAction -&gt; Text
</span><span class="hs-identifier hs-var">renderCascadeAction</span></span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="annot"><a href="Database.Persist.Sqlite.html#sqlUnique"><span class="hs-identifier hs-type">sqlUnique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UniqueDef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-684"></span><span id="sqlUnique"><span class="annot"><span class="annottext">sqlUnique :: UniqueDef -&gt; Text
</span><a href="Database.Persist.Sqlite.html#sqlUnique"><span class="hs-identifier hs-var hs-var">sqlUnique</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UniqueDef</span></span><span> </span><span class="annot"><span class="annottext">ConstraintNameHS
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679145386"><span class="annot"><span class="annottext">ConstraintNameDB
</span><a href="#local-6989586621679145386"><span class="hs-identifier hs-var">cname</span></a></span></span><span> </span><span id="local-6989586621679145387"><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679145387"><span class="hs-identifier hs-var">cols</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-685"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,CONSTRAINT &quot;</span></span><span>
</span><span id="line-686"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeC"><span class="hs-identifier hs-var">escapeC</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB
</span><a href="#local-6989586621679145386"><span class="hs-identifier hs-var">cname</span></a></span><span>
</span><span id="line-687"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; UNIQUE (&quot;</span></span><span>
</span><span id="line-688"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ForeignFieldDef -&gt; Text) -&gt; [ForeignFieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text)
-&gt; (ForeignFieldDef -&gt; FieldNameDB) -&gt; ForeignFieldDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ForeignFieldDef -&gt; FieldNameDB
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ForeignFieldDef] -&gt; [Text]) -&gt; [ForeignFieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef -&gt; [ForeignFieldDef]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679145387"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-689"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-690"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="annot"><a href="Database.Persist.Sqlite.html#escapeC"><span class="hs-identifier hs-type">escapeC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConstraintNameDB</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-693"></span><span id="escapeC"><span class="annot"><span class="annottext">escapeC :: ConstraintNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeC"><span class="hs-identifier hs-var hs-var">escapeC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; ConstraintNameDB -&gt; Text
forall a str. DatabaseName a =&gt; (Text -&gt; str) -&gt; a -&gt; str
forall str. (Text -&gt; str) -&gt; ConstraintNameDB -&gt; str
</span><span class="hs-identifier hs-var">escapeWith</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var">escape</span></a></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="annot"><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-type">escapeE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityNameDB</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-696"></span><span id="escapeE"><span class="annot"><span class="annottext">escapeE :: EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var hs-var">escapeE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; EntityNameDB -&gt; Text
forall a str. DatabaseName a =&gt; (Text -&gt; str) -&gt; a -&gt; str
forall str. (Text -&gt; str) -&gt; EntityNameDB -&gt; str
</span><span class="hs-identifier hs-var">escapeWith</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var">escape</span></a></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="annot"><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-type">escapeF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FieldNameDB</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-699"></span><span id="escapeF"><span class="annot"><span class="annottext">escapeF :: FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var hs-var">escapeF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; FieldNameDB -&gt; Text
forall a str. DatabaseName a =&gt; (Text -&gt; str) -&gt; a -&gt; str
forall str. (Text -&gt; str) -&gt; FieldNameDB -&gt; str
</span><span class="hs-identifier hs-var">escapeWith</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var">escape</span></a></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span class="annot"><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-type">escape</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-702"></span><span id="escape"><span class="annot"><span class="annottext">escape :: Text -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escape"><span class="hs-identifier hs-var hs-var">escape</span></a></span></span><span> </span><span id="local-6989586621679145389"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145389"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-703"></span><span>    </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145390"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Text) -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.concatMap</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text
</span><a href="#local-6989586621679145392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145389"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145390"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-705"></span><span>    </span><span id="local-6989586621679145390"><span class="annot"><span class="annottext">q :: Text
</span><a href="#local-6989586621679145390"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text
</span><span class="hs-identifier hs-var">T.singleton</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&quot;'</span></span><span>
</span><span id="line-706"></span><span>    </span><span id="local-6989586621679145392"><span class="annot"><span class="annottext">go :: Char -&gt; Text
</span><a href="#local-6989586621679145392"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&quot;'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot;\&quot;&quot;</span></span><span>
</span><span id="line-707"></span><span>    </span><span class="annot"><a href="#local-6989586621679145392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679145395"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679145395"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text
</span><span class="hs-identifier hs-var">T.singleton</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679145395"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span class="annot"><a href="Database.Persist.Sqlite.html#putManySql"><span class="hs-identifier hs-type">putManySql</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-710"></span><span id="putManySql"><span class="annot"><span class="annottext">putManySql :: EntityDef -&gt; Int -&gt; Text
</span><a href="Database.Persist.Sqlite.html#putManySql"><span class="hs-identifier hs-var hs-var">putManySql</span></a></span></span><span> </span><span id="local-6989586621679145396"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145396"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span id="local-6989586621679145397"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145397"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [FieldDef] -&gt; EntityDef -&gt; Int -&gt; Text
</span><a href="Database.Persist.Sqlite.html#putManySql%27"><span class="hs-identifier hs-var">putManySql'</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145399"><span class="hs-identifier hs-var">conflictColumns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldDef] -&gt; [FieldDef]
forall a. [a] -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145400"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145396"><span class="hs-identifier hs-var">ent</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145397"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-712"></span><span>    </span><span id="local-6989586621679145400"><span class="annot"><span class="annottext">fields :: [FieldDef]
</span><a href="#local-6989586621679145400"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [FieldDef]
</span><span class="hs-identifier hs-var">getEntityFields</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145396"><span class="hs-identifier hs-var">ent</span></a></span><span>
</span><span id="line-713"></span><span>    </span><span id="local-6989586621679145399"><span class="annot"><span class="annottext">conflictColumns :: [Text]
</span><a href="#local-6989586621679145399"><span class="hs-identifier hs-var hs-var">conflictColumns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqueDef -&gt; [Text]) -&gt; [UniqueDef] -&gt; [Text]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ForeignFieldDef -&gt; Text) -&gt; [ForeignFieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text)
-&gt; (ForeignFieldDef -&gt; FieldNameDB) -&gt; ForeignFieldDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ForeignFieldDef -&gt; FieldNameDB
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ForeignFieldDef] -&gt; [Text])
-&gt; (UniqueDef -&gt; [ForeignFieldDef]) -&gt; UniqueDef -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef -&gt; [ForeignFieldDef]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty ForeignFieldDef -&gt; [ForeignFieldDef])
-&gt; (UniqueDef -&gt; NonEmpty ForeignFieldDef)
-&gt; UniqueDef
-&gt; [ForeignFieldDef]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UniqueDef -&gt; NonEmpty ForeignFieldDef
</span><span class="hs-identifier hs-var">uniqueFields</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; [UniqueDef]
</span><span class="hs-identifier hs-var">getEntityUniques</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145396"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span class="annot"><a href="Database.Persist.Sqlite.html#repsertManySql"><span class="hs-identifier hs-type">repsertManySql</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-716"></span><span id="repsertManySql"><span class="annot"><span class="annottext">repsertManySql :: EntityDef -&gt; Int -&gt; Text
</span><a href="Database.Persist.Sqlite.html#repsertManySql"><span class="hs-identifier hs-var hs-var">repsertManySql</span></a></span></span><span> </span><span id="local-6989586621679145404"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145404"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span id="local-6989586621679145405"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145405"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [FieldDef] -&gt; EntityDef -&gt; Int -&gt; Text
</span><a href="Database.Persist.Sqlite.html#putManySql%27"><span class="hs-identifier hs-var">putManySql'</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145406"><span class="hs-identifier hs-var">conflictColumns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty FieldDef -&gt; [FieldDef]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldDef
</span><a href="#local-6989586621679145407"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145404"><span class="hs-identifier hs-var">ent</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145405"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621679145407"><span class="annot"><span class="annottext">fields :: NonEmpty FieldDef
</span><a href="#local-6989586621679145407"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; NonEmpty FieldDef
</span><span class="hs-identifier hs-var">keyAndEntityFields</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145404"><span class="hs-identifier hs-var">ent</span></a></span><span>
</span><span id="line-719"></span><span>    </span><span id="local-6989586621679145406"><span class="annot"><span class="annottext">conflictColumns :: [Text]
</span><a href="#local-6989586621679145406"><span class="hs-identifier hs-var hs-var">conflictColumns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text)
-&gt; (FieldDef -&gt; FieldNameDB) -&gt; FieldDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">fieldDB</span></span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; Text) -&gt; [FieldDef] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldDef -&gt; [FieldDef]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; NonEmpty FieldDef
</span><span class="hs-identifier hs-var">getEntityKeyFields</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145404"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span class="annot"><a href="Database.Persist.Sqlite.html#putManySql%27"><span class="hs-identifier hs-type">putManySql'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FieldDef</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntityDef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-722"></span><span id="putManySql%27"><span class="annot"><span class="annottext">putManySql' :: [Text] -&gt; [FieldDef] -&gt; EntityDef -&gt; Int -&gt; Text
</span><a href="Database.Persist.Sqlite.html#putManySql%27"><span class="hs-identifier hs-var hs-var">putManySql'</span></a></span></span><span> </span><span id="local-6989586621679145411"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145411"><span class="hs-identifier hs-var">conflictColumns</span></a></span></span><span> </span><span id="local-6989586621679145412"><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145412"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621679145413"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145413"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span id="local-6989586621679145414"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145414"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145415"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-724"></span><span>    </span><span id="local-6989586621679145416"><span class="annot"><span class="annottext">fieldDbToText :: FieldDef -&gt; Text
</span><a href="#local-6989586621679145416"><span class="hs-identifier hs-var hs-var">fieldDbToText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeF"><span class="hs-identifier hs-var">escapeF</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldNameDB -&gt; Text)
-&gt; (FieldDef -&gt; FieldNameDB) -&gt; FieldDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><span class="hs-identifier hs-var">fieldDB</span></span><span>
</span><span id="line-725"></span><span>    </span><span id="local-6989586621679145418"><span class="annot"><span class="annottext">mkAssignment :: Text -&gt; Text
</span><a href="#local-6989586621679145418"><span class="hs-identifier hs-var hs-var">mkAssignment</span></a></span></span><span> </span><span id="local-6989586621679145419"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145419"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145419"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;=EXCLUDED.&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145419"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span>    </span><span id="local-6989586621679145420"><span class="annot"><span class="annottext">table :: Text
</span><a href="#local-6989586621679145420"><span class="hs-identifier hs-var hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Sqlite.html#escapeE"><span class="hs-identifier hs-var">escapeE</span></a></span><span> </span><span class="annot"><span class="annottext">(EntityNameDB -&gt; Text)
-&gt; (EntityDef -&gt; EntityNameDB) -&gt; EntityDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span> </span><span class="annot"><span class="annottext">(EntityDef -&gt; Text) -&gt; EntityDef -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679145413"><span class="hs-identifier hs-var">ent</span></a></span><span>
</span><span id="line-728"></span><span>    </span><span id="local-6989586621679145421"><span class="annot"><span class="annottext">columns :: Text
</span><a href="#local-6989586621679145421"><span class="hs-identifier hs-var hs-var">columns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Util.commaSeparated</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; Text) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Text
</span><a href="#local-6989586621679145416"><span class="hs-identifier hs-var">fieldDbToText</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145412"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-729"></span><span>    </span><span id="local-6989586621679145423"><span class="annot"><span class="annottext">placeholders :: [Text]
</span><a href="#local-6989586621679145423"><span class="hs-identifier hs-var hs-var">placeholders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; Text) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldDef -&gt; Text
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;?&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145412"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-730"></span><span>    </span><span id="local-6989586621679145424"><span class="annot"><span class="annottext">updates :: [Text]
</span><a href="#local-6989586621679145424"><span class="hs-identifier hs-var hs-var">updates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldDef -&gt; Text) -&gt; [FieldDef] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621679145418"><span class="hs-identifier hs-var">mkAssignment</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (FieldDef -&gt; Text) -&gt; FieldDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Text
</span><a href="#local-6989586621679145416"><span class="hs-identifier hs-var">fieldDbToText</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679145412"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span>    </span><span id="local-6989586621679145415"><span class="annot"><span class="annottext">q :: Text
</span><a href="#local-6989586621679145415"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span>
</span><span id="line-733"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;INSERT INTO &quot;</span></span><span>
</span><span id="line-734"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145420"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-735"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Util.parenWrapped</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145421"><span class="hs-identifier hs-var">columns</span></a></span><span>
</span><span id="line-736"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; VALUES &quot;</span></span><span>
</span><span id="line-737"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Util.commaSeparated</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; ([Text] -&gt; [Text]) -&gt; [Text] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; [Text]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145414"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-738"></span><span>            </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Util.parenWrapped</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Util.commaSeparated</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145423"><span class="hs-identifier hs-var">placeholders</span></a></span><span>
</span><span id="line-739"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; ON CONFLICT &quot;</span></span><span>
</span><span id="line-740"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">Util.parenWrapped</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Util.commaSeparated</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145411"><span class="hs-identifier hs-var">conflictColumns</span></a></span><span>
</span><span id="line-741"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; DO UPDATE SET &quot;</span></span><span>
</span><span id="line-742"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Util.commaSeparated</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679145424"><span class="hs-identifier hs-var">updates</span></a></span><span>
</span><span id="line-743"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span class="annot"><span class="hs-comment">-- | Information required to setup a connection pool.</span></span><span>
</span><span id="line-746"></span><span class="hs-keyword">data</span><span> </span><span id="SqliteConf"><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConf"><span class="hs-identifier hs-var">SqliteConf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SqliteConf"><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConf"><span class="hs-identifier hs-var">SqliteConf</span></a></span></span><span>
</span><span id="line-747"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="sqlDatabase"><span class="annot"><span class="annottext">SqliteConf -&gt; Text
</span><a href="Database.Persist.Sqlite.html#sqlDatabase"><span class="hs-identifier hs-var hs-var">sqlDatabase</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-748"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sqlPoolSize"><span class="annot"><span class="annottext">SqliteConf -&gt; Int
</span><a href="Database.Persist.Sqlite.html#sqlPoolSize"><span class="hs-identifier hs-var hs-var">sqlPoolSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-749"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="SqliteConfInfo"><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConfInfo"><span class="hs-identifier hs-var">SqliteConfInfo</span></a></span></span><span>
</span><span id="line-751"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="sqlConnInfo"><span class="annot"><span class="annottext">SqliteConf -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#sqlConnInfo"><span class="hs-identifier hs-var hs-var">sqlConnInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-752"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sqlPoolSize"><span class="annot"><a href="Database.Persist.Sqlite.html#sqlPoolSize"><span class="hs-identifier hs-var">sqlPoolSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-753"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679145433"><span id="local-6989586621679145444"><span id="local-6989586621679145448"><span class="annot"><span class="annottext">Int -&gt; SqliteConf -&gt; String -&gt; String
[SqliteConf] -&gt; String -&gt; String
SqliteConf -&gt; String
(Int -&gt; SqliteConf -&gt; String -&gt; String)
-&gt; (SqliteConf -&gt; String)
-&gt; ([SqliteConf] -&gt; String -&gt; String)
-&gt; Show SqliteConf
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Int -&gt; SqliteConf -&gt; String -&gt; String
showsPrec :: Int -&gt; SqliteConf -&gt; String -&gt; String
$cshow :: SqliteConf -&gt; String
show :: SqliteConf -&gt; String
$cshowList :: [SqliteConf] -&gt; String -&gt; String
showList :: [SqliteConf] -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679145453"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConf"><span class="hs-identifier hs-type">SqliteConf</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-756"></span><span>    </span><span id="local-6989586621679145457"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser SqliteConf
</span><a href="#local-6989586621679145457"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span id="local-6989586621679145459"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679145459"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; Parser SqliteConf -&gt; Parser SqliteConf
forall a. (String -&gt; String) -&gt; Parser a -&gt; Parser a
</span><span class="hs-identifier hs-var">modifyFailure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Persistent: error loading Sqlite conf: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Parser SqliteConf -&gt; Parser SqliteConf)
-&gt; Parser SqliteConf -&gt; Parser SqliteConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser SqliteConf) -&gt; Value -&gt; Parser SqliteConf)
-&gt; Value -&gt; (Object -&gt; Parser SqliteConf) -&gt; Parser SqliteConf
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; (Object -&gt; Parser SqliteConf) -&gt; Value -&gt; Parser SqliteConf
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SqliteConf&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679145459"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Parser SqliteConf
</span><a href="#local-6989586621679145461"><span class="hs-identifier hs-var">parser</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-757"></span><span>        </span><span id="local-6989586621679145461"><span class="annot"><span class="annottext">parser :: Object -&gt; Parser SqliteConf
</span><a href="#local-6989586621679145461"><span class="hs-identifier hs-var hs-var">parser</span></a></span></span><span> </span><span id="local-6989586621679145481"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145481"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;database&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Bool
forall {a}. Key -&gt; KeyMap a -&gt; Bool
</span><a href="#local-6989586621679145482"><span class="hs-operator hs-var">`isMember`</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145481"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-758"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int -&gt; SqliteConf
</span><a href="Database.Persist.Sqlite.html#SqliteConf"><span class="hs-identifier hs-var">SqliteConf</span></a></span><span>
</span><span id="line-759"></span><span>                            </span><span class="annot"><span class="annottext">(Text -&gt; Int -&gt; SqliteConf)
-&gt; Parser Text -&gt; Parser (Int -&gt; SqliteConf)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145481"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Text
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;database&quot;</span></span><span>
</span><span id="line-760"></span><span>                            </span><span class="annot"><span class="annottext">Parser (Int -&gt; SqliteConf) -&gt; Parser Int -&gt; Parser SqliteConf
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145481"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Int
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;poolsize&quot;</span></span><span>
</span><span id="line-761"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Int -&gt; SqliteConf
</span><a href="Database.Persist.Sqlite.html#SqliteConfInfo"><span class="hs-identifier hs-var">SqliteConfInfo</span></a></span><span>
</span><span id="line-762"></span><span>                            </span><span class="annot"><span class="annottext">(SqliteConnectionInfo -&gt; Int -&gt; SqliteConf)
-&gt; Parser SqliteConnectionInfo -&gt; Parser (Int -&gt; SqliteConf)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145481"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser SqliteConnectionInfo
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;connInfo&quot;</span></span><span>
</span><span id="line-763"></span><span>                            </span><span class="annot"><span class="annottext">Parser (Int -&gt; SqliteConf) -&gt; Parser Int -&gt; Parser SqliteConf
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145481"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Int
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;poolsize&quot;</span></span><span class="hs-cpp">
#if MIN_VERSION_aeson(2,0,0)
</span><span>        </span><span id="local-6989586621679145482"><span class="annot"><span class="annottext">isMember :: Key -&gt; KeyMap a -&gt; Bool
</span><a href="#local-6989586621679145482"><span class="hs-identifier hs-var hs-var">isMember</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; KeyMap a -&gt; Bool
forall {a}. Key -&gt; KeyMap a -&gt; Bool
</span><span class="hs-identifier hs-var">KeyMap.member</span></span><span class="hs-cpp">
#else
</span><span>        </span><span class="hs-identifier">isMember</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">HashMap.member</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-770"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679145487"><span class="annot"><span class="hs-identifier hs-type">PersistConfig</span></span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConf"><span class="hs-identifier hs-type">SqliteConf</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-771"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="PersistConfigBackend"><span class="annot"><span class="hs-identifier hs-var">PersistConfigBackend</span></span></span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConf"><span class="hs-identifier hs-type">SqliteConf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlPersistT</span></span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="PersistConfigPool"><span class="annot"><span class="hs-identifier hs-var">PersistConfigPool</span></span></span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConf"><span class="hs-identifier hs-type">SqliteConf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConnectionPool</span></span><span>
</span><span id="line-773"></span><span>    </span><span id="local-6989586621679145499"><span class="annot"><span class="annottext">createPoolConfig :: SqliteConf -&gt; IO (PersistConfigPool SqliteConf)
</span><a href="#local-6989586621679145499"><span class="hs-identifier hs-var hs-var hs-var hs-var">createPoolConfig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConf"><span class="hs-identifier hs-type">SqliteConf</span></a></span><span> </span><span id="local-6989586621679145501"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145501"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621679145502"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145502"><span class="hs-identifier hs-var">size</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NoLoggingT IO (PersistConfigPool SqliteConf)
-&gt; IO (PersistConfigPool SqliteConf)
forall (m :: * -&gt; *) a. NoLoggingT m a -&gt; m a
</span><span class="hs-identifier hs-var">runNoLoggingT</span></span><span> </span><span class="annot"><span class="annottext">(NoLoggingT IO (PersistConfigPool SqliteConf)
 -&gt; IO (PersistConfigPool SqliteConf))
-&gt; NoLoggingT IO (PersistConfigPool SqliteConf)
-&gt; IO (PersistConfigPool SqliteConf)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Int -&gt; NoLoggingT IO (Pool SqlBackend)
forall (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m) =&gt;
SqliteConnectionInfo -&gt; Int -&gt; m (Pool SqlBackend)
</span><a href="Database.Persist.Sqlite.html#createSqlitePoolFromInfo"><span class="hs-identifier hs-var">createSqlitePoolFromInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#conStringToInfo"><span class="hs-identifier hs-var">conStringToInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145501"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145502"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="hs-comment">-- FIXME</span><span>
</span><span id="line-774"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">createPoolConfig</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConfInfo"><span class="hs-identifier hs-type">SqliteConfInfo</span></a></span><span> </span><span id="local-6989586621679145503"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145503"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621679145504"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145504"><span class="hs-identifier hs-var">size</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NoLoggingT IO (PersistConfigPool SqliteConf)
-&gt; IO (PersistConfigPool SqliteConf)
forall (m :: * -&gt; *) a. NoLoggingT m a -&gt; m a
</span><span class="hs-identifier hs-var">runNoLoggingT</span></span><span> </span><span class="annot"><span class="annottext">(NoLoggingT IO (PersistConfigPool SqliteConf)
 -&gt; IO (PersistConfigPool SqliteConf))
-&gt; NoLoggingT IO (PersistConfigPool SqliteConf)
-&gt; IO (PersistConfigPool SqliteConf)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Int -&gt; NoLoggingT IO (Pool SqlBackend)
forall (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m) =&gt;
SqliteConnectionInfo -&gt; Int -&gt; m (Pool SqlBackend)
</span><a href="Database.Persist.Sqlite.html#createSqlitePoolFromInfo"><span class="hs-identifier hs-var">createSqlitePoolFromInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145503"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145504"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="hs-comment">-- FIXME</span><span>
</span><span id="line-775"></span><span>    </span><span id="local-6989586621679145508"><span class="annot"><span class="annottext">runPool :: forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
SqliteConf
-&gt; PersistConfigBackend SqliteConf m a
-&gt; PersistConfigPool SqliteConf
-&gt; m a
</span><a href="#local-6989586621679145508"><span class="hs-identifier hs-var hs-var hs-var hs-var">runPool</span></a></span></span><span> </span><span class="annot"><span class="annottext">SqliteConf
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT SqlBackend m a -&gt; Pool SqlBackend -&gt; m a
PersistConfigBackend SqliteConf m a
-&gt; PersistConfigPool SqliteConf -&gt; m a
forall backend (m :: * -&gt; *) a.
(MonadUnliftIO m, BackendCompatible SqlBackend backend) =&gt;
ReaderT backend m a -&gt; Pool backend -&gt; m a
</span><span class="hs-identifier hs-var">runSqlPool</span></span><span>
</span><span id="line-776"></span><span>    </span><span id="local-6989586621679145512"><span class="annot"><span class="annottext">loadConfig :: Value -&gt; Parser SqliteConf
</span><a href="#local-6989586621679145512"><span class="hs-identifier hs-var hs-var hs-var hs-var">loadConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser SqliteConf
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span id="local-6989586621679144145"><span id="local-6989586621679144146"><span id="local-6989586621679144147"><span class="annot"><a href="Database.Persist.Sqlite.html#finally"><span class="hs-identifier hs-type">finally</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144145"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-779"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144145"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144146"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ computation to run first</span></span><span>
</span><span id="line-780"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144145"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144147"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ computation to run afterward (even if an exception was raised)</span></span><span>
</span><span id="line-781"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144145"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144146"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-782"></span><span id="finally"><span class="annot"><span class="annottext">finally :: forall (m :: * -&gt; *) a b. MonadUnliftIO m =&gt; m a -&gt; m b -&gt; m a
</span><a href="Database.Persist.Sqlite.html#finally"><span class="hs-identifier hs-var hs-var">finally</span></a></span></span><span> </span><span id="local-6989586621679145516"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679145516"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679145517"><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679145517"><span class="hs-identifier hs-var">sequel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnliftIO m -&gt; IO a) -&gt; m a
forall (m :: * -&gt; *) a.
MonadUnliftIO m =&gt;
(UnliftIO m -&gt; IO a) -&gt; m a
</span><span class="hs-identifier hs-var">withUnliftIO</span></span><span> </span><span class="annot"><span class="annottext">((UnliftIO m -&gt; IO a) -&gt; m a) -&gt; (UnliftIO m -&gt; IO a) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679145518"><span class="annot"><span class="annottext">UnliftIO m
</span><a href="#local-6989586621679145518"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-783"></span><span>                     </span><span class="annot"><span class="annottext">IO a -&gt; IO b -&gt; IO a
forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-identifier hs-var">E.finally</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnliftIO m -&gt; forall a. m a -&gt; IO a
forall (m :: * -&gt; *). UnliftIO m -&gt; forall a. m a -&gt; IO a
</span><span class="hs-identifier hs-var">unliftIO</span></span><span> </span><span class="annot"><span class="annottext">UnliftIO m
</span><a href="#local-6989586621679145518"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679145516"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnliftIO m -&gt; forall a. m a -&gt; IO a
forall (m :: * -&gt; *). UnliftIO m -&gt; forall a. m a -&gt; IO a
</span><span class="hs-identifier hs-var">unliftIO</span></span><span> </span><span class="annot"><span class="annottext">UnliftIO m
</span><a href="#local-6989586621679145518"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">m b
</span><a href="#local-6989586621679145517"><span class="hs-identifier hs-var">sequel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#finally"><span class="hs-pragma hs-type">finally</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-786"></span><span class="hs-comment">-- | Creates a SqliteConnectionInfo from a connection string, with the</span><span>
</span><span id="line-787"></span><span class="hs-comment">-- default settings.</span><span>
</span><span id="line-788"></span><span class="hs-comment">--</span><span>
</span><span id="line-789"></span><span class="hs-comment">-- @since 2.6.2</span><span>
</span><span id="line-790"></span><span class="annot"><a href="Database.Persist.Sqlite.html#mkSqliteConnectionInfo"><span class="hs-identifier hs-type">mkSqliteConnectionInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-791"></span><span id="mkSqliteConnectionInfo"><span class="annot"><span class="annottext">mkSqliteConnectionInfo :: Text -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#mkSqliteConnectionInfo"><span class="hs-identifier hs-var hs-var">mkSqliteConnectionInfo</span></a></span></span><span> </span><span id="local-6989586621679145520"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145520"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Bool -&gt; [Text] -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-var">SqliteConnectionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145520"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-792"></span><span>
</span><span id="line-793"></span><span class="annot"><span class="hs-comment">-- | Parses connection options from a connection string. Used only to provide deprecated API.</span></span><span>
</span><span id="line-794"></span><span class="annot"><a href="Database.Persist.Sqlite.html#conStringToInfo"><span class="hs-identifier hs-type">conStringToInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-795"></span><span id="conStringToInfo"><span class="annot"><span class="annottext">conStringToInfo :: Text -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#conStringToInfo"><span class="hs-identifier hs-var hs-var">conStringToInfo</span></a></span></span><span> </span><span id="local-6989586621679145522"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145522"><span class="hs-identifier hs-var">connStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Bool -&gt; [Text] -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-var">SqliteConnectionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145523"><span class="hs-identifier hs-var">connStr'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145524"><span class="hs-identifier hs-var">enableWal</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-796"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679145523"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145523"><span class="hs-identifier hs-var">connStr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145524"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679145524"><span class="hs-identifier hs-var">enableWal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-797"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679145525"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145525"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">T.stripPrefix</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;WAL=on &quot;</span></span><span>  </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145522"><span class="hs-identifier hs-var">connStr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145525"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679145527"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145527"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">T.stripPrefix</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;WAL=off &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145522"><span class="hs-identifier hs-var">connStr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145527"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145522"><span class="hs-identifier hs-var">connStr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>
</span><span id="line-802"></span><span class="hs-comment">-- | Information required to connect to a sqlite database. We export</span><span>
</span><span id="line-803"></span><span class="hs-comment">-- lenses instead of fields to avoid being limited to the current</span><span>
</span><span id="line-804"></span><span class="hs-comment">-- implementation.</span><span>
</span><span id="line-805"></span><span class="hs-comment">--</span><span>
</span><span id="line-806"></span><span class="hs-comment">-- @since 2.6.2</span><span>
</span><span id="line-807"></span><span class="hs-keyword">data</span><span> </span><span id="SqliteConnectionInfo"><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-var">SqliteConnectionInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SqliteConnectionInfo"><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-var">SqliteConnectionInfo</span></a></span></span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_sqlConnectionStr"><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Text
</span><a href="Database.Persist.Sqlite.html#_sqlConnectionStr"><span class="hs-identifier hs-var hs-var">_sqlConnectionStr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ connection string for the database. Use @:memory:@ for an in-memory database.</span></span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_walEnabled"><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Bool
</span><a href="Database.Persist.Sqlite.html#_walEnabled"><span class="hs-identifier hs-var hs-var">_walEnabled</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ if the write-ahead log is enabled - see https://github.com/yesodweb/persistent/issues/363.</span></span><span>
</span><span id="line-810"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_fkEnabled"><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; Bool
</span><a href="Database.Persist.Sqlite.html#_fkEnabled"><span class="hs-identifier hs-var hs-var">_fkEnabled</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ if foreign-key constraints are enabled.</span></span><span>
</span><span id="line-811"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_extraPragmas"><span class="annot"><span class="annottext">SqliteConnectionInfo -&gt; [Text]
</span><a href="Database.Persist.Sqlite.html#_extraPragmas"><span class="hs-identifier hs-var hs-var">_extraPragmas</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ additional pragmas to be set on initialization</span></span><span>
</span><span id="line-812"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679145529"><span id="local-6989586621679145537"><span id="local-6989586621679145540"><span class="annot"><span class="annottext">Int -&gt; SqliteConnectionInfo -&gt; String -&gt; String
[SqliteConnectionInfo] -&gt; String -&gt; String
SqliteConnectionInfo -&gt; String
(Int -&gt; SqliteConnectionInfo -&gt; String -&gt; String)
-&gt; (SqliteConnectionInfo -&gt; String)
-&gt; ([SqliteConnectionInfo] -&gt; String -&gt; String)
-&gt; Show SqliteConnectionInfo
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Int -&gt; SqliteConnectionInfo -&gt; String -&gt; String
showsPrec :: Int -&gt; SqliteConnectionInfo -&gt; String -&gt; String
$cshow :: SqliteConnectionInfo -&gt; String
show :: SqliteConnectionInfo -&gt; String
$cshowList :: [SqliteConnectionInfo] -&gt; String -&gt; String
showList :: [SqliteConnectionInfo] -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679145544"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-815"></span><span>    </span><span id="local-6989586621679145560"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser SqliteConnectionInfo
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span id="local-6989586621679145561"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679145561"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String)
-&gt; Parser SqliteConnectionInfo -&gt; Parser SqliteConnectionInfo
forall a. (String -&gt; String) -&gt; Parser a -&gt; Parser a
</span><span class="hs-identifier hs-var">modifyFailure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Persistent: error loading SqliteConnectionInfo: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Parser SqliteConnectionInfo -&gt; Parser SqliteConnectionInfo)
-&gt; Parser SqliteConnectionInfo -&gt; Parser SqliteConnectionInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-816"></span><span>      </span><span class="annot"><span class="annottext">((Object -&gt; Parser SqliteConnectionInfo)
 -&gt; Value -&gt; Parser SqliteConnectionInfo)
-&gt; Value
-&gt; (Object -&gt; Parser SqliteConnectionInfo)
-&gt; Parser SqliteConnectionInfo
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; (Object -&gt; Parser SqliteConnectionInfo)
-&gt; Value
-&gt; Parser SqliteConnectionInfo
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SqliteConnectionInfo&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679145561"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser SqliteConnectionInfo)
 -&gt; Parser SqliteConnectionInfo)
-&gt; (Object -&gt; Parser SqliteConnectionInfo)
-&gt; Parser SqliteConnectionInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679145562"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145562"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Bool -&gt; [Text] -&gt; SqliteConnectionInfo
</span><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-var">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-817"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; Bool -&gt; Bool -&gt; [Text] -&gt; SqliteConnectionInfo)
-&gt; Parser Text
-&gt; Parser (Bool -&gt; Bool -&gt; [Text] -&gt; SqliteConnectionInfo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145562"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Text
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;connectionString&quot;</span></span><span>
</span><span id="line-818"></span><span>        </span><span class="annot"><span class="annottext">Parser (Bool -&gt; Bool -&gt; [Text] -&gt; SqliteConnectionInfo)
-&gt; Parser Bool -&gt; Parser (Bool -&gt; [Text] -&gt; SqliteConnectionInfo)
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145562"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Bool
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;walEnabled&quot;</span></span><span>
</span><span id="line-819"></span><span>        </span><span class="annot"><span class="annottext">Parser (Bool -&gt; [Text] -&gt; SqliteConnectionInfo)
-&gt; Parser Bool -&gt; Parser ([Text] -&gt; SqliteConnectionInfo)
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145562"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Bool
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;fkEnabled&quot;</span></span><span>
</span><span id="line-820"></span><span>        </span><span class="annot"><span class="annottext">Parser ([Text] -&gt; SqliteConnectionInfo)
-&gt; Parser [Text] -&gt; Parser SqliteConnectionInfo
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679145562"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe [Text])
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;extraPragmas&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser (Maybe [Text]) -&gt; [Text] -&gt; Parser [Text]
forall a. Parser (Maybe a) -&gt; a -&gt; Parser a
</span><span class="hs-operator hs-var">.!=</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span class="hs-comment">-- | Data type for reporting foreign key violations using 'checkForeignKeys'.</span><span>
</span><span id="line-823"></span><span class="hs-comment">--</span><span>
</span><span id="line-824"></span><span class="hs-comment">-- @since 2.11.1</span><span>
</span><span id="line-825"></span><span class="hs-keyword">data</span><span> </span><span id="ForeignKeyViolation"><span class="annot"><a href="Database.Persist.Sqlite.html#ForeignKeyViolation"><span class="hs-identifier hs-var">ForeignKeyViolation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ForeignKeyViolation"><span class="annot"><a href="Database.Persist.Sqlite.html#ForeignKeyViolation"><span class="hs-identifier hs-var">ForeignKeyViolation</span></a></span></span><span>
</span><span id="line-826"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="foreignKeyTable"><span class="annot"><span class="annottext">ForeignKeyViolation -&gt; Text
</span><a href="Database.Persist.Sqlite.html#foreignKeyTable"><span class="hs-identifier hs-var hs-var">foreignKeyTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The table of the violated constraint</span></span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="foreignKeyColumn"><span class="annot"><span class="annottext">ForeignKeyViolation -&gt; Text
</span><a href="Database.Persist.Sqlite.html#foreignKeyColumn"><span class="hs-identifier hs-var hs-var">foreignKeyColumn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The column of the violated constraint</span></span><span>
</span><span id="line-828"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="foreignKeyRowId"><span class="annot"><span class="annottext">ForeignKeyViolation -&gt; Int64
</span><a href="Database.Persist.Sqlite.html#foreignKeyRowId"><span class="hs-identifier hs-var hs-var">foreignKeyRowId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The ROWID of the row with the violated foreign key constraint</span></span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679145570"><span id="local-6989586621679145576"><span class="annot"><span class="annottext">ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
(ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool)
-&gt; (ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool)
-&gt; Eq ForeignKeyViolation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
== :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
$c/= :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
/= :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145583"><span id="local-6989586621679145589"><span id="local-6989586621679145594"><span id="local-6989586621679145598"><span id="local-6989586621679145601"><span id="local-6989586621679145604"><span id="local-6989586621679145607"><span class="annot"><span class="annottext">Eq ForeignKeyViolation
Eq ForeignKeyViolation =&gt;
(ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Ordering)
-&gt; (ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool)
-&gt; (ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool)
-&gt; (ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool)
-&gt; (ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool)
-&gt; (ForeignKeyViolation
    -&gt; ForeignKeyViolation -&gt; ForeignKeyViolation)
-&gt; (ForeignKeyViolation
    -&gt; ForeignKeyViolation -&gt; ForeignKeyViolation)
-&gt; Ord ForeignKeyViolation
ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Ordering
ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; ForeignKeyViolation
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Ordering
compare :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Ordering
$c&lt; :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
&lt; :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
$c&lt;= :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
&lt;= :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
$c&gt; :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
&gt; :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
$c&gt;= :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
&gt;= :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; Bool
$cmax :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; ForeignKeyViolation
max :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; ForeignKeyViolation
$cmin :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; ForeignKeyViolation
min :: ForeignKeyViolation -&gt; ForeignKeyViolation -&gt; ForeignKeyViolation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679145611"><span id="local-6989586621679145618"><span id="local-6989586621679145622"><span class="annot"><span class="annottext">Int -&gt; ForeignKeyViolation -&gt; String -&gt; String
[ForeignKeyViolation] -&gt; String -&gt; String
ForeignKeyViolation -&gt; String
(Int -&gt; ForeignKeyViolation -&gt; String -&gt; String)
-&gt; (ForeignKeyViolation -&gt; String)
-&gt; ([ForeignKeyViolation] -&gt; String -&gt; String)
-&gt; Show ForeignKeyViolation
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Int -&gt; ForeignKeyViolation -&gt; String -&gt; String
showsPrec :: Int -&gt; ForeignKeyViolation -&gt; String -&gt; String
$cshow :: ForeignKeyViolation -&gt; String
show :: ForeignKeyViolation -&gt; String
$cshowList :: [ForeignKeyViolation] -&gt; String -&gt; String
showList :: [ForeignKeyViolation] -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span class="hs-comment">-- | Outputs all (if any) the violated foreign key constraints in the database.</span><span>
</span><span id="line-832"></span><span class="hs-comment">--</span><span>
</span><span id="line-833"></span><span class="hs-comment">-- The main use is to validate that no foreign key constraints were</span><span>
</span><span id="line-834"></span><span class="hs-comment">-- broken/corrupted by anyone operating on the database with foreign keys</span><span>
</span><span id="line-835"></span><span class="hs-comment">-- disabled. See 'fkEnabled'.</span><span>
</span><span id="line-836"></span><span class="hs-comment">--</span><span>
</span><span id="line-837"></span><span class="hs-comment">-- @since 2.11.1</span><span>
</span><span id="line-838"></span><span id="local-6989586621679144276"><span id="local-6989586621679144278"><span class="annot"><a href="Database.Persist.Sqlite.html#checkForeignKeys"><span class="hs-identifier hs-type">checkForeignKeys</span></a></span><span>
</span><span id="line-839"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadResource</span></span><span> </span><span class="annot"><a href="#local-6989586621679144276"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679144278"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144276"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BackendCompatible</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="annot"><a href="#local-6989586621679144278"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#ForeignKeyViolation"><span class="hs-identifier hs-type">ForeignKeyViolation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144276"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-841"></span><span id="checkForeignKeys"><span class="annot"><span class="annottext">checkForeignKeys :: forall (m :: * -&gt; *) env.
(MonadResource m, MonadReader env m,
 BackendCompatible SqlBackend env) =&gt;
ConduitM () ForeignKeyViolation m ()
</span><a href="Database.Persist.Sqlite.html#checkForeignKeys"><span class="hs-identifier hs-var hs-var">checkForeignKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [PersistValue] -&gt; ConduitM () [PersistValue] m ()
forall (m :: * -&gt; *) env.
(MonadResource m, MonadReader env m,
 BackendCompatible SqlBackend env) =&gt;
Text -&gt; [PersistValue] -&gt; ConduitM () [PersistValue] m ()
</span><span class="hs-identifier hs-var">rawQuery</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145638"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ConduitM () [PersistValue] m ()
-&gt; ConduitT [PersistValue] ForeignKeyViolation m ()
-&gt; ConduitT () ForeignKeyViolation m ()
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">([PersistValue] -&gt; m ForeignKeyViolation)
-&gt; ConduitT [PersistValue] ForeignKeyViolation m ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; ConduitT a b m ()
</span><span class="hs-identifier hs-var">C.mapM</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue] -&gt; m ForeignKeyViolation
forall {m :: * -&gt; *}.
MonadIO m =&gt;
[PersistValue] -&gt; m ForeignKeyViolation
</span><a href="#local-6989586621679145640"><span class="hs-identifier hs-var">parse</span></a></span><span>
</span><span id="line-842"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-843"></span><span>    </span><span id="local-6989586621679145640"><span class="annot"><span class="annottext">parse :: [PersistValue] -&gt; m ForeignKeyViolation
</span><a href="#local-6989586621679145640"><span class="hs-identifier hs-var hs-var">parse</span></a></span></span><span> </span><span id="local-6989586621679145661"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145661"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145661"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-844"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistInt64</span></span><span> </span><span id="local-6989586621679145663"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679145663"><span class="hs-identifier hs-var">rowid</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistText</span></span><span> </span><span id="local-6989586621679145664"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145664"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistText</span></span><span> </span><span id="local-6989586621679145665"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145665"><span class="hs-identifier hs-var">column</span></a></span></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-845"></span><span>            </span><span class="annot"><span class="annottext">ForeignKeyViolation -&gt; m ForeignKeyViolation
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#ForeignKeyViolation"><span class="hs-identifier hs-type">ForeignKeyViolation</span></a></span><span>
</span><span id="line-846"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">foreignKeyTable :: Text
</span><a href="Database.Persist.Sqlite.html#foreignKeyTable"><span class="hs-identifier hs-var">foreignKeyTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145664"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-847"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">foreignKeyColumn :: Text
</span><a href="Database.Persist.Sqlite.html#foreignKeyColumn"><span class="hs-identifier hs-var">foreignKeyColumn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679145665"><span class="hs-identifier hs-var">column</span></a></span><span>
</span><span id="line-848"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">foreignKeyRowId :: Int64
</span><a href="Database.Persist.Sqlite.html#foreignKeyRowId"><span class="hs-identifier hs-var">foreignKeyRowId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679145663"><span class="hs-identifier hs-var">rowid</span></a></span><span>
</span><span id="line-849"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-850"></span><span>        </span><span class="annot"><span class="annottext">[PersistValue]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ForeignKeyViolation -&gt; m ForeignKeyViolation
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ForeignKeyViolation -&gt; m ForeignKeyViolation)
-&gt; (Text -&gt; IO ForeignKeyViolation)
-&gt; Text
-&gt; m ForeignKeyViolation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PersistException -&gt; IO ForeignKeyViolation
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">E.throwIO</span></span><span> </span><span class="annot"><span class="annottext">(PersistException -&gt; IO ForeignKeyViolation)
-&gt; (Text -&gt; PersistException) -&gt; Text -&gt; IO ForeignKeyViolation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PersistException
</span><span class="hs-identifier hs-var">PersistMarshalError</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ForeignKeyViolation) -&gt; Text -&gt; m ForeignKeyViolation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-851"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Unexpected result from foreign key check:\n&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PersistValue] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679145661"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span>    </span><span id="local-6989586621679145638"><span class="annot"><span class="annottext">query :: Text
</span><a href="#local-6989586621679145638"><span class="hs-identifier hs-var hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span>
</span><span id="line-854"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SELECT origin.rowid, origin.\&quot;table\&quot;, group_concat(foreignkeys.\&quot;from\&quot;)&quot;</span></span><span>
</span><span id="line-855"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;FROM pragma_foreign_key_check() AS origin&quot;</span></span><span>
</span><span id="line-856"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;INNER JOIN pragma_foreign_key_list(origin.\&quot;table\&quot;) AS foreignkeys&quot;</span></span><span>
</span><span id="line-857"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ON origin.fkid = foreignkeys.id AND origin.parent = foreignkeys.\&quot;table\&quot;&quot;</span></span><span>
</span><span id="line-858"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;GROUP BY origin.rowid&quot;</span></span><span>
</span><span id="line-859"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-860"></span><span>
</span><span id="line-861"></span><span class="hs-comment">-- | Like `withSqliteConnInfo`, but exposes the internal `Sqlite.Connection`.</span><span>
</span><span id="line-862"></span><span class="hs-comment">-- For power users who want to manually interact with SQLite's C API via</span><span>
</span><span id="line-863"></span><span class="hs-comment">-- internals exposed by &quot;Database.Sqlite.Internal&quot;</span><span>
</span><span id="line-864"></span><span class="hs-comment">--</span><span>
</span><span id="line-865"></span><span class="hs-comment">-- @since 2.10.2</span><span>
</span><span id="line-866"></span><span id="local-6989586621679144292"><span id="local-6989586621679144294"><span class="annot"><a href="Database.Persist.Sqlite.html#withRawSqliteConnInfo"><span class="hs-identifier hs-type">withRawSqliteConnInfo</span></a></span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144292"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144292"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144292"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144294"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144292"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144294"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-871"></span><span id="withRawSqliteConnInfo"><span class="annot"><span class="annottext">withRawSqliteConnInfo :: forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
SqliteConnectionInfo -&gt; (RawSqlite SqlBackend -&gt; m a) -&gt; m a
</span><a href="Database.Persist.Sqlite.html#withRawSqliteConnInfo"><span class="hs-identifier hs-var hs-var">withRawSqliteConnInfo</span></a></span></span><span> </span><span id="local-6989586621679145680"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145680"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span id="local-6989586621679145681"><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; m a
</span><a href="#local-6989586621679145681"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-872"></span><span>    </span><span id="local-6989586621679145682"><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145682"><span class="hs-identifier hs-var">logFunc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m LogFunc
forall (m :: * -&gt; *). MonadLoggerIO m =&gt; m LogFunc
</span><span class="hs-identifier hs-var">askLoggerIO</span></span><span>
</span><span id="line-873"></span><span>    </span><span class="annot"><span class="annottext">((forall a. m a -&gt; IO a) -&gt; IO a) -&gt; m a
forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b
forall (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b
</span><span class="hs-identifier hs-var">withRunInIO</span></span><span> </span><span class="annot"><span class="annottext">(((forall a. m a -&gt; IO a) -&gt; IO a) -&gt; m a)
-&gt; ((forall a. m a -&gt; IO a) -&gt; IO a) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679145683"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621679145683"><span class="hs-identifier hs-var">run</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (RawSqlite SqlBackend)
-&gt; (RawSqlite SqlBackend -&gt; IO ())
-&gt; (RawSqlite SqlBackend -&gt; IO a)
-&gt; IO a
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">E.bracket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogFunc -&gt; IO (RawSqlite SqlBackend)
</span><a href="#local-6989586621679145685"><span class="hs-identifier hs-var">openBackend</span></a></span><span> </span><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145682"><span class="hs-identifier hs-var">logFunc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; IO ()
</span><a href="#local-6989586621679145686"><span class="hs-identifier hs-var">closeBackend</span></a></span><span> </span><span class="annot"><span class="annottext">((RawSqlite SqlBackend -&gt; IO a) -&gt; IO a)
-&gt; (RawSqlite SqlBackend -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m a -&gt; IO a
forall a. m a -&gt; IO a
</span><a href="#local-6989586621679145683"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; IO a)
-&gt; (RawSqlite SqlBackend -&gt; m a) -&gt; RawSqlite SqlBackend -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; m a
</span><a href="#local-6989586621679145681"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-875"></span><span>    </span><span id="local-6989586621679145685"><span class="annot"><span class="annottext">openBackend :: LogFunc -&gt; IO (RawSqlite SqlBackend)
</span><a href="#local-6989586621679145685"><span class="hs-identifier hs-var hs-var">openBackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; Connection -&gt; RawSqlite SqlBackend)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO (RawSqlite SqlBackend)
forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var">openWith</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; RawSqlite SqlBackend
forall backend. backend -&gt; Connection -&gt; RawSqlite backend
</span><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-var">RawSqlite</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145680"><span class="hs-identifier hs-var">connInfo</span></a></span><span>
</span><span id="line-876"></span><span>    </span><span id="local-6989586621679145686"><span class="annot"><span class="annottext">closeBackend :: RawSqlite SqlBackend -&gt; IO ()
</span><a href="#local-6989586621679145686"><span class="hs-identifier hs-var hs-var">closeBackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; IO ()
forall backend.
BackendCompatible SqlBackend backend =&gt;
backend -&gt; IO ()
</span><span class="hs-identifier hs-var">close'</span></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; IO ())
-&gt; (RawSqlite SqlBackend -&gt; SqlBackend)
-&gt; RawSqlite SqlBackend
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; SqlBackend
forall backend. RawSqlite backend -&gt; backend
</span><a href="Database.Persist.Sqlite.html#_persistentBackend"><span class="hs-identifier hs-var">_persistentBackend</span></a></span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span class="hs-comment">-- | Like `createSqlitePoolFromInfo`, but like `withRawSqliteConnInfo` it</span><span>
</span><span id="line-879"></span><span class="hs-comment">-- exposes the internal `Sqlite.Connection`.</span><span>
</span><span id="line-880"></span><span class="hs-comment">--</span><span>
</span><span id="line-881"></span><span class="hs-comment">-- For power users who want to manually interact with SQLite's C API via</span><span>
</span><span id="line-882"></span><span class="hs-comment">-- internals exposed by &quot;Database.Sqlite.Internal&quot;. The callback can be used to</span><span>
</span><span id="line-883"></span><span class="hs-comment">-- run arbitrary actions on the connection upon allocation from the pool.</span><span>
</span><span id="line-884"></span><span class="hs-comment">--</span><span>
</span><span id="line-885"></span><span class="hs-comment">-- @since 2.10.6</span><span>
</span><span id="line-886"></span><span id="local-6989586621679144302"><span class="annot"><a href="Database.Persist.Sqlite.html#createRawSqlitePoolFromInfo"><span class="hs-identifier hs-type">createRawSqlitePoolFromInfo</span></a></span><span>
</span><span id="line-887"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144302"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144302"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-889"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144302"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-890"></span><span>    </span><span class="hs-comment">-- ^ An action that is run whenever a new `RawSqlite` connection is</span><span>
</span><span id="line-891"></span><span>    </span><span class="hs-comment">-- allocated in the pool. The main use of this function is to register</span><span>
</span><span id="line-892"></span><span>    </span><span class="hs-comment">-- custom functions with the SQLite connection upon creation.</span><span>
</span><span id="line-893"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-894"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144302"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-895"></span><span id="createRawSqlitePoolFromInfo"><span class="annot"><span class="annottext">createRawSqlitePoolFromInfo :: forall (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m) =&gt;
SqliteConnectionInfo
-&gt; (RawSqlite SqlBackend -&gt; m ())
-&gt; Int
-&gt; m (Pool (RawSqlite SqlBackend))
</span><a href="Database.Persist.Sqlite.html#createRawSqlitePoolFromInfo"><span class="hs-identifier hs-var hs-var">createRawSqlitePoolFromInfo</span></a></span></span><span> </span><span id="local-6989586621679145704"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145704"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span id="local-6989586621679145705"><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; m ()
</span><a href="#local-6989586621679145705"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679145706"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145706"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-896"></span><span>    </span><span id="local-6989586621679145707"><span class="annot"><span class="annottext">m () -&gt; IO ()
</span><a href="#local-6989586621679145707"><span class="hs-identifier hs-var">runIO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (m () -&gt; IO ())
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; m (m a -&gt; IO a)
</span><span class="hs-identifier hs-var">askRunInIO</span></span><span>
</span><span id="line-897"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679145708"><span class="annot"><span class="annottext">createRawSqlite :: LogFunc -&gt; IO (RawSqlite SqlBackend)
</span><a href="#local-6989586621679145708"><span class="hs-identifier hs-var hs-var">createRawSqlite</span></a></span></span><span> </span><span id="local-6989586621679145709"><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145709"><span class="hs-identifier hs-var">logFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-898"></span><span>            </span><span id="local-6989586621679145710"><span class="annot"><span class="annottext">RawSqlite SqlBackend
</span><a href="#local-6989586621679145710"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; Connection -&gt; RawSqlite SqlBackend)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO (RawSqlite SqlBackend)
forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var">openWith</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; RawSqlite SqlBackend
forall backend. backend -&gt; Connection -&gt; RawSqlite backend
</span><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-var">RawSqlite</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145704"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145709"><span class="hs-identifier hs-var">logFun</span></a></span><span>
</span><span id="line-899"></span><span>            </span><span class="annot"><span class="annottext">RawSqlite SqlBackend
</span><a href="#local-6989586621679145710"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; IO () -&gt; IO (RawSqlite SqlBackend)
forall a b. a -&gt; IO b -&gt; IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; IO ()
</span><a href="#local-6989586621679145707"><span class="hs-identifier hs-var">runIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; m ()
</span><a href="#local-6989586621679145705"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">RawSqlite SqlBackend
</span><a href="#local-6989586621679145710"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span>    </span><span class="annot"><span class="annottext">(LogFunc -&gt; IO (RawSqlite SqlBackend))
-&gt; Int -&gt; m (Pool (RawSqlite SqlBackend))
forall backend (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m,
 BackendCompatible SqlBackend backend) =&gt;
(LogFunc -&gt; IO backend) -&gt; Int -&gt; m (Pool backend)
</span><span class="hs-identifier hs-var">createSqlPool</span></span><span> </span><span class="annot"><span class="annottext">LogFunc -&gt; IO (RawSqlite SqlBackend)
</span><a href="#local-6989586621679145708"><span class="hs-identifier hs-var">createRawSqlite</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145706"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span class="hs-comment">-- | Like `createRawSqlitePoolFromInfo`, but doesn't require a callback</span><span>
</span><span id="line-904"></span><span class="hs-comment">-- operating on the connection.</span><span>
</span><span id="line-905"></span><span class="hs-comment">--</span><span>
</span><span id="line-906"></span><span class="hs-comment">-- @since 2.10.6</span><span>
</span><span id="line-907"></span><span id="local-6989586621679144309"><span class="annot"><a href="Database.Persist.Sqlite.html#createRawSqlitePoolFromInfo_"><span class="hs-identifier hs-type">createRawSqlitePoolFromInfo_</span></a></span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144309"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144309"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144309"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-910"></span><span id="createRawSqlitePoolFromInfo_"><span class="annot"><span class="annottext">createRawSqlitePoolFromInfo_ :: forall (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m) =&gt;
SqliteConnectionInfo -&gt; Int -&gt; m (Pool (RawSqlite SqlBackend))
</span><a href="Database.Persist.Sqlite.html#createRawSqlitePoolFromInfo_"><span class="hs-identifier hs-var hs-var">createRawSqlitePoolFromInfo_</span></a></span></span><span> </span><span id="local-6989586621679145719"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145719"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-911"></span><span>  </span><span class="annot"><span class="annottext">SqliteConnectionInfo
-&gt; (RawSqlite SqlBackend -&gt; m ())
-&gt; Int
-&gt; m (Pool (RawSqlite SqlBackend))
forall (m :: * -&gt; *).
(MonadLoggerIO m, MonadUnliftIO m) =&gt;
SqliteConnectionInfo
-&gt; (RawSqlite SqlBackend -&gt; m ())
-&gt; Int
-&gt; m (Pool (RawSqlite SqlBackend))
</span><a href="Database.Persist.Sqlite.html#createRawSqlitePoolFromInfo"><span class="hs-identifier hs-var">createRawSqlitePoolFromInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145719"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m () -&gt; RawSqlite SqlBackend -&gt; m ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span class="hs-comment">-- | Like `createSqlitePoolInfo`, but based on `createRawSqlitePoolFromInfo`.</span><span>
</span><span id="line-914"></span><span class="hs-comment">--</span><span>
</span><span id="line-915"></span><span class="hs-comment">-- @since 2.10.6</span><span>
</span><span id="line-916"></span><span id="local-6989586621679144311"><span id="local-6989586621679144312"><span class="annot"><a href="Database.Persist.Sqlite.html#withRawSqlitePoolInfo"><span class="hs-identifier hs-type">withRawSqlitePoolInfo</span></a></span><span>
</span><span id="line-917"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144311"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144311"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-919"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ number of connections to open</span></span><span>
</span><span id="line-921"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144312"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144312"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-923"></span><span id="withRawSqlitePoolInfo"><span class="annot"><span class="annottext">withRawSqlitePoolInfo :: forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
SqliteConnectionInfo
-&gt; (RawSqlite SqlBackend -&gt; m ())
-&gt; Int
-&gt; (Pool (RawSqlite SqlBackend) -&gt; m a)
-&gt; m a
</span><a href="Database.Persist.Sqlite.html#withRawSqlitePoolInfo"><span class="hs-identifier hs-var hs-var">withRawSqlitePoolInfo</span></a></span></span><span> </span><span id="local-6989586621679145731"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145731"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span id="local-6989586621679145732"><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; m ()
</span><a href="#local-6989586621679145732"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679145733"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145733"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679145734"><span class="annot"><span class="annottext">Pool (RawSqlite SqlBackend) -&gt; m a
</span><a href="#local-6989586621679145734"><span class="hs-identifier hs-var">work</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-924"></span><span>    </span><span id="local-6989586621679145735"><span class="annot"><span class="annottext">m () -&gt; IO ()
</span><a href="#local-6989586621679145735"><span class="hs-identifier hs-var">runIO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (m () -&gt; IO ())
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; m (m a -&gt; IO a)
</span><span class="hs-identifier hs-var">askRunInIO</span></span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679145736"><span class="annot"><span class="annottext">createRawSqlite :: LogFunc -&gt; IO (RawSqlite SqlBackend)
</span><a href="#local-6989586621679145736"><span class="hs-identifier hs-var hs-var">createRawSqlite</span></a></span></span><span> </span><span id="local-6989586621679145737"><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145737"><span class="hs-identifier hs-var">logFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-926"></span><span>            </span><span id="local-6989586621679145738"><span class="annot"><span class="annottext">RawSqlite SqlBackend
</span><a href="#local-6989586621679145738"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; Connection -&gt; RawSqlite SqlBackend)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO (RawSqlite SqlBackend)
forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var">openWith</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; RawSqlite SqlBackend
forall backend. backend -&gt; Connection -&gt; RawSqlite backend
</span><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-var">RawSqlite</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145731"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145737"><span class="hs-identifier hs-var">logFun</span></a></span><span>
</span><span id="line-927"></span><span>            </span><span class="annot"><span class="annottext">RawSqlite SqlBackend
</span><a href="#local-6989586621679145738"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; IO () -&gt; IO (RawSqlite SqlBackend)
forall a b. a -&gt; IO b -&gt; IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; IO ()
</span><a href="#local-6989586621679145735"><span class="hs-identifier hs-var">runIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawSqlite SqlBackend -&gt; m ()
</span><a href="#local-6989586621679145732"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">RawSqlite SqlBackend
</span><a href="#local-6989586621679145738"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-928"></span><span>
</span><span id="line-929"></span><span>    </span><span class="annot"><span class="annottext">(LogFunc -&gt; IO (RawSqlite SqlBackend))
-&gt; Int -&gt; (Pool (RawSqlite SqlBackend) -&gt; m a) -&gt; m a
forall backend (m :: * -&gt; *) a.
(MonadLoggerIO m, MonadUnliftIO m,
 BackendCompatible SqlBackend backend) =&gt;
(LogFunc -&gt; IO backend) -&gt; Int -&gt; (Pool backend -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">withSqlPool</span></span><span> </span><span class="annot"><span class="annottext">LogFunc -&gt; IO (RawSqlite SqlBackend)
</span><a href="#local-6989586621679145736"><span class="hs-identifier hs-var">createRawSqlite</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679145733"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Pool (RawSqlite SqlBackend) -&gt; m a
</span><a href="#local-6989586621679145734"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-930"></span><span>
</span><span id="line-931"></span><span class="hs-comment">-- | Like `createSqlitePoolInfo`, but based on `createRawSqlitePoolFromInfo_`.</span><span>
</span><span id="line-932"></span><span class="hs-comment">--</span><span>
</span><span id="line-933"></span><span class="hs-comment">-- @since 2.10.6</span><span>
</span><span id="line-934"></span><span id="local-6989586621679144315"><span id="local-6989586621679144316"><span class="annot"><a href="Database.Persist.Sqlite.html#withRawSqlitePoolInfo_"><span class="hs-identifier hs-type">withRawSqlitePoolInfo_</span></a></span><span>
</span><span id="line-935"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144315"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144315"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-936"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-937"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ number of connections to open</span></span><span>
</span><span id="line-938"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144315"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144316"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144315"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144316"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-940"></span><span id="withRawSqlitePoolInfo_"><span class="annot"><span class="annottext">withRawSqlitePoolInfo_ :: forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
SqliteConnectionInfo
-&gt; Int -&gt; (Pool (RawSqlite SqlBackend) -&gt; m a) -&gt; m a
</span><a href="Database.Persist.Sqlite.html#withRawSqlitePoolInfo_"><span class="hs-identifier hs-var hs-var">withRawSqlitePoolInfo_</span></a></span></span><span> </span><span id="local-6989586621679145746"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145746"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-941"></span><span>  </span><span class="annot"><span class="annottext">SqliteConnectionInfo
-&gt; (RawSqlite SqlBackend -&gt; m ())
-&gt; Int
-&gt; (Pool (RawSqlite SqlBackend) -&gt; m a)
-&gt; m a
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
SqliteConnectionInfo
-&gt; (RawSqlite SqlBackend -&gt; m ())
-&gt; Int
-&gt; (Pool (RawSqlite SqlBackend) -&gt; m a)
-&gt; m a
</span><a href="Database.Persist.Sqlite.html#withRawSqlitePoolInfo"><span class="hs-identifier hs-var">withRawSqlitePoolInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145746"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m () -&gt; RawSqlite SqlBackend -&gt; m ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span class="hs-comment">-- | Wrapper for persistent SqlBackends that carry the corresponding</span><span>
</span><span id="line-944"></span><span class="hs-comment">-- `Sqlite.Connection`.</span><span>
</span><span id="line-945"></span><span class="hs-comment">--</span><span>
</span><span id="line-946"></span><span class="hs-comment">-- @since 2.10.2</span><span>
</span><span id="line-947"></span><span class="hs-keyword">data</span><span> </span><span id="RawSqlite"><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-var">RawSqlite</span></a></span></span><span> </span><span id="local-6989586621679144300"><span class="annot"><a href="#local-6989586621679144300"><span class="hs-identifier hs-type">backend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RawSqlite"><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-var">RawSqlite</span></a></span></span><span>
</span><span id="line-948"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_persistentBackend"><span class="annot"><span class="annottext">forall backend. RawSqlite backend -&gt; backend
</span><a href="Database.Persist.Sqlite.html#_persistentBackend"><span class="hs-identifier hs-var hs-var">_persistentBackend</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679144300"><span class="hs-identifier hs-type">backend</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The persistent backend</span></span><span>
</span><span id="line-949"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_rawSqliteConnection"><span class="annot"><span class="annottext">forall backend. RawSqlite backend -&gt; Connection
</span><a href="Database.Persist.Sqlite.html#_rawSqliteConnection"><span class="hs-identifier hs-var hs-var">_rawSqliteConnection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Sqlite.Internal.html#Connection"><span class="hs-identifier hs-type">Sqlite.Connection</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The underlying `Sqlite.Connection`</span></span><span>
</span><span id="line-950"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span class="hs-comment">-- | Open a @'RawSqlite' 'SqlBackend'@ connection from a 'SqliteConnectionInfo'.</span><span>
</span><span id="line-953"></span><span class="hs-comment">--</span><span>
</span><span id="line-954"></span><span class="hs-comment">-- When using this function, the caller has to accept the responsibility of</span><span>
</span><span id="line-955"></span><span class="hs-comment">-- cleaning up the resulting connection. To do this, use 'close' with the</span><span>
</span><span id="line-956"></span><span class="hs-comment">-- 'rawSqliteConnection' - it's enough to simply drop the 'persistBackend'</span><span>
</span><span id="line-957"></span><span class="hs-comment">-- afterwards.</span><span>
</span><span id="line-958"></span><span class="hs-comment">--</span><span>
</span><span id="line-959"></span><span class="hs-comment">-- @since 2.13.2</span><span>
</span><span id="line-960"></span><span id="local-6989586621679144321"><span class="annot"><a href="Database.Persist.Sqlite.html#openRawSqliteConn"><span class="hs-identifier hs-type">openRawSqliteConn</span></a></span><span>
</span><span id="line-961"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144321"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679144321"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sqlite.html#SqliteConnectionInfo"><span class="hs-identifier hs-type">SqliteConnectionInfo</span></a></span><span>
</span><span id="line-963"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679144321"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-964"></span><span id="openRawSqliteConn"><span class="annot"><span class="annottext">openRawSqliteConn :: forall (m :: * -&gt; *).
(MonadUnliftIO m, MonadLoggerIO m) =&gt;
SqliteConnectionInfo -&gt; m (RawSqlite SqlBackend)
</span><a href="Database.Persist.Sqlite.html#openRawSqliteConn"><span class="hs-identifier hs-var hs-var">openRawSqliteConn</span></a></span></span><span> </span><span id="local-6989586621679145756"><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145756"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-965"></span><span>    </span><span id="local-6989586621679145757"><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145757"><span class="hs-identifier hs-var">logFunc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m LogFunc
forall (m :: * -&gt; *). MonadLoggerIO m =&gt; m LogFunc
</span><span class="hs-identifier hs-var">askLoggerIO</span></span><span>
</span><span id="line-966"></span><span>    </span><span class="annot"><span class="annottext">IO (RawSqlite SqlBackend) -&gt; m (RawSqlite SqlBackend)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (RawSqlite SqlBackend) -&gt; m (RawSqlite SqlBackend))
-&gt; IO (RawSqlite SqlBackend) -&gt; m (RawSqlite SqlBackend)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SqlBackend -&gt; Connection -&gt; RawSqlite SqlBackend)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO (RawSqlite SqlBackend)
forall r.
(SqlBackend -&gt; Connection -&gt; r)
-&gt; SqliteConnectionInfo -&gt; LogFunc -&gt; IO r
</span><a href="Database.Persist.Sqlite.html#openWith"><span class="hs-identifier hs-var">openWith</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend -&gt; Connection -&gt; RawSqlite SqlBackend
forall backend. backend -&gt; Connection -&gt; RawSqlite backend
</span><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-var">RawSqlite</span></a></span><span> </span><span class="annot"><span class="annottext">SqliteConnectionInfo
</span><a href="#local-6989586621679145756"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="annot"><span class="annottext">LogFunc
</span><a href="#local-6989586621679145757"><span class="hs-identifier hs-var">logFunc</span></a></span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679144304"><span class="annot"><span class="hs-identifier hs-type">BackendCompatible</span></span><span> </span><span class="annot"><a href="#local-6989586621679144304"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144304"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-969"></span><span>    </span><span id="local-6989586621679145760"><span class="annot"><span class="annottext">projectBackend :: RawSqlite b -&gt; b
</span><a href="#local-6989586621679145760"><span class="hs-identifier hs-var hs-var hs-var hs-var">projectBackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawSqlite b -&gt; b
forall backend. RawSqlite backend -&gt; backend
</span><a href="Database.Persist.Sqlite.html#_persistentBackend"><span class="hs-identifier hs-var">_persistentBackend</span></a></span><span class="hs-cpp">

#if MIN_VERSION_base(4,12,0)
</span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679144329"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PersistCore</span></span><span> </span><span class="annot"><a href="#local-6989586621679144329"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistCore</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144329"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-973"></span><span>  </span><span class="hs-keyword">newtype</span><span> </span><span id="BackendKey"><span class="annot"><span class="hs-identifier hs-var">BackendKey</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144329"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RawSqliteKey"><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqliteKey"><span class="hs-identifier hs-var">RawSqliteKey</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unRawSqliteKey"><span class="annot"><span class="annottext">forall b.
BackendKey (RawSqlite b) -&gt; BackendKey (Compatible b (RawSqlite b))
</span><a href="Database.Persist.Sqlite.html#unRawSqliteKey"><span class="hs-identifier hs-var hs-var">unRawSqliteKey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BackendKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Compatible</span></span><span> </span><span class="annot"><a href="#local-6989586621679144329"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sqlite.html#RawSqlite"><span class="hs-identifier hs-type">RawSqlite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679144329"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span id="local-6989586621679144389"><span id="local-6989586621679145771"><span id="local-6989586621679145777"><span id="local-6989586621679145785"><span id="local-6989586621679145791"><span id="local-6989586621679145796"><span id="local-6989586621679145801"><span id="local-6989586621679145809"><span id="local-6989586621679145815"><span id="local-6989586621679145823"><span id="local-6989586621679145829"><span id="local-6989586621679145834"><span id="local-6989586621679145839"><span id="local-6989586621679145844"><span id="local-6989586621679145849"><span id="local-6989586621679145854"><span id="local-6989586621679145859"><span id="local-6989586621679145875"><span id="local-6989586621679145888"><span id="local-6989586621679145897"><span id="local-6989586621679145903"><span id="local-6989586621679145919"><span id="local-6989586621679145925"><span id="local-6989586621679145930"><span id="local-6989586621679145935"><span id="local-6989586621679145940"><span id="local-6989586621679145945"><span id="local-6989586621679145950"><span id="local-6989586621679145958"><span id="local-6989586621679145964"><span id="local-6989586621679145969"><span id="local-6989586621679145974"><span id="local-6989586621679145979"><span id="local-6989586621679145984"><span id="local-6989586621679145989"><span id="local-6989586621679146001"><span id="local-6989586621679146007"><span id="local-6989586621679146012"><span id="local-6989586621679146017"><span id="local-6989586621679146022"><span id="local-6989586621679146027"><span id="local-6989586621679146032"><span id="local-6989586621679146040"><span id="local-6989586621679146046"><span id="local-6989586621679146054"><span id="local-6989586621679146060"><span id="local-6989586621679146065"><span id="local-6989586621679146070"><span id="local-6989586621679146078"><span id="local-6989586621679146084"><span id="local-6989586621679146089"><span class="hs-identifier">makeCompatibleKeyInstances</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">b</span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">Compatible</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-cpp">
#else
</span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistCore</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistCore</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-978"></span><span>  </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">RawSqliteKey</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">unRawSqliteKey</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Read</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Read</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-982"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Eq</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ord</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Ord</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Num</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Num</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-985"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Integral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Integral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-986"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistField</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistField</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-987"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistFieldSql</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistFieldSql</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-988"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Real</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Real</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Enum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Enum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-990"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Bounded</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Bounded</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ToJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">ToJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-992"></span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FromJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">FromJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">

#if MIN_VERSION_base(4,12,0)
</span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-998"></span><span>
</span><span id="line-999"></span><span id="local-6989586621679144613"><span id="local-6989586621679146131"><span id="local-6989586621679146151"><span id="local-6989586621679146172"><span id="local-6989586621679146195"><span id="local-6989586621679146218"><span id="local-6989586621679146239"><span id="local-6989586621679146267"><span id="local-6989586621679146285"><span id="local-6989586621679146339"><span id="local-6989586621679146361"><span id="local-6989586621679146382"><span id="local-6989586621679146403"><span id="local-6989586621679146422"><span id="local-6989586621679146439"><span id="local-6989586621679146456"><span id="local-6989586621679146473"><span id="local-6989586621679146490"><span id="local-6989586621679146507"><span id="local-6989586621679146524"><span id="local-6989586621679146541"><span id="local-6989586621679146563"><span id="local-6989586621679146581"><span id="local-6989586621679146608"><span id="local-6989586621679146628"><span id="local-6989586621679146647"><span id="local-6989586621679146666"><span id="local-6989586621679146683"><span id="local-6989586621679146733"><span id="local-6989586621679146751"><span id="local-6989586621679146763"><span class="hs-identifier">makeCompatibleInstances</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">b</span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">Compatible</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-cpp">
#else
</span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">HasPersistBackend</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">HasPersistBackend</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1002"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">BaseBackend</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">BaseBackend</span><span> </span><span class="hs-identifier">b</span><span>
</span><span id="line-1003"></span><span>    </span><span class="hs-identifier">persistBackend</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">persistBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">_persistentBackend</span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistStoreRead</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistStoreRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1006"></span><span>    </span><span class="hs-identifier">get</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">get</span><span>
</span><span id="line-1007"></span><span>    </span><span class="hs-identifier">getMany</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">getMany</span><span>
</span><span id="line-1008"></span><span>
</span><span id="line-1009"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistQueryRead</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistQueryRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1010"></span><span>    </span><span class="hs-identifier">selectSourceRes</span><span> </span><span class="hs-identifier">filts</span><span> </span><span class="hs-identifier">opts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">selectSourceRes</span><span> </span><span class="hs-identifier">filts</span><span> </span><span class="hs-identifier">opts</span><span>
</span><span id="line-1011"></span><span>    </span><span class="hs-identifier">selectFirst</span><span> </span><span class="hs-identifier">filts</span><span> </span><span class="hs-identifier">opts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">selectFirst</span><span> </span><span class="hs-identifier">filts</span><span> </span><span class="hs-identifier">opts</span><span>
</span><span id="line-1012"></span><span>    </span><span class="hs-identifier">selectKeysRes</span><span> </span><span class="hs-identifier">filts</span><span> </span><span class="hs-identifier">opts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">selectKeysRes</span><span> </span><span class="hs-identifier">filts</span><span> </span><span class="hs-identifier">opts</span><span>
</span><span id="line-1013"></span><span>    </span><span class="hs-identifier">count</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">count</span><span>
</span><span id="line-1014"></span><span>    </span><span class="hs-identifier">exists</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">exists</span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistQueryWrite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistQueryWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1017"></span><span>    </span><span class="hs-identifier">updateWhere</span><span> </span><span class="hs-identifier">filts</span><span> </span><span class="hs-identifier">updates</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">updateWhere</span><span> </span><span class="hs-identifier">filts</span><span> </span><span class="hs-identifier">updates</span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-identifier">deleteWhere</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">deleteWhere</span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistUniqueRead</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistUniqueRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1021"></span><span>    </span><span class="hs-identifier">getBy</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">getBy</span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistStoreWrite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistStoreWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1024"></span><span>    </span><span class="hs-identifier">insert</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">insert</span><span>
</span><span id="line-1025"></span><span>    </span><span class="hs-identifier">insert_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">insert_</span><span>
</span><span id="line-1026"></span><span>    </span><span class="hs-identifier">insertMany</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">insertMany</span><span>
</span><span id="line-1027"></span><span>    </span><span class="hs-identifier">insertMany_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">insertMany_</span><span>
</span><span id="line-1028"></span><span>    </span><span class="hs-identifier">insertEntityMany</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">insertEntityMany</span><span>
</span><span id="line-1029"></span><span>    </span><span class="hs-identifier">insertKey</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">insertKey</span><span> </span><span class="hs-identifier">k</span><span>
</span><span id="line-1030"></span><span>    </span><span class="hs-identifier">repsert</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">repsert</span><span> </span><span class="hs-identifier">k</span><span>
</span><span id="line-1031"></span><span>    </span><span class="hs-identifier">repsertMany</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">repsertMany</span><span>
</span><span id="line-1032"></span><span>    </span><span class="hs-identifier">replace</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">replace</span><span> </span><span class="hs-identifier">k</span><span>
</span><span id="line-1033"></span><span>    </span><span class="hs-identifier">delete</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">delete</span><span>
</span><span id="line-1034"></span><span>    </span><span class="hs-identifier">update</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">update</span><span> </span><span class="hs-identifier">k</span><span>
</span><span id="line-1035"></span><span>    </span><span class="hs-identifier">updateGet</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">updateGet</span><span> </span><span class="hs-identifier">k</span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistUniqueWrite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistUniqueWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RawSqlite</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1038"></span><span>    </span><span class="hs-identifier">deleteBy</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">deleteBy</span><span>
</span><span id="line-1039"></span><span>    </span><span class="hs-identifier">insertUnique</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">insertUnique</span><span>
</span><span id="line-1040"></span><span>    </span><span class="hs-identifier">upsert</span><span> </span><span class="hs-identifier">rec</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">upsert</span><span> </span><span class="hs-identifier">rec</span><span>
</span><span id="line-1041"></span><span>    </span><span class="hs-identifier">upsertBy</span><span> </span><span class="hs-identifier">uniq</span><span> </span><span class="hs-identifier">rec</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">upsertBy</span><span> </span><span class="hs-identifier">uniq</span><span> </span><span class="hs-identifier">rec</span><span>
</span><span id="line-1042"></span><span>    </span><span class="hs-identifier">putMany</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withReaderT</span><span> </span><span class="hs-identifier">_persistentBackend</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">putMany</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-1045"></span><span id="local-6989586621679144300"><span id="local-6989586621679144615"><span id="persistentBackend"><span id="rawSqliteConnection"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">RawSqlite</span></span></span></span></span><span>
</span><span id="line-1046"></span><span id="sqlConnectionStr"><span id="walEnabled"><span id="fkEnabled"><span id="extraPragmas"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SqliteConnectionInfo</span></span></span></span></span><span>
</span><span id="line-1047"></span></pre></body></html>