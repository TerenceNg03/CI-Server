<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Data.Pool.Internal</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">resource-pool-0.4.0.0: A high-performance striped resource pooling implementation</span><ul class="links" id="page-menu"><li id="quick-jump-button"><a href="#">Quick Jump</a></li><li><a href="src/Data.Pool.Internal.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Data.Pool.Internal</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Internal implementation details for <a href="Data-Pool.html">Data.Pool</a>.</p><p>This module is intended for internal use only, and may change without warning
 in subsequent releases.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Pool">Pool</a> a = <a href="#v:Pool">Pool</a> {<ul class="subs"><li><a href="#v:poolConfig">poolConfig</a> :: !(<a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a)</li><li><a href="#v:localPools">localPools</a> :: !(<a href="../primitive-0.8.0.0/Data-Primitive-SmallArray.html#t:SmallArray" title="Data.Primitive.SmallArray">SmallArray</a> (<a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a))</li><li><a href="#v:reaperRef">reaperRef</a> :: !(<a href="../base-4.18.1.0/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a> ())</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:LocalPool">LocalPool</a> a = <a href="#v:LocalPool">LocalPool</a> {<ul class="subs"><li><a href="#v:stripeId">stripeId</a> :: !<a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:stripeVar">stripeVar</a> :: !(<a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a))</li><li><a href="#v:cleanerRef">cleanerRef</a> :: !(<a href="../base-4.18.1.0/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a> ())</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:Stripe">Stripe</a> a = <a href="#v:Stripe">Stripe</a> {<ul class="subs"><li><a href="#v:available">available</a> :: !<a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:cache">cache</a> :: ![<a href="Data-Pool-Internal.html#t:Entry" title="Data.Pool.Internal">Entry</a> a]</li><li><a href="#v:queue">queue</a> :: !(<a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a)</li><li><a href="#v:queueR">queueR</a> :: !(<a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a)</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:Entry">Entry</a> a = <a href="#v:Entry">Entry</a> {<ul class="subs"><li><a href="#v:entry">entry</a> :: a</li><li><a href="#v:lastUsed">lastUsed</a> :: !<a href="../base-4.18.1.0/Prelude.html#t:Double" title="Prelude">Double</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:Queue">Queue</a> a<ul class="subs"><li>= <a href="#v:Queue">Queue</a> !(<a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a)) (<a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a)</li><li>| <a href="#v:Empty">Empty</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:PoolConfig">PoolConfig</a> a = <a href="#v:PoolConfig">PoolConfig</a> {<ul class="subs"><li><a href="#v:createResource">createResource</a> :: !(<a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> a)</li><li><a href="#v:freeResource">freeResource</a> :: !(a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ())</li><li><a href="#v:poolCacheTTL">poolCacheTTL</a> :: !<a href="../base-4.18.1.0/Prelude.html#t:Double" title="Prelude">Double</a></li><li><a href="#v:poolMaxResources">poolMaxResources</a> :: !<a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:poolNumStripes">poolNumStripes</a> :: !(<a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a>)</li></ul>}</li><li class="src short"><a href="#v:defaultPoolConfig">defaultPoolConfig</a> :: <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; (a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/Prelude.html#t:Double" title="Prelude">Double</a> -&gt; <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a</li><li class="src short"><a href="#v:setNumStripes">setNumStripes</a> :: <a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a -&gt; <a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a</li><li class="src short"><a href="#v:newPool">newPool</a> :: <a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool-Internal.html#t:Pool" title="Data.Pool.Internal">Pool</a> a)</li><li class="src short"><a href="#v:destroyResource">destroyResource</a> :: <a href="Data-Pool-Internal.html#t:Pool" title="Data.Pool.Internal">Pool</a> a -&gt; <a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a -&gt; a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:putResource">putResource</a> :: <a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a -&gt; a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:destroyAllResources">destroyAllResources</a> :: <a href="Data-Pool-Internal.html#t:Pool" title="Data.Pool.Internal">Pool</a> a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:getLocalPool">getLocalPool</a> :: <a href="../primitive-0.8.0.0/Data-Primitive-SmallArray.html#t:SmallArray" title="Data.Primitive.SmallArray">SmallArray</a> (<a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a)</li><li class="src short"><a href="#v:waitForResource">waitForResource</a> :: <a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a) -&gt; <a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a)</li><li class="src short"><a href="#v:restoreSize">restoreSize</a> :: <a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:cleanStripe">cleanStripe</a> :: (<a href="Data-Pool-Internal.html#t:Entry" title="Data.Pool.Internal">Entry</a> a -&gt; <a href="../base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; (a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:signal">signal</a> :: <a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a -&gt; <a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a)</li><li class="src short"><a href="#v:reverseQueue">reverseQueue</a> :: <a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a -&gt; <a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Pool" class="def">Pool</a> a <a href="src/Data.Pool.Internal.html#Pool" class="link">Source</a> <a href="#t:Pool" class="selflink">#</a></p><div class="doc"><p>Striped resource pool based on <a href="../base-4.18.1.0/Control-Concurrent-QSem.html">Control.Concurrent.QSem</a>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Pool" class="def">Pool</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:poolConfig" class="def">poolConfig</a> :: !(<a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a)</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:localPools" class="def">localPools</a> :: !(<a href="../primitive-0.8.0.0/Data-Primitive-SmallArray.html#t:SmallArray" title="Data.Primitive.SmallArray">SmallArray</a> (<a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a))</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:reaperRef" class="def">reaperRef</a> :: !(<a href="../base-4.18.1.0/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a> ())</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LocalPool" class="def">LocalPool</a> a <a href="src/Data.Pool.Internal.html#LocalPool" class="link">Source</a> <a href="#t:LocalPool" class="selflink">#</a></p><div class="doc"><p>A single, local pool.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LocalPool" class="def">LocalPool</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:stripeId" class="def">stripeId</a> :: !<a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:stripeVar" class="def">stripeVar</a> :: !(<a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a))</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:cleanerRef" class="def">cleanerRef</a> :: !(<a href="../base-4.18.1.0/Data-IORef.html#t:IORef" title="Data.IORef">IORef</a> ())</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Stripe" class="def">Stripe</a> a <a href="src/Data.Pool.Internal.html#Stripe" class="link">Source</a> <a href="#t:Stripe" class="selflink">#</a></p><div class="doc"><p>Stripe of a resource pool. If <code>available</code> is 0, the list of threads waiting
 for a resource (each with an associated <code><a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a></code>) is <code>queue ++ reverse queueR</code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Stripe" class="def">Stripe</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:available" class="def">available</a> :: !<a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:cache" class="def">cache</a> :: ![<a href="Data-Pool-Internal.html#t:Entry" title="Data.Pool.Internal">Entry</a> a]</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:queue" class="def">queue</a> :: !(<a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a)</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:queueR" class="def">queueR</a> :: !(<a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a)</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Entry" class="def">Entry</a> a <a href="src/Data.Pool.Internal.html#Entry" class="link">Source</a> <a href="#t:Entry" class="selflink">#</a></p><div class="doc"><p>An existing resource currently sitting in a pool.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Entry" class="def">Entry</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:entry" class="def">entry</a> :: a</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:lastUsed" class="def">lastUsed</a> :: !<a href="../base-4.18.1.0/Prelude.html#t:Double" title="Prelude">Double</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Queue" class="def">Queue</a> a <a href="src/Data.Pool.Internal.html#Queue" class="link">Source</a> <a href="#t:Queue" class="selflink">#</a></p><div class="doc"><p>A queue of MVarS corresponding to threads waiting for resources.</p><p>Basically a monomorphic list to save two pointer indirections.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Queue" class="def">Queue</a> !(<a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a)) (<a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Empty" class="def">Empty</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:PoolConfig" class="def">PoolConfig</a> a <a href="src/Data.Pool.Internal.html#PoolConfig" class="link">Source</a> <a href="#t:PoolConfig" class="selflink">#</a></p><div class="doc"><p>Configuration of a <code><a href="Data-Pool-Internal.html#t:Pool" title="Data.Pool.Internal">Pool</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:PoolConfig" class="def">PoolConfig</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:createResource" class="def">createResource</a> :: !(<a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> a)</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:freeResource" class="def">freeResource</a> :: !(a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ())</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:poolCacheTTL" class="def">poolCacheTTL</a> :: !<a href="../base-4.18.1.0/Prelude.html#t:Double" title="Prelude">Double</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:poolMaxResources" class="def">poolMaxResources</a> :: !<a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:poolNumStripes" class="def">poolNumStripes</a> :: !(<a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a>)</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:defaultPoolConfig" class="def">defaultPoolConfig</a> <a href="src/Data.Pool.Internal.html#defaultPoolConfig" class="link">Source</a> <a href="#v:defaultPoolConfig" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> a</td><td class="doc"><p>The action that creates a new resource.</p></td></tr><tr><td class="src">-&gt; (a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ())</td><td class="doc"><p>The action that destroys an existing resource.</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.1.0/Prelude.html#t:Double" title="Prelude">Double</a></td><td class="doc"><p>The amount of seconds for which an unused resource is kept around. The
 smallest acceptable value is <code>0.5</code>.</p><p><em>Note:</em> the elapsed time before destroying a resource may be a little
 longer than requested, as the collector thread wakes at 1-second intervals.</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>The maximum number of resources to keep open <strong>across all stripes</strong>. The
 smallest acceptable value is <code>1</code>.</p><p><em>Note:</em> for each stripe the number of resources is divided by the number of
 stripes and rounded up, hence the pool might end up creating up to <code>N - 1</code>
 resources more in total than specified, where <code>N</code> is the number of stripes.</p></td></tr><tr><td class="src">-&gt; <a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a <code><a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a></code> with optional parameters having default values.</p><p>For setting optional parameters have a look at:</p><ul><li><code><a href="Data-Pool-Internal.html#v:setNumStripes" title="Data.Pool.Internal">setNumStripes</a></code></li></ul><p><em>Since: 0.4.0.0</em></p></div></div><div class="top"><p class="src"><a id="v:setNumStripes" class="def">setNumStripes</a> :: <a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a -&gt; <a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a <a href="src/Data.Pool.Internal.html#setNumStripes" class="link">Source</a> <a href="#v:setNumStripes" class="selflink">#</a></p><div class="doc"><p>Set the number of stripes in the pool.</p><p>If set to <code><a href="../base-4.18.1.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> (the default value), the pool will create the amount of
 stripes equal to the number of capabilities. This ensures that threads never
 compete over access to the same stripe and results in a very good performance
 in a multi-threaded environment.</p><p><em>Since: 0.4.0.0</em></p></div></div><div class="top"><p class="src"><a id="v:newPool" class="def">newPool</a> :: <a href="Data-Pool-Internal.html#t:PoolConfig" title="Data.Pool.Internal">PoolConfig</a> a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool-Internal.html#t:Pool" title="Data.Pool.Internal">Pool</a> a) <a href="src/Data.Pool.Internal.html#newPool" class="link">Source</a> <a href="#v:newPool" class="selflink">#</a></p><div class="doc"><p>Create a new striped resource pool.</p><p><em>Note:</em> although the runtime system will destroy all idle resources when the
 pool is garbage collected, it's recommended to manually call
 <code><a href="Data-Pool-Internal.html#v:destroyAllResources" title="Data.Pool.Internal">destroyAllResources</a></code> when you're done with the pool so that the resources
 are freed up as soon as possible.</p></div></div><div class="top"><p class="src"><a id="v:destroyResource" class="def">destroyResource</a> :: <a href="Data-Pool-Internal.html#t:Pool" title="Data.Pool.Internal">Pool</a> a -&gt; <a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a -&gt; a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.Internal.html#destroyResource" class="link">Source</a> <a href="#v:destroyResource" class="selflink">#</a></p><div class="doc"><p>Destroy a resource.</p><p>Note that this will ignore any exceptions in the destroy function.</p></div></div><div class="top"><p class="src"><a id="v:putResource" class="def">putResource</a> :: <a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a -&gt; a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.Internal.html#putResource" class="link">Source</a> <a href="#v:putResource" class="selflink">#</a></p><div class="doc"><p>Return a resource to the given <code><a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:destroyAllResources" class="def">destroyAllResources</a> :: <a href="Data-Pool-Internal.html#t:Pool" title="Data.Pool.Internal">Pool</a> a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.Internal.html#destroyAllResources" class="link">Source</a> <a href="#v:destroyAllResources" class="selflink">#</a></p><div class="doc"><p>Destroy all resources in all stripes in the pool.</p><p>Note that this will ignore any exceptions in the destroy function.</p><p>This function is useful when you detect that all resources in the pool are
 broken. For example after a database has been restarted all connections
 opened before the restart will be broken. In that case it's better to close
 those connections so that <code>takeResource</code> won't take a broken connection from
 the pool but will open a new connection instead.</p><p>Another use-case for this function is that when you know you are done with
 the pool you can destroy all idle resources immediately instead of waiting on
 the garbage collector to destroy them, thus freeing up those resources
 sooner.</p></div></div><div class="top"><p class="src"><a id="v:getLocalPool" class="def">getLocalPool</a> :: <a href="../primitive-0.8.0.0/Data-Primitive-SmallArray.html#t:SmallArray" title="Data.Primitive.SmallArray">SmallArray</a> (<a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool-Internal.html#t:LocalPool" title="Data.Pool.Internal">LocalPool</a> a) <a href="src/Data.Pool.Internal.html#getLocalPool" class="link">Source</a> <a href="#v:getLocalPool" class="selflink">#</a></p><div class="doc"><p>Get a local pool.</p></div></div><div class="top"><p class="src"><a id="v:waitForResource" class="def">waitForResource</a> :: <a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a) -&gt; <a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a) <a href="src/Data.Pool.Internal.html#waitForResource" class="link">Source</a> <a href="#v:waitForResource" class="selflink">#</a></p><div class="doc"><p>Wait for the resource to be put into a given <code><a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:restoreSize" class="def">restoreSize</a> :: <a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.Internal.html#restoreSize" class="link">Source</a> <a href="#v:restoreSize" class="selflink">#</a></p><div class="doc"><p>If an exception is received while a resource is being created, restore the
 original size of the stripe.</p></div></div><div class="top"><p class="src"><a id="v:cleanStripe" class="def">cleanStripe</a> :: (<a href="Data-Pool-Internal.html#t:Entry" title="Data.Pool.Internal">Entry</a> a -&gt; <a href="../base-4.18.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; (a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/Control-Concurrent-MVar.html#t:MVar" title="Control.Concurrent.MVar">MVar</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.Internal.html#cleanStripe" class="link">Source</a> <a href="#v:cleanStripe" class="selflink">#</a></p><div class="doc"><p>Free resource entries in the stripes that fulfil a given condition.</p></div></div><div class="top"><p class="src"><a id="v:signal" class="def">signal</a> :: <a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a -&gt; <a href="../base-4.18.1.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> a -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool-Internal.html#t:Stripe" title="Data.Pool.Internal">Stripe</a> a) <a href="src/Data.Pool.Internal.html#signal" class="link">Source</a> <a href="#v:signal" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:reverseQueue" class="def">reverseQueue</a> :: <a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a -&gt; <a href="Data-Pool-Internal.html#t:Queue" title="Data.Pool.Internal">Queue</a> a <a href="src/Data.Pool.Internal.html#reverseQueue" class="link">Source</a> <a href="#v:reverseQueue" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.1</p></div></body></html>