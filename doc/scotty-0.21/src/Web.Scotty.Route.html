<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts, FlexibleInstances,
             OverloadedStrings, RankNTypes, ScopedTypeVariables #-}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Web.Scotty.Route</span><span>
</span><span id="line-4"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#get"><span class="hs-identifier">get</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#post"><span class="hs-identifier">post</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#put"><span class="hs-identifier">put</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#delete"><span class="hs-identifier">delete</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#patch"><span class="hs-identifier">patch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#options"><span class="hs-identifier">options</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#addroute"><span class="hs-identifier">addroute</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#matchAny"><span class="hs-identifier">matchAny</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#notFound"><span class="hs-identifier">notFound</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>      </span><span class="annot"><a href="Web.Scotty.Route.html#capture"><span class="hs-identifier">capture</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#regex"><span class="hs-identifier">regex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#function"><span class="hs-identifier">function</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Route.html#literal"><span class="hs-identifier">literal</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(***)</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newTVarIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadUnliftIO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MS</span></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Request</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Text.Regex</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Regex</span></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Web.Scotty.Action.html"><span class="hs-identifier">Web.Scotty.Action</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Web.Scotty.Internal.Types.html"><span class="hs-identifier">Web.Scotty.Internal.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier">RoutePattern</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RouteOptions"><span class="hs-identifier">RouteOptions</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionEnv"><span class="hs-identifier">ActionEnv</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier">ActionT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyState"><span class="hs-identifier">ScottyState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier">ScottyT</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ErrorHandler"><span class="hs-identifier">ErrorHandler</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#Middleware"><span class="hs-identifier">Middleware</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#BodyInfo"><span class="hs-identifier">BodyInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#handler"><span class="hs-identifier">handler</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#addRoute"><span class="hs-identifier">addRoute</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#defaultScottyResponse"><span class="hs-identifier">defaultScottyResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Web.Scotty.Util.html"><span class="hs-identifier">Web.Scotty.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeUtf8Lenient</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Web.Scotty.Body.html"><span class="hs-identifier">Web.Scotty.Body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Web.Scotty.Body.html#cloneBodyInfo"><span class="hs-identifier">cloneBodyInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Body.html#getBodyAction"><span class="hs-identifier">getBodyAction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Body.html#getBodyChunkAction"><span class="hs-identifier">getBodyChunkAction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Web.Scotty.Body.html#getFormParamsAndFilesAction"><span class="hs-identifier">getFormParamsAndFilesAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">{- $setup
&gt;&gt;&gt; :{
import Control.Monad.IO.Class (MonadIO(..))
import qualified Network.HTTP.Client as H
import qualified Network.HTTP.Types as H
import qualified Network.Wai as W (httpVersion)
import qualified Data.ByteString.Lazy.Char8 as LBS (unpack)
import qualified Data.Text as T (pack)
import Control.Concurrent (ThreadId, forkIO, killThread)
import Control.Exception (bracket)
import qualified Web.Scotty as S (ScottyM, scottyOpts, get, text, regex, pathParam, Options(..), defaultOptions)
-- | GET an HTTP path
curl :: MonadIO m =&gt;
        String -- ^ path
     -&gt; m String -- ^ response body
curl path = liftIO $ do
  req0 &lt;- H.parseRequest path
  let req = req0 { H.method = &quot;GET&quot;}
  mgr &lt;- H.newManager H.defaultManagerSettings
  (LBS.unpack . H.responseBody) &lt;$&gt; H.httpLbs req mgr
-- | Fork a process, run a Scotty server in it and run an action while the server is running. Kills the scotty thread once the inner action is done.
withScotty :: S.ScottyM ()
           -&gt; IO a -- ^ inner action, e.g. 'curl &quot;localhost:3000/&quot;'
           -&gt; IO a
withScotty serv act = bracket (forkIO $ S.scottyOpts (S.defaultOptions{ S.verbose = 0 }) serv) killThread (\_ -&gt; act)
:}
-}</span></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><span class="hs-comment">-- | get = 'addroute' 'GET'</span></span><span>
</span><span id="line-56"></span><span id="local-6989586621679122137"><span class="annot"><a href="Web.Scotty.Route.html#get"><span class="hs-identifier hs-type">get</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122137"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122137"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-type">ScottyT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122137"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-57"></span><span id="get"><span class="annot"><span class="annottext">get :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#get"><span class="hs-identifier hs-var hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#addroute"><span class="hs-identifier hs-var">addroute</span></a></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">GET</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="annot"><span class="hs-comment">-- | post = 'addroute' 'POST'</span></span><span>
</span><span id="line-60"></span><span id="local-6989586621679122283"><span class="annot"><a href="Web.Scotty.Route.html#post"><span class="hs-identifier hs-type">post</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122283"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122283"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-type">ScottyT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122283"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-61"></span><span id="post"><span class="annot"><span class="annottext">post :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#post"><span class="hs-identifier hs-var hs-var">post</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#addroute"><span class="hs-identifier hs-var">addroute</span></a></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">POST</span></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="annot"><span class="hs-comment">-- | put = 'addroute' 'PUT'</span></span><span>
</span><span id="line-64"></span><span id="local-6989586621679122287"><span class="annot"><a href="Web.Scotty.Route.html#put"><span class="hs-identifier hs-type">put</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122287"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122287"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-type">ScottyT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122287"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-65"></span><span id="put"><span class="annot"><span class="annottext">put :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#put"><span class="hs-identifier hs-var hs-var">put</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#addroute"><span class="hs-identifier hs-var">addroute</span></a></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">PUT</span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><span class="hs-comment">-- | delete = 'addroute' 'DELETE'</span></span><span>
</span><span id="line-68"></span><span id="local-6989586621679122291"><span class="annot"><a href="Web.Scotty.Route.html#delete"><span class="hs-identifier hs-type">delete</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122291"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122291"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-type">ScottyT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122291"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-69"></span><span id="delete"><span class="annot"><span class="annottext">delete :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#delete"><span class="hs-identifier hs-var hs-var">delete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#addroute"><span class="hs-identifier hs-var">addroute</span></a></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">DELETE</span></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><span class="hs-comment">-- | patch = 'addroute' 'PATCH'</span></span><span>
</span><span id="line-72"></span><span id="local-6989586621679122295"><span class="annot"><a href="Web.Scotty.Route.html#patch"><span class="hs-identifier hs-type">patch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122295"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122295"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-type">ScottyT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122295"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-73"></span><span id="patch"><span class="annot"><span class="annottext">patch :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#patch"><span class="hs-identifier hs-var hs-var">patch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#addroute"><span class="hs-identifier hs-var">addroute</span></a></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">PATCH</span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><span class="hs-comment">-- | options = 'addroute' 'OPTIONS'</span></span><span>
</span><span id="line-76"></span><span id="local-6989586621679122299"><span class="annot"><a href="Web.Scotty.Route.html#options"><span class="hs-identifier hs-type">options</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122299"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122299"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-type">ScottyT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122299"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-77"></span><span id="options"><span class="annot"><span class="annottext">options :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#options"><span class="hs-identifier hs-var hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#addroute"><span class="hs-identifier hs-var">addroute</span></a></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><span class="hs-identifier hs-var">OPTIONS</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="annot"><span class="hs-comment">-- | Add a route that matches regardless of the HTTP verb.</span></span><span>
</span><span id="line-80"></span><span id="local-6989586621679122302"><span class="annot"><a href="Web.Scotty.Route.html#matchAny"><span class="hs-identifier hs-type">matchAny</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122302"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122302"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-type">ScottyT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122302"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-81"></span><span id="matchAny"><span class="annot"><span class="annottext">matchAny :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#matchAny"><span class="hs-identifier hs-var hs-var">matchAny</span></a></span></span><span> </span><span id="local-6989586621679122309"><span class="annot"><span class="annottext">RoutePattern
</span><a href="#local-6989586621679122309"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621679122310"><span class="annot"><span class="annottext">ActionT m ()
</span><a href="#local-6989586621679122310"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (ScottyState m) () -&gt; ScottyT m ()
forall (m :: * -&gt; *) a. State (ScottyState m) a -&gt; ScottyT m a
</span><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-var">ScottyT</span></a></span><span> </span><span class="annot"><span class="annottext">(State (ScottyState m) () -&gt; ScottyT m ())
-&gt; State (ScottyState m) () -&gt; ScottyT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ScottyState m -&gt; ScottyState m) -&gt; State (ScottyState m) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">MS.modify</span></span><span> </span><span class="annot"><span class="annottext">((ScottyState m -&gt; ScottyState m) -&gt; State (ScottyState m) ())
-&gt; (ScottyState m -&gt; ScottyState m) -&gt; State (ScottyState m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679122313"><span class="annot"><span class="annottext">ScottyState m
</span><a href="#local-6989586621679122313"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(BodyInfo -&gt; Middleware m) -&gt; ScottyState m -&gt; ScottyState m
forall (m :: * -&gt; *).
(BodyInfo -&gt; Middleware m) -&gt; ScottyState m -&gt; ScottyState m
</span><a href="Web.Scotty.Internal.Types.html#addRoute"><span class="hs-identifier hs-var">addRoute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RouteOptions
-&gt; Maybe (ErrorHandler m)
-&gt; Maybe StdMethod
-&gt; RoutePattern
-&gt; ActionT m ()
-&gt; BodyInfo
-&gt; Middleware m
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RouteOptions
-&gt; Maybe (ErrorHandler m)
-&gt; Maybe StdMethod
-&gt; RoutePattern
-&gt; ActionT m ()
-&gt; BodyInfo
-&gt; Middleware m
</span><a href="Web.Scotty.Route.html#route"><span class="hs-identifier hs-var">route</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScottyState m -&gt; RouteOptions
forall (m :: * -&gt; *). ScottyState m -&gt; RouteOptions
</span><a href="Web.Scotty.Internal.Types.html#routeOptions"><span class="hs-identifier hs-var">routeOptions</span></a></span><span> </span><span class="annot"><span class="annottext">ScottyState m
</span><a href="#local-6989586621679122313"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScottyState m -&gt; Maybe (ErrorHandler m)
forall (m :: * -&gt; *). ScottyState m -&gt; Maybe (ErrorHandler m)
</span><a href="Web.Scotty.Internal.Types.html#handler"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">ScottyState m
</span><a href="#local-6989586621679122313"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe StdMethod
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">RoutePattern
</span><a href="#local-6989586621679122309"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">ActionT m ()
</span><a href="#local-6989586621679122310"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScottyState m
</span><a href="#local-6989586621679122313"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Specify an action to take if nothing else is found. Note: this _always_ matches,</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- so should generally be the last route specified.</span><span>
</span><span id="line-85"></span><span id="local-6989586621679122173"><span class="annot"><a href="Web.Scotty.Route.html#notFound"><span class="hs-identifier hs-type">notFound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122173"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122173"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-type">ScottyT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122173"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-86"></span><span id="notFound"><span class="annot"><span class="annottext">notFound :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#notFound"><span class="hs-identifier hs-var hs-var">notFound</span></a></span></span><span> </span><span id="local-6989586621679122326"><span class="annot"><span class="annottext">ActionT m ()
</span><a href="#local-6989586621679122326"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#matchAny"><span class="hs-identifier hs-var">matchAny</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Request -&gt; Maybe [Param]) -&gt; RoutePattern
</span><a href="Web.Scotty.Internal.Types.html#Function"><span class="hs-identifier hs-var">Function</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679122328"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122328"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Param] -&gt; Maybe [Param]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;path&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Text
</span><a href="Web.Scotty.Route.html#path"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122328"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status -&gt; ActionT m ()
forall (m :: * -&gt; *). MonadIO m =&gt; Status -&gt; ActionT m ()
</span><a href="Web.Scotty.Action.html#status"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">status404</span></span><span> </span><span class="annot"><span class="annottext">ActionT m () -&gt; ActionT m () -&gt; ActionT m ()
forall a b. ActionT m a -&gt; ActionT m b -&gt; ActionT m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ActionT m ()
</span><a href="#local-6989586621679122326"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">{- | Define a route with a 'StdMethod', a route pattern representing the path spec,
and an 'Action' which may modify the response.

&gt; get &quot;/&quot; $ text &quot;beam me up!&quot;

The path spec can include values starting with a colon, which are interpreted
as /captures/. These are parameters that can be looked up with 'pathParam'.

&gt;&gt;&gt; :{
let server = S.get &quot;/foo/:bar&quot; (S.pathParam &quot;bar&quot; &gt;&gt;= S.text)
 in do
      withScotty server $ curl &quot;http://localhost:3000/foo/something&quot;
:}
&quot;something&quot;
-}</span></span><span>
</span><span id="line-103"></span><span id="local-6989586621679122143"><span class="annot"><a href="Web.Scotty.Route.html#addroute"><span class="hs-identifier hs-type">addroute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122143"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdMethod</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122143"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-type">ScottyT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122143"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-104"></span><span id="addroute"><span class="annot"><span class="annottext">addroute :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
StdMethod -&gt; RoutePattern -&gt; ActionT m () -&gt; ScottyT m ()
</span><a href="Web.Scotty.Route.html#addroute"><span class="hs-identifier hs-var hs-var">addroute</span></a></span></span><span> </span><span id="local-6989586621679122337"><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621679122337"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621679122338"><span class="annot"><span class="annottext">RoutePattern
</span><a href="#local-6989586621679122338"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621679122339"><span class="annot"><span class="annottext">ActionT m ()
</span><a href="#local-6989586621679122339"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (ScottyState m) () -&gt; ScottyT m ()
forall (m :: * -&gt; *) a. State (ScottyState m) a -&gt; ScottyT m a
</span><a href="Web.Scotty.Internal.Types.html#ScottyT"><span class="hs-identifier hs-var">ScottyT</span></a></span><span> </span><span class="annot"><span class="annottext">(State (ScottyState m) () -&gt; ScottyT m ())
-&gt; State (ScottyState m) () -&gt; ScottyT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ScottyState m -&gt; ScottyState m) -&gt; State (ScottyState m) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">MS.modify</span></span><span> </span><span class="annot"><span class="annottext">((ScottyState m -&gt; ScottyState m) -&gt; State (ScottyState m) ())
-&gt; (ScottyState m -&gt; ScottyState m) -&gt; State (ScottyState m) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679122340"><span class="annot"><span class="annottext">ScottyState m
</span><a href="#local-6989586621679122340"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(BodyInfo -&gt; Middleware m) -&gt; ScottyState m -&gt; ScottyState m
forall (m :: * -&gt; *).
(BodyInfo -&gt; Middleware m) -&gt; ScottyState m -&gt; ScottyState m
</span><a href="Web.Scotty.Internal.Types.html#addRoute"><span class="hs-identifier hs-var">addRoute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RouteOptions
-&gt; Maybe (ErrorHandler m)
-&gt; Maybe StdMethod
-&gt; RoutePattern
-&gt; ActionT m ()
-&gt; BodyInfo
-&gt; Middleware m
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RouteOptions
-&gt; Maybe (ErrorHandler m)
-&gt; Maybe StdMethod
-&gt; RoutePattern
-&gt; ActionT m ()
-&gt; BodyInfo
-&gt; Middleware m
</span><a href="Web.Scotty.Route.html#route"><span class="hs-identifier hs-var">route</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScottyState m -&gt; RouteOptions
forall (m :: * -&gt; *). ScottyState m -&gt; RouteOptions
</span><a href="Web.Scotty.Internal.Types.html#routeOptions"><span class="hs-identifier hs-var">routeOptions</span></a></span><span> </span><span class="annot"><span class="annottext">ScottyState m
</span><a href="#local-6989586621679122340"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScottyState m -&gt; Maybe (ErrorHandler m)
forall (m :: * -&gt; *). ScottyState m -&gt; Maybe (ErrorHandler m)
</span><a href="Web.Scotty.Internal.Types.html#handler"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">ScottyState m
</span><a href="#local-6989586621679122340"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StdMethod -&gt; Maybe StdMethod
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621679122337"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RoutePattern
</span><a href="#local-6989586621679122338"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">ActionT m ()
</span><a href="#local-6989586621679122339"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScottyState m
</span><a href="#local-6989586621679122340"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span id="local-6989586621679122169"><span class="annot"><a href="Web.Scotty.Route.html#route"><span class="hs-identifier hs-type">route</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122169"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-107"></span><span>         </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RouteOptions"><span class="hs-identifier hs-type">RouteOptions</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ErrorHandler"><span class="hs-identifier hs-type">ErrorHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122169"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdMethod</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionT"><span class="hs-identifier hs-type">ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122169"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#BodyInfo"><span class="hs-identifier hs-type">BodyInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#Middleware"><span class="hs-identifier hs-type">Middleware</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122169"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-109"></span><span id="route"><span class="annot"><span class="annottext">route :: forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
RouteOptions
-&gt; Maybe (ErrorHandler m)
-&gt; Maybe StdMethod
-&gt; RoutePattern
-&gt; ActionT m ()
-&gt; BodyInfo
-&gt; Middleware m
</span><a href="Web.Scotty.Route.html#route"><span class="hs-identifier hs-var hs-var">route</span></a></span></span><span> </span><span id="local-6989586621679122357"><span class="annot"><span class="annottext">RouteOptions
</span><a href="#local-6989586621679122357"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679122358"><span class="annot"><span class="annottext">Maybe (ErrorHandler m)
</span><a href="#local-6989586621679122358"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679122359"><span class="annot"><span class="annottext">Maybe StdMethod
</span><a href="#local-6989586621679122359"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621679122360"><span class="annot"><span class="annottext">RoutePattern
</span><a href="#local-6989586621679122360"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621679122361"><span class="annot"><span class="annottext">ActionT m ()
</span><a href="#local-6989586621679122361"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621679122362"><span class="annot"><span class="annottext">BodyInfo
</span><a href="#local-6989586621679122362"><span class="hs-identifier hs-var">bodyInfo</span></a></span></span><span> </span><span id="local-6989586621679122363"><span class="annot"><span class="annottext">Application m
</span><a href="#local-6989586621679122363"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span id="local-6989586621679122364"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122364"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679122365"><span class="annot"><span class="annottext">tryNext :: m Response
</span><a href="#local-6989586621679122365"><span class="hs-identifier hs-var hs-var">tryNext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Application m
</span><a href="#local-6989586621679122363"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122364"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-comment">-- We match all methods in the case where 'method' is 'Nothing'.</span><span>
</span><span id="line-112"></span><span>      </span><span class="hs-comment">-- See https://github.com/scotty-web/scotty/issues/196 and 'matchAny'</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><a href="#local-6989586621679122366"><span class="hs-identifier hs-type">methodMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-114"></span><span>      </span><span id="local-6989586621679122366"><span class="annot"><span class="annottext">methodMatches :: Bool
</span><a href="#local-6989586621679122366"><span class="hs-identifier hs-var hs-var">methodMatches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (StdMethod -&gt; Bool) -&gt; Maybe StdMethod -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679122368"><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621679122368"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StdMethod -&gt; Either ByteString StdMethod
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621679122368"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Either ByteString StdMethod -&gt; Either ByteString StdMethod -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either ByteString StdMethod
</span><span class="hs-identifier hs-var">parseMethod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><span class="hs-identifier hs-var">requestMethod</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122364"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe StdMethod
</span><a href="#local-6989586621679122359"><span class="hs-identifier hs-var">method</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679122366"><span class="hs-identifier hs-var">methodMatches</span></a></span><span>
</span><span id="line-117"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RoutePattern -&gt; Request -&gt; Maybe [Param]
</span><a href="Web.Scotty.Route.html#matchRoute"><span class="hs-identifier hs-var">matchRoute</span></a></span><span> </span><span class="annot"><span class="annottext">RoutePattern
</span><a href="#local-6989586621679122360"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122364"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-118"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679122372"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122372"><span class="hs-identifier hs-var">captures</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>              </span><span class="hs-comment">-- The user-facing API for &quot;body&quot; and &quot;bodyReader&quot; involve an IO action that</span><span>
</span><span id="line-120"></span><span>              </span><span class="hs-comment">-- reads the body/chunks thereof only once, so we shouldn't pass in our BodyInfo</span><span>
</span><span id="line-121"></span><span>              </span><span class="hs-comment">-- directly; otherwise, the body might get consumed and then it would be unavailable</span><span>
</span><span id="line-122"></span><span>              </span><span class="hs-comment">-- if `next` is called and we try to match further routes.</span><span>
</span><span id="line-123"></span><span>              </span><span class="hs-comment">-- Instead, make a &quot;cloned&quot; copy of the BodyInfo that allows the IO actions to be called</span><span>
</span><span id="line-124"></span><span>              </span><span class="hs-comment">-- without messing up the state of the original BodyInfo.</span><span>
</span><span id="line-125"></span><span>              </span><span id="local-6989586621679122373"><span class="annot"><span class="annottext">BodyInfo
</span><a href="#local-6989586621679122373"><span class="hs-identifier hs-var">clonedBodyInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BodyInfo -&gt; m BodyInfo
forall (m :: * -&gt; *). MonadIO m =&gt; BodyInfo -&gt; m BodyInfo
</span><a href="Web.Scotty.Body.html#cloneBodyInfo"><span class="hs-identifier hs-var">cloneBodyInfo</span></a></span><span> </span><span class="annot"><span class="annottext">BodyInfo
</span><a href="#local-6989586621679122362"><span class="hs-identifier hs-var">bodyInfo</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>              </span><span id="local-6989586621679122374"><span class="annot"><span class="annottext">ActionEnv
</span><a href="#local-6989586621679122374"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BodyInfo -&gt; Request -&gt; [Param] -&gt; RouteOptions -&gt; m ActionEnv
forall (m :: * -&gt; *).
MonadIO m =&gt;
BodyInfo -&gt; Request -&gt; [Param] -&gt; RouteOptions -&gt; m ActionEnv
</span><a href="Web.Scotty.Route.html#mkEnv"><span class="hs-identifier hs-var">mkEnv</span></a></span><span> </span><span class="annot"><span class="annottext">BodyInfo
</span><a href="#local-6989586621679122373"><span class="hs-identifier hs-var">clonedBodyInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122364"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122372"><span class="hs-identifier hs-var">captures</span></a></span><span> </span><span class="annot"><span class="annottext">RouteOptions
</span><a href="#local-6989586621679122357"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-128"></span><span>              </span><span id="local-6989586621679122376"><span class="annot"><span class="annottext">Maybe Response
</span><a href="#local-6989586621679122376"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (ErrorHandler m)
-&gt; ActionEnv -&gt; ActionT m () -&gt; m (Maybe Response)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Maybe (ErrorHandler m)
-&gt; ActionEnv -&gt; ActionT m () -&gt; m (Maybe Response)
</span><a href="Web.Scotty.Action.html#runAction"><span class="hs-identifier hs-var">runAction</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ErrorHandler m)
</span><a href="#local-6989586621679122358"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ActionEnv
</span><a href="#local-6989586621679122374"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ActionT m ()
</span><a href="#local-6989586621679122361"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-129"></span><span>              </span><span class="annot"><span class="annottext">m Response
-&gt; (Response -&gt; m Response) -&gt; Maybe Response -&gt; m Response
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">m Response
</span><a href="#local-6989586621679122365"><span class="hs-identifier hs-var">tryNext</span></a></span><span> </span><span class="annot"><span class="annottext">Response -&gt; m Response
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Response
</span><a href="#local-6989586621679122376"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-130"></span><span>            </span><span class="annot"><span class="annottext">Maybe [Param]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Response
</span><a href="#local-6989586621679122365"><span class="hs-identifier hs-var">tryNext</span></a></span><span>
</span><span id="line-131"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">m Response
</span><a href="#local-6989586621679122365"><span class="hs-identifier hs-var">tryNext</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="annot"><a href="Web.Scotty.Route.html#matchRoute"><span class="hs-identifier hs-type">matchRoute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Web.Scotty.Internal.Types.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-134"></span><span id="matchRoute"><span class="annot"><span class="annottext">matchRoute :: RoutePattern -&gt; Request -&gt; Maybe [Param]
</span><a href="Web.Scotty.Route.html#matchRoute"><span class="hs-identifier hs-var hs-var">matchRoute</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Web.Scotty.Internal.Types.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span id="local-6989586621679122379"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122379"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span>  </span><span id="local-6989586621679122380"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122380"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122379"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Text
</span><a href="Web.Scotty.Route.html#path"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122380"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Param] -&gt; Maybe [Param]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-135"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Param]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Web.Scotty.Route.html#matchRoute"><span class="hs-identifier hs-var">matchRoute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Web.Scotty.Internal.Types.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span> </span><span id="local-6989586621679122381"><span class="annot"><span class="annottext">Request -&gt; Maybe [Param]
</span><a href="#local-6989586621679122381"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679122382"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122382"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; Maybe [Param]
</span><a href="#local-6989586621679122381"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122382"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Web.Scotty.Route.html#matchRoute"><span class="hs-identifier hs-var">matchRoute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Web.Scotty.Internal.Types.html#Capture"><span class="hs-identifier hs-type">Capture</span></a></span><span> </span><span id="local-6989586621679122384"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122384"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span>  </span><span id="local-6989586621679122385"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122385"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Param] -&gt; Maybe [Param]
</span><a href="#local-6989586621679122386"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.split</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122384"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall {a}. (Eq a, IsString a) =&gt; [a] -&gt; [a]
</span><a href="#local-6989586621679122388"><span class="hs-identifier hs-var">compress</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Request -&gt; [Text]
</span><span class="hs-identifier hs-var">pathInfo</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122385"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- add empty segment to simulate being at the root</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679122386"><span class="annot"><span class="annottext">go :: [Text] -&gt; [Text] -&gt; [Param] -&gt; Maybe [Param]
</span><a href="#local-6989586621679122386"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679122399"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122399"><span class="hs-identifier hs-var">prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Param] -&gt; Maybe [Param]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122399"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="hs-comment">-- request string and pattern match!</span><span>
</span><span id="line-139"></span><span>          </span><span class="annot"><a href="#local-6989586621679122386"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679122400"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122400"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span id="local-6989586621679122401"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122401"><span class="hs-identifier hs-var">prs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122400"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Param] -&gt; Maybe [Param]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122401"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="hs-comment">-- in case request has trailing slashes</span><span>
</span><span id="line-140"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Param]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-comment">-- request string is longer than pattern</span><span>
</span><span id="line-141"></span><span>          </span><span class="annot"><a href="#local-6989586621679122386"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679122403"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122403"><span class="hs-identifier hs-var">p</span></a></span></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679122404"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122404"><span class="hs-identifier hs-var">prs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122403"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Param] -&gt; Maybe [Param]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122404"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="hs-comment">-- in case pattern has trailing slashes</span><span>
</span><span id="line-142"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Param]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-comment">-- request string is not long enough</span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><a href="#local-6989586621679122386"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679122405"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122405"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679122406"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122406"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679122407"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122407"><span class="hs-identifier hs-var">r</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679122408"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122408"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679122409"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122409"><span class="hs-identifier hs-var">prs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122405"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122407"><span class="hs-identifier hs-var">r</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Param] -&gt; Maybe [Param]
</span><a href="#local-6989586621679122386"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122406"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122408"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122409"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="hs-comment">-- equal literals, keeping checking</span><span>
</span><span id="line-144"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122405"><span class="hs-identifier hs-var">p</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Param]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-comment">-- p is null, but r is not, fail</span><span>
</span><span id="line-145"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Char
Text -&gt; Char
</span><span class="hs-identifier hs-var">T.head</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122405"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">':'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Param] -&gt; Maybe [Param]
</span><a href="#local-6989586621679122386"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122406"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679122408"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">([Param] -&gt; Maybe [Param]) -&gt; [Param] -&gt; Maybe [Param]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text
Text -&gt; Text
</span><span class="hs-identifier hs-var">T.tail</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122405"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679122407"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Param -&gt; [Param] -&gt; [Param]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122409"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="hs-comment">-- p is a capture, add to params</span><span>
</span><span id="line-146"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Param]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-comment">-- both literals, but unequal, fail</span><span>
</span><span id="line-147"></span><span>          </span><span id="local-6989586621679122388"><span class="annot"><span class="annottext">compress :: [a] -&gt; [a]
</span><a href="#local-6989586621679122388"><span class="hs-identifier hs-var hs-var">compress</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;&quot;</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679122418"><span class="annot"><span class="annottext">rest :: [a]
</span><a href="#local-6989586621679122418"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;&quot;</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
</span><a href="#local-6989586621679122388"><span class="hs-identifier hs-var">compress</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679122418"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-148"></span><span>          </span><span class="annot"><a href="#local-6989586621679122388"><span class="hs-identifier hs-var">compress</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679122419"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679122419"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679122420"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679122420"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679122419"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
</span><a href="#local-6989586621679122388"><span class="hs-identifier hs-var">compress</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679122420"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-149"></span><span>          </span><span class="annot"><a href="#local-6989586621679122388"><span class="hs-identifier hs-var">compress</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">-- Pretend we are at the top level.</span><span>
</span><span id="line-152"></span><span class="annot"><a href="Web.Scotty.Route.html#path"><span class="hs-identifier hs-type">path</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-153"></span><span id="path"><span class="annot"><span class="annottext">path :: Request -&gt; Text
</span><a href="Web.Scotty.Route.html#path"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.cons</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Request -&gt; Text) -&gt; Request -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; (Request -&gt; [Text]) -&gt; Request -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Text]
</span><span class="hs-identifier hs-var">pathInfo</span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><span class="hs-comment">-- | Parse the request and construct the initial 'ActionEnv' with a default 200 OK response</span></span><span>
</span><span id="line-156"></span><span id="local-6989586621679122200"><span class="annot"><a href="Web.Scotty.Route.html#mkEnv"><span class="hs-identifier hs-type">mkEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679122200"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#BodyInfo"><span class="hs-identifier hs-type">BodyInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Web.Scotty.Internal.Types.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RouteOptions"><span class="hs-identifier hs-type">RouteOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679122200"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#ActionEnv"><span class="hs-identifier hs-type">ActionEnv</span></a></span></span><span>
</span><span id="line-157"></span><span id="mkEnv"><span class="annot"><span class="annottext">mkEnv :: forall (m :: * -&gt; *).
MonadIO m =&gt;
BodyInfo -&gt; Request -&gt; [Param] -&gt; RouteOptions -&gt; m ActionEnv
</span><a href="Web.Scotty.Route.html#mkEnv"><span class="hs-identifier hs-var hs-var">mkEnv</span></a></span></span><span> </span><span id="local-6989586621679122431"><span class="annot"><span class="annottext">BodyInfo
</span><a href="#local-6989586621679122431"><span class="hs-identifier hs-var">bodyInfo</span></a></span></span><span> </span><span id="local-6989586621679122432"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122432"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621679122433"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122433"><span class="hs-identifier hs-var">captureps</span></a></span></span><span> </span><span id="local-6989586621679122434"><span class="annot"><span class="annottext">RouteOptions
</span><a href="#local-6989586621679122434"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679122435"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122435"><span class="hs-identifier hs-var">formps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679122436"><span class="annot"><span class="annottext">[File ByteString]
</span><a href="#local-6989586621679122436"><span class="hs-identifier hs-var">bodyFiles</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ([Param], [File ByteString]) -&gt; m ([Param], [File ByteString])
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ([Param], [File ByteString]) -&gt; m ([Param], [File ByteString]))
-&gt; IO ([Param], [File ByteString])
-&gt; m ([Param], [File ByteString])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request
-&gt; BodyInfo -&gt; RouteOptions -&gt; IO ([Param], [File ByteString])
</span><a href="Web.Scotty.Body.html#getFormParamsAndFilesAction"><span class="hs-identifier hs-var">getFormParamsAndFilesAction</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122432"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">BodyInfo
</span><a href="#local-6989586621679122431"><span class="hs-identifier hs-var">bodyInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RouteOptions
</span><a href="#local-6989586621679122434"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679122438"><span class="annot"><span class="annottext">queryps :: [Param]
</span><a href="#local-6989586621679122438"><span class="hs-identifier hs-var hs-var">queryps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query -&gt; [Param]
</span><a href="Web.Scotty.Route.html#parseEncodedParams"><span class="hs-identifier hs-var">parseEncodedParams</span></a></span><span> </span><span class="annot"><span class="annottext">(Query -&gt; [Param]) -&gt; Query -&gt; [Param]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Query
</span><span class="hs-identifier hs-var">queryString</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122432"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679122441"><span class="annot"><span class="annottext">bodyFiles' :: [(Text, FileInfo ByteString)]
</span><a href="#local-6989586621679122441"><span class="hs-identifier hs-var hs-var">bodyFiles'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">decodeUtf8Lenient</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679122442"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FileInfo ByteString
</span><a href="#local-6989586621679122443"><span class="hs-identifier hs-var">fi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679122442"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679122442"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679122443"><span class="annot"><span class="annottext">FileInfo ByteString
</span><a href="#local-6989586621679122443"><span class="hs-identifier hs-var">fi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[File ByteString]
</span><a href="#local-6989586621679122436"><span class="hs-identifier hs-var">bodyFiles</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-162"></span><span>  </span><span id="local-6989586621679122444"><span class="annot"><span class="annottext">TVar ScottyResponse
</span><a href="#local-6989586621679122444"><span class="hs-identifier hs-var">responseInit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TVar ScottyResponse) -&gt; m (TVar ScottyResponse)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (TVar ScottyResponse) -&gt; m (TVar ScottyResponse))
-&gt; IO (TVar ScottyResponse) -&gt; m (TVar ScottyResponse)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScottyResponse -&gt; IO (TVar ScottyResponse)
forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">ScottyResponse
</span><a href="Web.Scotty.Internal.Types.html#defaultScottyResponse"><span class="hs-identifier hs-var">defaultScottyResponse</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">ActionEnv -&gt; m ActionEnv
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ActionEnv -&gt; m ActionEnv) -&gt; ActionEnv -&gt; m ActionEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request
-&gt; [Param]
-&gt; [Param]
-&gt; [Param]
-&gt; IO ByteString
-&gt; IO ByteString
-&gt; [(Text, FileInfo ByteString)]
-&gt; TVar ScottyResponse
-&gt; ActionEnv
</span><a href="Web.Scotty.Internal.Types.html#Env"><span class="hs-identifier hs-var">Env</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122432"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122433"><span class="hs-identifier hs-var">captureps</span></a></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122435"><span class="hs-identifier hs-var">formps</span></a></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621679122438"><span class="hs-identifier hs-var">queryps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BodyInfo -&gt; RouteOptions -&gt; IO ByteString
</span><a href="Web.Scotty.Body.html#getBodyAction"><span class="hs-identifier hs-var">getBodyAction</span></a></span><span> </span><span class="annot"><span class="annottext">BodyInfo
</span><a href="#local-6989586621679122431"><span class="hs-identifier hs-var">bodyInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RouteOptions
</span><a href="#local-6989586621679122434"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BodyInfo -&gt; IO ByteString
</span><a href="Web.Scotty.Body.html#getBodyChunkAction"><span class="hs-identifier hs-var">getBodyChunkAction</span></a></span><span> </span><span class="annot"><span class="annottext">BodyInfo
</span><a href="#local-6989586621679122431"><span class="hs-identifier hs-var">bodyInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, FileInfo ByteString)]
</span><a href="#local-6989586621679122441"><span class="hs-identifier hs-var">bodyFiles'</span></a></span><span> </span><span class="annot"><span class="annottext">TVar ScottyResponse
</span><a href="#local-6989586621679122444"><span class="hs-identifier hs-var">responseInit</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><a href="Web.Scotty.Route.html#parseEncodedParams"><span class="hs-identifier hs-type">parseEncodedParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Query</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Web.Scotty.Internal.Types.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span id="parseEncodedParams"><span class="annot"><span class="annottext">parseEncodedParams :: Query -&gt; [Param]
</span><a href="Web.Scotty.Route.html#parseEncodedParams"><span class="hs-identifier hs-var hs-var">parseEncodedParams</span></a></span></span><span> </span><span id="local-6989586621679122446"><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679122446"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">decodeUtf8Lenient</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679122447"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (ByteString -&gt; Text) -&gt; Maybe ByteString -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">decodeUtf8Lenient</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679122448"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679122447"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679122447"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679122448"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679122448"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679122446"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="annot"><span class="hs-comment">{- | Match requests using a regular expression.
Named captures are not yet supported.

&gt;&gt;&gt; :{
let server = S.get (S.regex &quot;^/f(.*)r$&quot;) $ do
                cap &lt;- S.pathParam &quot;1&quot;
                S.text cap
 in do
      withScotty server $ curl &quot;http://localhost:3000/foo/bar&quot;
:}
&quot;oo/ba&quot;
-}</span></span><span>
</span><span id="line-181"></span><span class="annot"><a href="Web.Scotty.Route.html#regex"><span class="hs-identifier hs-type">regex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span>
</span><span id="line-182"></span><span id="regex"><span class="annot"><span class="annottext">regex :: String -&gt; RoutePattern
</span><a href="Web.Scotty.Route.html#regex"><span class="hs-identifier hs-var hs-var">regex</span></a></span></span><span> </span><span id="local-6989586621679122449"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679122449"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Request -&gt; Maybe [Param]) -&gt; RoutePattern
</span><a href="Web.Scotty.Internal.Types.html#Function"><span class="hs-identifier hs-var">Function</span></a></span><span> </span><span class="annot"><span class="annottext">((Request -&gt; Maybe [Param]) -&gt; RoutePattern)
-&gt; (Request -&gt; Maybe [Param]) -&gt; RoutePattern
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679122450"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122450"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((String, String, String, [String]) -&gt; [Param])
-&gt; Maybe (String, String, String, [String]) -&gt; Maybe [Param]
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, String) -&gt; Param) -&gt; [(Int, String)] -&gt; [Param]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (Int -&gt; String) -&gt; Int -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Text) -&gt; (String -&gt; Text) -&gt; (Int, String) -&gt; Param
forall b c b' c'. (b -&gt; c) -&gt; (b' -&gt; c') -&gt; (b, b') -&gt; (c, c')
forall (a :: * -&gt; * -&gt; *) b c b' c'.
Arrow a =&gt;
a b c -&gt; a b' c' -&gt; a (b, b') (c, c')
</span><span class="hs-operator hs-var">***</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, String)] -&gt; [Param])
-&gt; ((String, String, String, [String]) -&gt; [(Int, String)])
-&gt; (String, String, String, [String])
-&gt; [Param]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [String] -&gt; [(Int, String)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [(Int, String)])
-&gt; ((String, String, String, [String]) -&gt; [String])
-&gt; (String, String, String, [String])
-&gt; [(Int, String)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, String, String, [String]) -&gt; [String]
forall {a} {a} {c}. (a, a, c, [a]) -&gt; [a]
</span><a href="#local-6989586621679122453"><span class="hs-identifier hs-var">strip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>                                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Maybe (String, String, String, [String])
</span><span class="hs-identifier hs-var">Regex.matchRegexAll</span></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679122455"><span class="hs-identifier hs-var">rgx</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe (String, String, String, [String]))
-&gt; String -&gt; Maybe (String, String, String, [String])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Text -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Text
</span><a href="Web.Scotty.Route.html#path"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679122450"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679122455"><span class="annot"><span class="annottext">rgx :: Regex
</span><a href="#local-6989586621679122455"><span class="hs-identifier hs-var hs-var">rgx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
</span><span class="hs-identifier hs-var">Regex.mkRegex</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679122449"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-185"></span><span>          </span><span id="local-6989586621679122453"><span class="annot"><span class="annottext">strip :: (a, a, c, [a]) -&gt; [a]
</span><a href="#local-6989586621679122453"><span class="hs-identifier hs-var hs-var">strip</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679122458"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679122458"><span class="hs-identifier hs-var">match</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679122459"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679122459"><span class="hs-identifier hs-var">subs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679122458"><span class="hs-identifier hs-var">match</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679122459"><span class="hs-identifier hs-var">subs</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">-- | Standard Sinatra-style route. Named captures are prepended with colons.</span><span>
</span><span id="line-188"></span><span class="hs-comment">--   This is the default route type generated by OverloadedString routes. i.e.</span><span>
</span><span id="line-189"></span><span class="hs-comment">--</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- &gt; get (capture &quot;/foo/:bar&quot;) $ ...</span><span>
</span><span id="line-191"></span><span class="hs-comment">--</span><span>
</span><span id="line-192"></span><span class="hs-comment">--   and</span><span>
</span><span id="line-193"></span><span class="hs-comment">--</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- &gt; {-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- &gt; ...</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- &gt; get &quot;/foo/:bar&quot; $ ...</span><span>
</span><span id="line-197"></span><span class="hs-comment">--</span><span>
</span><span id="line-198"></span><span class="hs-comment">--   are equivalent.</span><span>
</span><span id="line-199"></span><span class="annot"><a href="Web.Scotty.Route.html#capture"><span class="hs-identifier hs-type">capture</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span>
</span><span id="line-200"></span><span id="capture"><span class="annot"><span class="annottext">capture :: String -&gt; RoutePattern
</span><a href="Web.Scotty.Route.html#capture"><span class="hs-identifier hs-var hs-var">capture</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; RoutePattern
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><span class="hs-comment">{- | Build a route based on a function which can match using the entire 'Request' object.
'Nothing' indicates the route does not match. A 'Just' value indicates
a successful match, optionally returning a list of key-value pairs accessible by 'param'.

&gt;&gt;&gt; :{
let server = S.get (function $ \req -&gt; Just [(&quot;version&quot;, T.pack $ show $ W.httpVersion req)]) $ do
                v &lt;- S.pathParam &quot;version&quot;
                S.text v
 in do
      withScotty server $ curl &quot;http://localhost:3000/&quot;
:}
&quot;HTTP/1.1&quot;
-}</span></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Web.Scotty.Route.html#function"><span class="hs-identifier hs-type">function</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Request</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Web.Scotty.Internal.Types.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span>
</span><span id="line-216"></span><span id="function"><span class="annot"><span class="annottext">function :: (Request -&gt; Maybe [Param]) -&gt; RoutePattern
</span><a href="Web.Scotty.Route.html#function"><span class="hs-identifier hs-var hs-var">function</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Request -&gt; Maybe [Param]) -&gt; RoutePattern
</span><a href="Web.Scotty.Internal.Types.html#Function"><span class="hs-identifier hs-var">Function</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><span class="hs-comment">-- | Build a route that requires the requested path match exactly, without captures.</span></span><span>
</span><span id="line-219"></span><span class="annot"><a href="Web.Scotty.Route.html#literal"><span class="hs-identifier hs-type">literal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Web.Scotty.Internal.Types.html#RoutePattern"><span class="hs-identifier hs-type">RoutePattern</span></a></span><span>
</span><span id="line-220"></span><span id="literal"><span class="annot"><span class="annottext">literal :: String -&gt; RoutePattern
</span><a href="Web.Scotty.Route.html#literal"><span class="hs-identifier hs-var hs-var">literal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; RoutePattern
</span><a href="Web.Scotty.Internal.Types.html#Literal"><span class="hs-identifier hs-var">Literal</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; RoutePattern)
-&gt; (String -&gt; Text) -&gt; String -&gt; RoutePattern
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span>
</span><span id="line-221"></span></pre></body></html>