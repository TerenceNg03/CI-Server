<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Log.Logger</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">log-base-0.12.0.1: Structured logging solution (base package)</span><ul class="links" id="page-menu"><li id="quick-jump-button"><a href="#">Quick Jump</a></li><li><a href="src/Log.Logger.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Log.Logger</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>The <code><a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></code> type of logging back-ends.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:LoggerEnv">LoggerEnv</a> = <a href="#v:LoggerEnv">LoggerEnv</a> {<ul class="subs"><li><a href="#v:leLogger">leLogger</a> :: !<a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></li><li><a href="#v:leComponent">leComponent</a> :: !<a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></li><li><a href="#v:leDomain">leDomain</a> :: ![<a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a>]</li><li><a href="#v:leData">leData</a> :: ![<a href="../aeson-2.1.2.1/Data-Aeson-Types.html#t:Pair" title="Data.Aeson.Types">Pair</a>]</li><li><a href="#v:leMaxLogLevel">leMaxLogLevel</a> :: <a href="Log-Data.html#t:LogLevel" title="Log.Data">LogLevel</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:Logger">Logger</a></li><li class="src short"><a href="#v:mkLogger">mkLogger</a> :: <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; (<a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></li><li class="src short"><a href="#v:mkLogger-39-">mkLogger'</a> :: <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; (<a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></li><li class="src short"><a href="#v:mkBulkLogger">mkBulkLogger</a> :: <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; ([<a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a>] -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></li><li class="src short"><a href="#v:mkBulkLogger-39-">mkBulkLogger'</a> :: <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; ([<a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a>] -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></li><li class="src short"><a href="#v:execLogger">execLogger</a> :: <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:waitForLogger">waitForLogger</a> :: <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:shutdownLogger">shutdownLogger</a> :: <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LoggerEnv" class="def">LoggerEnv</a> <a href="src/Log.Logger.html#LoggerEnv" class="link">Source</a> <a href="#t:LoggerEnv" class="selflink">#</a></p><div class="doc"><p>The state that every <code>LogT</code> carries around.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LoggerEnv" class="def">LoggerEnv</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:leLogger" class="def">leLogger</a> :: !<a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></dfn><div class="doc"><p>The <code><a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></code> to use.</p></div></li><li><dfn class="src"><a id="v:leComponent" class="def">leComponent</a> :: !<a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></dfn><div class="doc"><p>Current application component.</p></div></li><li><dfn class="src"><a id="v:leDomain" class="def">leDomain</a> :: ![<a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a>]</dfn><div class="doc"><p>Current application domain.</p></div></li><li><dfn class="src"><a id="v:leData" class="def">leData</a> :: ![<a href="../aeson-2.1.2.1/Data-Aeson-Types.html#t:Pair" title="Data.Aeson.Types">Pair</a>]</dfn><div class="doc"><p>Additional data to be merged with the log
 message's data.</p></div></li><li><dfn class="src"><a id="v:leMaxLogLevel" class="def">leMaxLogLevel</a> :: <a href="Log-Data.html#t:LogLevel" title="Log.Data">LogLevel</a></dfn><div class="doc"><p>The maximum log level allowed to be logged.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Logger" class="def">Logger</a> <a href="src/Log.Internal.Logger.html#Logger" class="link">Source</a> <a href="#t:Logger" class="selflink">#</a></p><div class="doc"><p>An object used for communication with a logger thread that
 outputs <code><a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a></code>s using e.g. PostgreSQL, Elasticsearch or
 stdout (depending on the back-end chosen).</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Logger">Instances</h4><details id="i:Logger" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Logger:Monoid:1"></span> <a href="../base-4.18.1.0/Data-Monoid.html#t:Monoid" title="Data.Monoid">Monoid</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></span> <a href="src/Log.Internal.Logger.html#line-70" class="link">Source</a> <a href="#t:Logger" class="selflink">#</a></td><td class="doc"><p>Composition of <code><a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></code> objects.</p></td></tr><tr><td colspan="2"><details id="i:id:Logger:Monoid:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Log-Internal-Logger.html">Log.Internal.Logger</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:mempty">mempty</a> :: <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> <a href="#v:mempty" class="selflink">#</a></p><p class="src"><a href="#v:mappend">mappend</a> :: <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> <a href="#v:mappend" class="selflink">#</a></p><p class="src"><a href="#v:mconcat">mconcat</a> :: [<a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a>] -&gt; <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> <a href="#v:mconcat" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Logger:Semigroup:2"></span> <a href="../base-4.18.1.0/Prelude.html#t:Semigroup" title="Prelude">Semigroup</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></span> <a href="src/Log.Internal.Logger.html#line-56" class="link">Source</a> <a href="#t:Logger" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Logger:Semigroup:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Log-Internal-Logger.html">Log.Internal.Logger</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-60--62-">(&lt;&gt;)</a> :: <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> <a href="#v:-60--62-" class="selflink">#</a></p><p class="src"><a href="#v:sconcat">sconcat</a> :: <a href="../base-4.18.1.0/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> <a href="#v:sconcat" class="selflink">#</a></p><p class="src"><a href="#v:stimes">stimes</a> :: <a href="../base-4.18.1.0/Prelude.html#t:Integral" title="Prelude">Integral</a> b =&gt; b -&gt; <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> <a href="#v:stimes" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:mkLogger" class="def">mkLogger</a> :: <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; (<a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> <a href="src/Log.Logger.html#mkLogger" class="link">Source</a> <a href="#v:mkLogger" class="selflink">#</a></p><div class="doc"><p>Start a logger thread that consumes one queued message at a time.</p><p><em>Note:</em> a bounded queue of size 1000000 is used internally to avoid
 unrestricted memory consumption.</p></div></div><div class="top"><p class="src"><a id="v:mkLogger-39-" class="def">mkLogger'</a> :: <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; (<a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> <a href="src/Log.Logger.html#mkLogger%27" class="link">Source</a> <a href="#v:mkLogger-39-" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="Log-Logger.html#v:mkBulkLogger" title="Log.Logger">mkBulkLogger</a></code>, but with configurable queue size.</p><p><em>Since: 0.9.0.0</em></p></div></div><div class="top"><p class="src"><a id="v:mkBulkLogger" class="def">mkBulkLogger</a> :: <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; ([<a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a>] -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> <a href="src/Log.Logger.html#mkBulkLogger" class="link">Source</a> <a href="#v:mkBulkLogger" class="selflink">#</a></p><div class="doc"><p>Start an asynchronous logger thread that consumes all queued messages once
 per second.</p><p><em>Note:</em> a bounded queue of size 1000000 is used internally to avoid
 unrestricted memory consumption.</p><p>To make sure that the messages get written out in the presence of exceptions,
 use high-level wrappers like <code>withLogger</code>,
 <code><a href="Log-Backend-ElasticSearch.html#v:withElasticSearchLogger" title="Log.Backend.ElasticSearch">withElasticSearchLogger</a></code> or
 <code><a href="Log-Backend-StandardOutput-Bulk.html#v:withBulkStdOutLogger" title="Log.Backend.StandardOutput.Bulk">withBulkStdOutLogger</a></code> instead of this
 function directly.</p><p><em>Note:</em> some messages can be lost when the main thread shuts down
 without making sure that all logger threads have written out all
 messages, because in that case child threads are not given a chance
 to clean up by the RTS. This is apparently a feature:
 <a href="https://mail.haskell.org/pipermail/haskell-cafe/2014-February/112754.html">https://mail.haskell.org/pipermail/haskell-cafe/2014-February/112754.html</a></p><p>To work around this issue, make sure that the main thread doesn't
 exit until all its children have terminated. The <code>async</code> package
 makes this easy.</p><p>Problematic example:</p><pre>import Control.Concurrent.Async

main :: IO ()
main = do
   logger &lt;- <code><a href="Log-Backend-ElasticSearch.html#v:elasticSearchLogger" title="Log.Backend.ElasticSearch">elasticSearchLogger</a></code>
   a &lt;- <code><a href="Control-Concurrent-Async.html#v:async" title="Control.Concurrent.Async">async</a></code> (<code><a href="Log-Backend-ElasticSearch.html#v:withElasticSearchLogger" title="Log.Backend.ElasticSearch">withElasticSearchLogger</a></code> $ \logger -&gt;
               <code><a href="Log-Monad.html#v:runLogT" title="Log.Monad">runLogT</a></code> &quot;main&quot; logger defaultLogLevel $ <code><a href="Log-Class.html#v:logTrace_" title="Log.Class">logTrace_</a></code> &quot;foo&quot;)
   -- Main thread exits without waiting for the child
   -- to finish and without giving the child a chance
   -- to do proper cleanup.
</pre><p>Fixed example:</p><pre>import Control.Concurrent.Async

main :: IO ()
main = do
   logger &lt;- <code><a href="Log-Backend-ElasticSearch.html#v:elasticSearchLogger" title="Log.Backend.ElasticSearch">elasticSearchLogger</a></code>
   a &lt;- <code><a href="Control-Concurrent-Async.html#v:async" title="Control.Concurrent.Async">async</a></code> (<code><a href="Log-Backend-ElasticSearch.html#v:withElasticSearchLogger" title="Log.Backend.ElasticSearch">withElasticSearchLogger</a></code> $ \logger -&gt;
               <code><a href="Log-Monad.html#v:runLogT" title="Log.Monad">runLogT</a></code> &quot;main&quot; logger defaultLogLevel $ <code><a href="Log-Class.html#v:logTrace_" title="Log.Class">logTrace_</a></code> &quot;foo&quot;)
   <code><a href="Control-Concurrent-Async.html#v:wait" title="Control.Concurrent.Async">wait</a></code> a
   -- Main thread waits for the child to finish, giving
   -- it a chance to shut down properly. This works even
   -- in the presence of exceptions in the child thread.
</pre></div></div><div class="top"><p class="src"><a id="v:mkBulkLogger-39-" class="def">mkBulkLogger'</a> <a href="src/Log.Logger.html#mkBulkLogger%27" class="link">Source</a> <a href="#v:mkBulkLogger-39-" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>queue capacity (default 1000000)</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>thread delay (microseconds, default 1000000)</p></td></tr><tr><td class="src">-&gt; <a href="../text-2.0.2/Data-Text.html#t:Text" title="Data.Text">Text</a></td><td class="doc"><p>logger name</p></td></tr><tr><td class="src">-&gt; ([<a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a>] -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ())</td><td class="doc"><p>write</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc"><p>flush</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Like <code><a href="Log-Logger.html#v:mkBulkLogger" title="Log.Logger">mkBulkLogger</a></code>, but with configurable queue size and thread delay.</p><p><em>Since: 0.7.4.0</em></p></div></div><div class="top"><p class="src"><a id="v:execLogger" class="def">execLogger</a> :: <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Log.Internal.Logger.html#execLogger" class="link">Source</a> <a href="#v:execLogger" class="selflink">#</a></p><div class="doc"><p>Execute logger to serialize a <code><a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:waitForLogger" class="def">waitForLogger</a> :: <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Log.Internal.Logger.html#waitForLogger" class="link">Source</a> <a href="#v:waitForLogger" class="selflink">#</a></p><div class="doc"><p>Wait until all <code><a href="Log-Data.html#t:LogMessage" title="Log.Data">LogMessage</a></code>s stored in the internal queue are
 serialized.</p></div></div><div class="top"><p class="src"><a id="v:shutdownLogger" class="def">shutdownLogger</a> :: <a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a> -&gt; <a href="../base-4.18.1.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Log.Internal.Logger.html#shutdownLogger" class="link">Source</a> <a href="#v:shutdownLogger" class="selflink">#</a></p><div class="doc"><p>Shutdown the logger thread associated with this <code><a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></code>
 object. Subsequent attempts to write messages via this <code><a href="Log-Logger.html#t:Logger" title="Log.Logger">Logger</a></code>
 will result in an exception.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.1</p></div></body></html>