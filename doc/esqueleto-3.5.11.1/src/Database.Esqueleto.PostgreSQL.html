<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE Rank2Types #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">-- | This module contain PostgreSQL-specific functions.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- @since: 2.2.8</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.Esqueleto.PostgreSQL</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#AggMode"><span class="hs-identifier">AggMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayAggDistinct"><span class="hs-identifier">arrayAggDistinct</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayAgg"><span class="hs-identifier">arrayAgg</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayAggWith"><span class="hs-identifier">arrayAggWith</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayRemove"><span class="hs-identifier">arrayRemove</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayRemoveNull"><span class="hs-identifier">arrayRemoveNull</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#stringAgg"><span class="hs-identifier">stringAgg</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#stringAggWith"><span class="hs-identifier">stringAggWith</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#maybeArray"><span class="hs-identifier">maybeArray</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#chr"><span class="hs-identifier">chr</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#now_"><span class="hs-identifier">now_</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#random_"><span class="hs-identifier">random_</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#upsert"><span class="hs-identifier">upsert</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#upsertBy"><span class="hs-identifier">upsertBy</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#insertSelectWithConflict"><span class="hs-identifier">insertSelectWithConflict</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#insertSelectWithConflictCount"><span class="hs-identifier">insertSelectWithConflictCount</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#noWait"><span class="hs-identifier">noWait</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#wait"><span class="hs-identifier">wait</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#skipLocked"><span class="hs-identifier">skipLocked</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#forUpdateOf"><span class="hs-identifier">forUpdateOf</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#forShareOf"><span class="hs-identifier">forShareOf</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#filterWhere"><span class="hs-identifier">filterWhere</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#values"><span class="hs-identifier">values</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internal</span></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#unsafeSqlAggregateFunction"><span class="hs-identifier">unsafeSqlAggregateFunction</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &lt; 804
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Semigroup</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throw</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Reader</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Internal.Builder</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TLB</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TL</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Database.Esqueleto.Experimental.html"><span class="hs-identifier">Database.Esqueleto.Experimental</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ex</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html"><span class="hs-identifier">Database.Esqueleto.Internal.Internal</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#random_"><span class="hs-identifier">random_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.PersistentImport.html"><span class="hs-identifier">Database.Esqueleto.Internal.PersistentImport</span></a></span><span> </span><span class="hs-keyword">hiding</span><span>
</span><span id="line-59"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">uniqueFields</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">upsert</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">upsertBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.Persist.SqlBackend</span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- | (@random()@) Split out into database specific modules</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- because MySQL uses `rand()`.</span><span>
</span><span id="line-64"></span><span class="hs-comment">--</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- @since 2.6.0</span><span>
</span><span id="line-66"></span><span id="local-6989586621679309714"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#random_"><span class="hs-identifier hs-type">random_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PersistField</span></span><span> </span><span class="annot"><a href="#local-6989586621679309714"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679309714"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309714"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-67"></span><span id="random_"><span class="annot"><span class="annottext">random_ :: forall a. (PersistField a, Num a) =&gt; SqlExpr (Value a)
</span><a href="Database.Esqueleto.PostgreSQL.html#random_"><span class="hs-identifier hs-var hs-var">random_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; SqlExpr (Value a)
forall a. Builder -&gt; SqlExpr (Value a)
</span><a href="Database.Esqueleto.Internal.Internal.html#unsafeSqlValue"><span class="hs-identifier hs-var">unsafeSqlValue</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;RANDOM()&quot;</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="annot"><span class="hs-comment">-- | Empty array literal. (@val []@) does unfortunately not work</span></span><span>
</span><span id="line-70"></span><span id="local-6989586621679309720"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#emptyArray"><span class="hs-identifier hs-type">emptyArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309720"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-71"></span><span id="emptyArray"><span class="annot"><span class="annottext">emptyArray :: forall a. SqlExpr (Value [a])
</span><a href="Database.Esqueleto.PostgreSQL.html#emptyArray"><span class="hs-identifier hs-var hs-var">emptyArray</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; SqlExpr (Value [a])
forall a. Builder -&gt; SqlExpr (Value a)
</span><a href="Database.Esqueleto.Internal.Internal.html#unsafeSqlValue"><span class="hs-identifier hs-var">unsafeSqlValue</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;'{}'&quot;</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">-- | Coalesce an array with an empty default value</span></span><span>
</span><span id="line-74"></span><span id="local-6989586621679309722"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#maybeArray"><span class="hs-identifier hs-type">maybeArray</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-75"></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PersistField</span></span><span> </span><span class="annot"><a href="#local-6989586621679309722"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistField</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309722"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309722"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309722"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-78"></span><span id="maybeArray"><span class="annot"><span class="annottext">maybeArray :: forall a.
(PersistField a, PersistField [a]) =&gt;
SqlExpr (Value (Maybe [a])) -&gt; SqlExpr (Value [a])
</span><a href="Database.Esqueleto.PostgreSQL.html#maybeArray"><span class="hs-identifier hs-var hs-var">maybeArray</span></a></span></span><span> </span><span id="local-6989586621679309993"><span class="annot"><span class="annottext">SqlExpr (Value (Maybe [a]))
</span><a href="#local-6989586621679309993"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SqlExpr (Value (Maybe [a]))]
-&gt; SqlExpr (Value [a]) -&gt; SqlExpr (Value [a])
forall a.
PersistField a =&gt;
[SqlExpr (Value (Maybe a))]
-&gt; SqlExpr (Value a) -&gt; SqlExpr (Value a)
</span><a href="Database.Esqueleto.Internal.Internal.html#coalesceDefault"><span class="hs-identifier hs-var">coalesceDefault</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SqlExpr (Value (Maybe [a]))
</span><a href="#local-6989586621679309993"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlExpr (Value [a])
forall a. SqlExpr (Value [a])
</span><a href="Database.Esqueleto.PostgreSQL.html#emptyArray"><span class="hs-identifier hs-var">emptyArray</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">-- | Aggregate mode</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">data</span><span> </span><span id="AggMode"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#AggMode"><span class="hs-identifier hs-var">AggMode</span></a></span></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="AggModeAll"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#AggModeAll"><span class="hs-identifier hs-var">AggModeAll</span></a></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ ALL</span></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="AggModeDistinct"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#AggModeDistinct"><span class="hs-identifier hs-var">AggModeDistinct</span></a></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ DISTINCT</span></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679309998"><span id="local-6989586621679310000"><span id="local-6989586621679310004"><span class="annot"><span class="annottext">Int -&gt; AggMode -&gt; ShowS
[AggMode] -&gt; ShowS
AggMode -&gt; String
(Int -&gt; AggMode -&gt; ShowS)
-&gt; (AggMode -&gt; String) -&gt; ([AggMode] -&gt; ShowS) -&gt; Show AggMode
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; AggMode -&gt; ShowS
showsPrec :: Int -&gt; AggMode -&gt; ShowS
$cshow :: AggMode -&gt; String
show :: AggMode -&gt; String
$cshowList :: [AggMode] -&gt; ShowS
showList :: [AggMode] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | (Internal) Create a custom aggregate functions with aggregate mode</span><span>
</span><span id="line-87"></span><span class="hs-comment">--</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- /Do/ /not/ use this function directly, instead define a new function and give</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- it a type (see `unsafeSqlBinOp`)</span><span>
</span><span id="line-90"></span><span id="local-6989586621679309728"><span id="local-6989586621679309730"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#unsafeSqlAggregateFunction"><span class="hs-identifier hs-type">unsafeSqlAggregateFunction</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#UnsafeSqlFunctionArgument"><span class="hs-identifier hs-type">UnsafeSqlFunctionArgument</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309728"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLB.Builder</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#AggMode"><span class="hs-identifier hs-type">AggMode</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679309728"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#OrderByClause"><span class="hs-identifier hs-type">OrderByClause</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309730"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-97"></span><span id="unsafeSqlAggregateFunction"><span class="annot"><span class="annottext">unsafeSqlAggregateFunction :: forall a b.
UnsafeSqlFunctionArgument a =&gt;
Builder -&gt; AggMode -&gt; a -&gt; [OrderByClause] -&gt; SqlExpr (Value b)
</span><a href="Database.Esqueleto.PostgreSQL.html#unsafeSqlAggregateFunction"><span class="hs-identifier hs-var hs-var">unsafeSqlAggregateFunction</span></a></span></span><span> </span><span id="local-6989586621679310023"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310023"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679310024"><span class="annot"><span class="annottext">AggMode
</span><a href="#local-6989586621679310024"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621679310025"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310025"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679310026"><span class="annot"><span class="annottext">[OrderByClause]
</span><a href="#local-6989586621679310026"><span class="hs-identifier hs-var">orderByClauses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlExprMeta
-&gt; (NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; SqlExpr (Value b)
forall a.
SqlExprMeta
-&gt; (NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; SqlExpr a
</span><a href="Database.Esqueleto.Internal.Internal.html#ERaw"><span class="hs-identifier hs-var">ERaw</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExprMeta
</span><a href="Database.Esqueleto.Internal.Internal.html#noMeta"><span class="hs-identifier hs-var">noMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
 -&gt; SqlExpr (Value b))
-&gt; (NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; SqlExpr (Value b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">NeedParens
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679310029"><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310029"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310030"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310030"><span class="hs-identifier hs-var">orderTLB</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310031"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310031"><span class="hs-identifier hs-var">orderVals</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdentInfo -&gt; [OrderByClause] -&gt; (Builder, [PersistValue])
</span><a href="Database.Esqueleto.Internal.Internal.html#makeOrderByNoNewline"><span class="hs-identifier hs-var">makeOrderByNoNewline</span></a></span><span> </span><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310029"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">[OrderByClause]
</span><a href="#local-6989586621679310026"><span class="hs-identifier hs-var">orderByClauses</span></a></span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-comment">-- Don't add a space if we don't have order by clauses</span><span>
</span><span id="line-100"></span><span>        </span><span id="local-6989586621679310033"><span class="annot"><span class="annottext">orderTLBSpace :: Builder
</span><a href="#local-6989586621679310033"><span class="hs-identifier hs-var hs-var">orderTLBSpace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[OrderByClause]
</span><a href="#local-6989586621679310026"><span class="hs-identifier hs-var">orderByClauses</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-102"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-103"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByClause
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[OrderByClause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679310034"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310034"><span class="hs-identifier hs-var">argsTLB</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310035"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310035"><span class="hs-identifier hs-var">argsVals</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-105"></span><span>            </span><span class="annot"><span class="annottext">[(Builder, [PersistValue])] -&gt; (Builder, [PersistValue])
forall a. Monoid a =&gt; [(Builder, a)] -&gt; (Builder, a)
</span><a href="Database.Esqueleto.Internal.Internal.html#uncommas%27"><span class="hs-identifier hs-var">uncommas'</span></a></span><span> </span><span class="annot"><span class="annottext">([(Builder, [PersistValue])] -&gt; (Builder, [PersistValue]))
-&gt; [(Builder, [PersistValue])] -&gt; (Builder, [PersistValue])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SqlExpr (Value ()) -&gt; (Builder, [PersistValue]))
-&gt; [SqlExpr (Value ())] -&gt; [(Builder, [PersistValue])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#ERaw"><span class="hs-identifier hs-type">ERaw</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExprMeta
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679310037"><span class="annot"><span class="annottext">NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310037"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310037"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">NeedParens
</span><a href="Database.Esqueleto.Internal.Internal.html#Never"><span class="hs-identifier hs-var">Never</span></a></span><span> </span><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310029"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SqlExpr (Value ())] -&gt; [(Builder, [PersistValue])])
-&gt; [SqlExpr (Value ())] -&gt; [(Builder, [PersistValue])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [SqlExpr (Value ())]
forall a. UnsafeSqlFunctionArgument a =&gt; a -&gt; [SqlExpr (Value ())]
</span><a href="Database.Esqueleto.Internal.Internal.html#toArgList"><span class="hs-identifier hs-var">toArgList</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310025"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-106"></span><span>        </span><span id="local-6989586621679310040"><span class="annot"><span class="annottext">aggMode :: Builder
</span><a href="#local-6989586621679310040"><span class="hs-identifier hs-var hs-var">aggMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-107"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AggMode
</span><a href="#local-6989586621679310024"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>                </span><span class="annot"><span class="annottext">AggMode
</span><a href="Database.Esqueleto.PostgreSQL.html#AggModeAll"><span class="hs-identifier hs-var">AggModeAll</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-109"></span><span>                </span><span class="hs-comment">-- ALL is the default, so we don't need to</span><span>
</span><span id="line-110"></span><span>                </span><span class="hs-comment">-- specify it</span><span>
</span><span id="line-111"></span><span>                </span><span class="annot"><span class="annottext">AggMode
</span><a href="Database.Esqueleto.PostgreSQL.html#AggModeDistinct"><span class="hs-identifier hs-var">AggModeDistinct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;DISTINCT &quot;</span></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310023"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder
</span><a href="Database.Esqueleto.Internal.Internal.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310040"><span class="hs-identifier hs-var">aggMode</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310034"><span class="hs-identifier hs-var">argsTLB</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310033"><span class="hs-identifier hs-var">orderTLBSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310030"><span class="hs-identifier hs-var">orderTLB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310035"><span class="hs-identifier hs-var">argsVals</span></a></span><span> </span><span class="annot"><span class="annottext">[PersistValue] -&gt; [PersistValue] -&gt; [PersistValue]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310031"><span class="hs-identifier hs-var">orderVals</span></a></span><span>
</span><span id="line-114"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">--- | (@array_agg@) Concatenate input values, including @NULL@s,</span><span>
</span><span id="line-117"></span><span class="hs-comment">--- into an array.</span><span>
</span><span id="line-118"></span><span id="local-6989586621679309748"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayAggWith"><span class="hs-identifier hs-type">arrayAggWith</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#AggMode"><span class="hs-identifier hs-type">AggMode</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309748"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#OrderByClause"><span class="hs-identifier hs-type">OrderByClause</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309748"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-123"></span><span id="arrayAggWith"><span class="annot"><span class="annottext">arrayAggWith :: forall a.
AggMode
-&gt; SqlExpr (Value a)
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe [a]))
</span><a href="Database.Esqueleto.PostgreSQL.html#arrayAggWith"><span class="hs-identifier hs-var hs-var">arrayAggWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
-&gt; AggMode
-&gt; SqlExpr (Value a)
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe [a]))
forall a b.
UnsafeSqlFunctionArgument a =&gt;
Builder -&gt; AggMode -&gt; a -&gt; [OrderByClause] -&gt; SqlExpr (Value b)
</span><a href="Database.Esqueleto.PostgreSQL.html#unsafeSqlAggregateFunction"><span class="hs-identifier hs-var">unsafeSqlAggregateFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;array_agg&quot;</span></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-comment">--- | (@array_agg@) Concatenate input values, including @NULL@s,</span><span>
</span><span id="line-126"></span><span class="hs-comment">--- into an array.</span><span>
</span><span id="line-127"></span><span id="local-6989586621679309755"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayAgg"><span class="hs-identifier hs-type">arrayAgg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PersistField</span></span><span> </span><span class="annot"><a href="#local-6989586621679309755"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309755"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309755"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-128"></span><span id="arrayAgg"><span class="annot"><span class="annottext">arrayAgg :: forall a.
PersistField a =&gt;
SqlExpr (Value a) -&gt; SqlExpr (Value (Maybe [a]))
</span><a href="Database.Esqueleto.PostgreSQL.html#arrayAgg"><span class="hs-identifier hs-var hs-var">arrayAgg</span></a></span></span><span> </span><span id="local-6989586621679310047"><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310047"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AggMode
-&gt; SqlExpr (Value a)
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe [a]))
forall a.
AggMode
-&gt; SqlExpr (Value a)
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe [a]))
</span><a href="Database.Esqueleto.PostgreSQL.html#arrayAggWith"><span class="hs-identifier hs-var">arrayAggWith</span></a></span><span> </span><span class="annot"><span class="annottext">AggMode
</span><a href="Database.Esqueleto.PostgreSQL.html#AggModeAll"><span class="hs-identifier hs-var">AggModeAll</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310047"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | (@array_agg@) Concatenate distinct input values, including @NULL@s, into</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- an array.</span><span>
</span><span id="line-132"></span><span class="hs-comment">--</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- @since 2.5.3</span><span>
</span><span id="line-134"></span><span id="local-6989586621679309757"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayAggDistinct"><span class="hs-identifier hs-type">arrayAggDistinct</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PersistField</span></span><span> </span><span class="annot"><a href="#local-6989586621679309757"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistField</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309757"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309757"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309757"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-138"></span><span id="arrayAggDistinct"><span class="annot"><span class="annottext">arrayAggDistinct :: forall a.
(PersistField a, PersistField [a]) =&gt;
SqlExpr (Value a) -&gt; SqlExpr (Value (Maybe [a]))
</span><a href="Database.Esqueleto.PostgreSQL.html#arrayAggDistinct"><span class="hs-identifier hs-var hs-var">arrayAggDistinct</span></a></span></span><span> </span><span id="local-6989586621679310050"><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310050"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AggMode
-&gt; SqlExpr (Value a)
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe [a]))
forall a.
AggMode
-&gt; SqlExpr (Value a)
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe [a]))
</span><a href="Database.Esqueleto.PostgreSQL.html#arrayAggWith"><span class="hs-identifier hs-var">arrayAggWith</span></a></span><span> </span><span class="annot"><span class="annottext">AggMode
</span><a href="Database.Esqueleto.PostgreSQL.html#AggModeDistinct"><span class="hs-identifier hs-var">AggModeDistinct</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310050"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- | (@array_remove@) Remove all elements equal to the given value from the</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- array.</span><span>
</span><span id="line-142"></span><span class="hs-comment">--</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- @since 2.5.3</span><span>
</span><span id="line-144"></span><span id="local-6989586621679309759"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayRemove"><span class="hs-identifier hs-type">arrayRemove</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309759"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309759"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309759"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-145"></span><span id="arrayRemove"><span class="annot"><span class="annottext">arrayRemove :: forall a.
SqlExpr (Value [a]) -&gt; SqlExpr (Value a) -&gt; SqlExpr (Value [a])
</span><a href="Database.Esqueleto.PostgreSQL.html#arrayRemove"><span class="hs-identifier hs-var hs-var">arrayRemove</span></a></span></span><span> </span><span id="local-6989586621679310058"><span class="annot"><span class="annottext">SqlExpr (Value [a])
</span><a href="#local-6989586621679310058"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679310059"><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310059"><span class="hs-identifier hs-var">elem'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
-&gt; (SqlExpr (Value [a]), SqlExpr (Value a)) -&gt; SqlExpr (Value [a])
forall a b.
UnsafeSqlFunctionArgument a =&gt;
Builder -&gt; a -&gt; SqlExpr (Value b)
</span><a href="Database.Esqueleto.Internal.Internal.html#unsafeSqlFunction"><span class="hs-identifier hs-var">unsafeSqlFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;array_remove&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlExpr (Value [a])
</span><a href="#local-6989586621679310058"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310059"><span class="hs-identifier hs-var">elem'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><span class="hs-comment">-- | Remove @NULL@ values from an array</span></span><span>
</span><span id="line-148"></span><span id="local-6989586621679309765"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#arrayRemoveNull"><span class="hs-identifier hs-type">arrayRemoveNull</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679309765"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679309765"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- This can't be a call to arrayRemove because it changes the value type</span><span>
</span><span id="line-150"></span><span id="arrayRemoveNull"><span class="annot"><span class="annottext">arrayRemoveNull :: forall a. SqlExpr (Value [Maybe a]) -&gt; SqlExpr (Value [a])
</span><a href="Database.Esqueleto.PostgreSQL.html#arrayRemoveNull"><span class="hs-identifier hs-var hs-var">arrayRemoveNull</span></a></span></span><span> </span><span id="local-6989586621679310068"><span class="annot"><span class="annottext">SqlExpr (Value [Maybe a])
</span><a href="#local-6989586621679310068"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
-&gt; (SqlExpr (Value [Maybe a]), SqlExpr (Value Any))
-&gt; SqlExpr (Value [a])
forall a b.
UnsafeSqlFunctionArgument a =&gt;
Builder -&gt; a -&gt; SqlExpr (Value b)
</span><a href="Database.Esqueleto.Internal.Internal.html#unsafeSqlFunction"><span class="hs-identifier hs-var">unsafeSqlFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;array_remove&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlExpr (Value [Maybe a])
</span><a href="#local-6989586621679310068"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; SqlExpr (Value Any)
forall a. Builder -&gt; SqlExpr (Value a)
</span><a href="Database.Esqueleto.Internal.Internal.html#unsafeSqlValue"><span class="hs-identifier hs-var">unsafeSqlValue</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;NULL&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-comment">-- | (@string_agg@) Concatenate input values separated by a</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- delimiter.</span><span>
</span><span id="line-155"></span><span id="local-6989586621679309767"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#stringAggWith"><span class="hs-identifier hs-type">stringAggWith</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-156"></span><span>     </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlString"><span class="hs-identifier hs-type">SqlString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309767"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#AggMode"><span class="hs-identifier hs-type">AggMode</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Aggregate mode (ALL or DISTINCT)</span></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309767"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Input values.</span></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309767"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Delimiter.</span></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#OrderByClause"><span class="hs-identifier hs-type">OrderByClause</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ ORDER BY clauses</span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679309767"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Concatenation.</span></span><span>
</span><span id="line-162"></span><span id="stringAggWith"><span class="annot"><span class="annottext">stringAggWith :: forall s.
SqlString s =&gt;
AggMode
-&gt; SqlExpr (Value s)
-&gt; SqlExpr (Value s)
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe s))
</span><a href="Database.Esqueleto.PostgreSQL.html#stringAggWith"><span class="hs-identifier hs-var hs-var">stringAggWith</span></a></span></span><span> </span><span id="local-6989586621679310075"><span class="annot"><span class="annottext">AggMode
</span><a href="#local-6989586621679310075"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621679310076"><span class="annot"><span class="annottext">SqlExpr (Value s)
</span><a href="#local-6989586621679310076"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621679310077"><span class="annot"><span class="annottext">SqlExpr (Value s)
</span><a href="#local-6989586621679310077"><span class="hs-identifier hs-var">delim</span></a></span></span><span> </span><span id="local-6989586621679310078"><span class="annot"><span class="annottext">[OrderByClause]
</span><a href="#local-6989586621679310078"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">Builder
-&gt; AggMode
-&gt; (SqlExpr (Value s), SqlExpr (Value s))
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe s))
forall a b.
UnsafeSqlFunctionArgument a =&gt;
Builder -&gt; AggMode -&gt; a -&gt; [OrderByClause] -&gt; SqlExpr (Value b)
</span><a href="Database.Esqueleto.PostgreSQL.html#unsafeSqlAggregateFunction"><span class="hs-identifier hs-var">unsafeSqlAggregateFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;string_agg&quot;</span></span><span> </span><span class="annot"><span class="annottext">AggMode
</span><a href="#local-6989586621679310075"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlExpr (Value s)
</span><a href="#local-6989586621679310076"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value s)
</span><a href="#local-6989586621679310077"><span class="hs-identifier hs-var">delim</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[OrderByClause]
</span><a href="#local-6989586621679310078"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">-- | (@string_agg@) Concatenate input values separated by a</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- delimiter.</span><span>
</span><span id="line-167"></span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- @since 2.2.8</span><span>
</span><span id="line-169"></span><span id="local-6989586621679309770"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#stringAgg"><span class="hs-identifier hs-type">stringAgg</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-170"></span><span>     </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlString"><span class="hs-identifier hs-type">SqlString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309770"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309770"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Input values.</span></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309770"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Delimiter.</span></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679309770"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Concatenation.</span></span><span>
</span><span id="line-174"></span><span id="stringAgg"><span class="annot"><span class="annottext">stringAgg :: forall s.
SqlString s =&gt;
SqlExpr (Value s) -&gt; SqlExpr (Value s) -&gt; SqlExpr (Value (Maybe s))
</span><a href="Database.Esqueleto.PostgreSQL.html#stringAgg"><span class="hs-identifier hs-var hs-var">stringAgg</span></a></span></span><span> </span><span id="local-6989586621679310081"><span class="annot"><span class="annottext">SqlExpr (Value s)
</span><a href="#local-6989586621679310081"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621679310082"><span class="annot"><span class="annottext">SqlExpr (Value s)
</span><a href="#local-6989586621679310082"><span class="hs-identifier hs-var">delim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AggMode
-&gt; SqlExpr (Value s)
-&gt; SqlExpr (Value s)
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe s))
forall s.
SqlString s =&gt;
AggMode
-&gt; SqlExpr (Value s)
-&gt; SqlExpr (Value s)
-&gt; [OrderByClause]
-&gt; SqlExpr (Value (Maybe s))
</span><a href="Database.Esqueleto.PostgreSQL.html#stringAggWith"><span class="hs-identifier hs-var">stringAggWith</span></a></span><span> </span><span class="annot"><span class="annottext">AggMode
</span><a href="Database.Esqueleto.PostgreSQL.html#AggModeAll"><span class="hs-identifier hs-var">AggModeAll</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value s)
</span><a href="#local-6989586621679310081"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value s)
</span><a href="#local-6989586621679310082"><span class="hs-identifier hs-var">delim</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- | (@chr@) Translate the given integer to a character. (Note the result will</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- depend on the character set of your database.)</span><span>
</span><span id="line-178"></span><span class="hs-comment">--</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- @since 2.2.11</span><span>
</span><span id="line-180"></span><span id="local-6989586621679309772"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#chr"><span class="hs-identifier hs-type">chr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlString"><span class="hs-identifier hs-type">SqlString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309772"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309772"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-181"></span><span id="chr"><span class="annot"><span class="annottext">chr :: forall s. SqlString s =&gt; SqlExpr (Value Int) -&gt; SqlExpr (Value s)
</span><a href="Database.Esqueleto.PostgreSQL.html#chr"><span class="hs-identifier hs-var hs-var">chr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; SqlExpr (Value Int) -&gt; SqlExpr (Value s)
forall a b.
UnsafeSqlFunctionArgument a =&gt;
Builder -&gt; a -&gt; SqlExpr (Value b)
</span><a href="Database.Esqueleto.Internal.Internal.html#unsafeSqlFunction"><span class="hs-identifier hs-var">unsafeSqlFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;chr&quot;</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#now_"><span class="hs-identifier hs-type">now_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span id="now_"><span class="annot"><span class="annottext">now_ :: SqlExpr (Value UTCTime)
</span><a href="Database.Esqueleto.PostgreSQL.html#now_"><span class="hs-identifier hs-var hs-var">now_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; () -&gt; SqlExpr (Value UTCTime)
forall a b.
UnsafeSqlFunctionArgument a =&gt;
Builder -&gt; a -&gt; SqlExpr (Value b)
</span><a href="Database.Esqueleto.Internal.Internal.html#unsafeSqlFunction"><span class="hs-identifier hs-var">unsafeSqlFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;NOW&quot;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span id="local-6989586621679309775"><span id="local-6989586621679309777"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#upsert"><span class="hs-identifier hs-type">upsert</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">::</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679309775"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistEntity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309777"><span class="hs-identifier hs-type">record</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnlyOneUniqueKey</span></span><span> </span><span class="annot"><a href="#local-6989586621679309777"><span class="hs-identifier hs-type">record</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistRecordBackend</span></span><span> </span><span class="annot"><a href="#local-6989586621679309777"><span class="hs-identifier hs-type">record</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsPersistBackend</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PersistEntityBackend</span></span><span> </span><span class="annot"><a href="#local-6989586621679309777"><span class="hs-identifier hs-type">record</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679309777"><span class="hs-identifier hs-type">record</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ new record to insert</span></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309777"><span class="hs-identifier hs-type">record</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Update"><span class="hs-identifier hs-type">Update</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ updates to perform if the record already exists</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.ReaderT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="annot"><a href="#local-6989586621679309775"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309777"><span class="hs-identifier hs-type">record</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ the record in the database after the operation</span></span><span>
</span><span id="line-200"></span><span id="upsert"><span class="annot"><span class="annottext">upsert :: forall (m :: * -&gt; *) record.
(MonadIO m, PersistEntity record, OnlyOneUniqueKey record,
 PersistRecordBackend record SqlBackend,
 IsPersistBackend (PersistEntityBackend record)) =&gt;
record
-&gt; [SqlExpr (Entity record) -&gt; SqlExpr Update]
-&gt; ReaderT SqlBackend m (Entity record)
</span><a href="Database.Esqueleto.PostgreSQL.html#upsert"><span class="hs-identifier hs-var hs-var">upsert</span></a></span></span><span> </span><span id="local-6989586621679310110"><span class="annot"><span class="annottext">record
</span><a href="#local-6989586621679310110"><span class="hs-identifier hs-var">record</span></a></span></span><span> </span><span id="local-6989586621679310111"><span class="annot"><span class="annottext">[SqlExpr (Entity record) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310111"><span class="hs-identifier hs-var">updates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621679310112"><span class="annot"><span class="annottext">Unique record
</span><a href="#local-6989586621679310112"><span class="hs-identifier hs-var">uniqueKey</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">record -&gt; ReaderT SqlBackend m (Unique record)
forall record backend (m :: * -&gt; *).
(MonadIO m, PersistUniqueWrite backend,
 PersistRecordBackend record backend, OnlyOneUniqueKey record) =&gt;
record -&gt; ReaderT backend m (Unique record)
</span><span class="hs-identifier hs-var">onlyUnique</span></span><span> </span><span class="annot"><span class="annottext">record
</span><a href="#local-6989586621679310110"><span class="hs-identifier hs-var">record</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">Unique record
-&gt; record
-&gt; [SqlExpr (Entity record) -&gt; SqlExpr Update]
-&gt; ReaderT SqlBackend m (Entity record)
forall (m :: * -&gt; *) record.
(MonadIO m, PersistEntity record,
 IsPersistBackend (PersistEntityBackend record)) =&gt;
Unique record
-&gt; record
-&gt; [SqlExpr (Entity record) -&gt; SqlExpr Update]
-&gt; ReaderT SqlBackend m (Entity record)
</span><a href="Database.Esqueleto.PostgreSQL.html#upsertBy"><span class="hs-identifier hs-var">upsertBy</span></a></span><span> </span><span class="annot"><span class="annottext">Unique record
</span><a href="#local-6989586621679310112"><span class="hs-identifier hs-var">uniqueKey</span></a></span><span> </span><span class="annot"><span class="annottext">record
</span><a href="#local-6989586621679310110"><span class="hs-identifier hs-var">record</span></a></span><span> </span><span class="annot"><span class="annottext">[SqlExpr (Entity record) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310111"><span class="hs-identifier hs-var">updates</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="local-6989586621679309798"><span id="local-6989586621679309799"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#upsertBy"><span class="hs-identifier hs-type">upsertBy</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-glyph">::</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679309798"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistEntity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309799"><span class="hs-identifier hs-type">record</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsPersistBackend</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PersistEntityBackend</span></span><span> </span><span class="annot"><a href="#local-6989586621679309799"><span class="hs-identifier hs-type">record</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unique</span></span><span> </span><span class="annot"><a href="#local-6989586621679309799"><span class="hs-identifier hs-type">record</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ uniqueness constraint to find by</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679309799"><span class="hs-identifier hs-type">record</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ new record to insert</span></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309799"><span class="hs-identifier hs-type">record</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Update"><span class="hs-identifier hs-type">Update</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ updates to perform if the record already exists</span></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.ReaderT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="annot"><a href="#local-6989586621679309798"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309799"><span class="hs-identifier hs-type">record</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ the record in the database after the operation</span></span><span>
</span><span id="line-218"></span><span id="upsertBy"><span class="annot"><span class="annottext">upsertBy :: forall (m :: * -&gt; *) record.
(MonadIO m, PersistEntity record,
 IsPersistBackend (PersistEntityBackend record)) =&gt;
Unique record
-&gt; record
-&gt; [SqlExpr (Entity record) -&gt; SqlExpr Update]
-&gt; ReaderT SqlBackend m (Entity record)
</span><a href="Database.Esqueleto.PostgreSQL.html#upsertBy"><span class="hs-identifier hs-var hs-var">upsertBy</span></a></span></span><span> </span><span id="local-6989586621679310154"><span class="annot"><span class="annottext">Unique record
</span><a href="#local-6989586621679310154"><span class="hs-identifier hs-var">uniqueKey</span></a></span></span><span> </span><span id="local-6989586621679310155"><span class="annot"><span class="annottext">record
</span><a href="#local-6989586621679310155"><span class="hs-identifier hs-var">record</span></a></span></span><span> </span><span id="local-6989586621679310156"><span class="annot"><span class="annottext">[SqlExpr (Entity record) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310156"><span class="hs-identifier hs-var">updates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621679310157"><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679310157"><span class="hs-identifier hs-var">sqlB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT SqlBackend m SqlBackend
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><span class="hs-identifier hs-var">R.ask</span></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SqlBackend
-&gt; Maybe
     (EntityDef -&gt; NonEmpty (FieldNameHS, FieldNameDB) -&gt; Text -&gt; Text)
forall backend (m :: * -&gt; *).
(BackendCompatible SqlBackend backend, MonadReader backend m) =&gt;
m (Maybe
     (EntityDef -&gt; NonEmpty (FieldNameHS, FieldNameDB) -&gt; Text -&gt; Text))
</span><span class="hs-identifier hs-var">getConnUpsertSql</span></span><span> </span><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679310157"><span class="hs-identifier hs-var">sqlB</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="annottext">Maybe
  (EntityDef -&gt; NonEmpty (FieldNameHS, FieldNameDB) -&gt; Text -&gt; Text)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>            </span><span class="hs-comment">-- Postgres backend should have connUpsertSql, if this error is</span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-comment">-- thrown, check changes on persistent</span><span>
</span><span id="line-224"></span><span>            </span><span class="annot"><span class="annottext">EsqueletoError -&gt; ReaderT SqlBackend m (Entity record)
forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnexpectedCaseError -&gt; EsqueletoError
</span><a href="Database.Esqueleto.Internal.Internal.html#UnexpectedCaseErr"><span class="hs-identifier hs-var">UnexpectedCaseErr</span></a></span><span> </span><span class="annot"><span class="annottext">UnexpectedCaseError
</span><a href="Database.Esqueleto.Internal.Internal.html#OperationNotSupported"><span class="hs-identifier hs-var">OperationNotSupported</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679310162"><span class="annot"><span class="annottext">EntityDef -&gt; NonEmpty (FieldNameHS, FieldNameDB) -&gt; Text -&gt; Text
</span><a href="#local-6989586621679310162"><span class="hs-identifier hs-var">upsertSql</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-226"></span><span>            </span><span class="annot"><span class="annottext">SqlBackend
-&gt; (EntityDef
    -&gt; NonEmpty (FieldNameHS, FieldNameDB) -&gt; Text -&gt; Text)
-&gt; ReaderT SqlBackend m (Entity record)
</span><a href="#local-6989586621679310163"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679310157"><span class="hs-identifier hs-var">sqlB</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; NonEmpty (FieldNameHS, FieldNameDB) -&gt; Text -&gt; Text
</span><a href="#local-6989586621679310162"><span class="hs-identifier hs-var">upsertSql</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679310164"><span class="annot"><span class="annottext">addVals :: [PersistValue] -&gt; [PersistValue]
</span><a href="#local-6989586621679310164"><span class="hs-identifier hs-var hs-var">addVals</span></a></span></span><span> </span><span id="local-6989586621679310165"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310165"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PersistValue -&gt; PersistValue) -&gt; [PersistValue] -&gt; [PersistValue]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PersistValue -&gt; PersistValue
forall a. PersistField a =&gt; a -&gt; PersistValue
</span><span class="hs-identifier hs-var">toPersistValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">record -&gt; [PersistValue]
forall record. PersistEntity record =&gt; record -&gt; [PersistValue]
</span><span class="hs-identifier hs-var">toPersistFields</span></span><span> </span><span class="annot"><span class="annottext">record
</span><a href="#local-6989586621679310155"><span class="hs-identifier hs-var">record</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PersistValue] -&gt; [PersistValue] -&gt; [PersistValue]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310165"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[PersistValue] -&gt; [PersistValue] -&gt; [PersistValue]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Unique record -&gt; [PersistValue]
forall record.
PersistEntity record =&gt;
Unique record -&gt; [PersistValue]
</span><span class="hs-identifier hs-var">persistUniqueToValues</span></span><span> </span><span class="annot"><span class="annottext">Unique record
</span><a href="#local-6989586621679310154"><span class="hs-identifier hs-var">uniqueKey</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621679310169"><span class="annot"><span class="annottext">entDef :: EntityDef
</span><a href="#local-6989586621679310169"><span class="hs-identifier hs-var hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe record -&gt; EntityDef
forall record (proxy :: * -&gt; *).
PersistEntity record =&gt;
proxy record -&gt; EntityDef
forall (proxy :: * -&gt; *). proxy record -&gt; EntityDef
</span><span class="hs-identifier hs-var">entityDef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">record -&gt; Maybe record
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">record
</span><a href="#local-6989586621679310155"><span class="hs-identifier hs-var">record</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621679310171"><span class="annot"><span class="annottext">updatesText :: SqlBackend -&gt; (Text, [PersistValue])
</span><a href="#local-6989586621679310171"><span class="hs-identifier hs-var hs-var">updatesText</span></a></span></span><span> </span><span id="local-6989586621679310172"><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679310172"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Text)
-&gt; (Builder, [PersistValue]) -&gt; (Text, [PersistValue])
forall b c d. (b -&gt; c) -&gt; (b, d) -&gt; (c, d)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><a href="Database.Esqueleto.Internal.Internal.html#builderToText"><span class="hs-identifier hs-var">builderToText</span></a></span><span> </span><span class="annot"><span class="annottext">((Builder, [PersistValue]) -&gt; (Text, [PersistValue]))
-&gt; (Builder, [PersistValue]) -&gt; (Text, [PersistValue])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SqlBackend
-&gt; [SqlExpr (Entity record) -&gt; SqlExpr Update]
-&gt; (Builder, [PersistValue])
forall backend val.
BackendCompatible SqlBackend backend =&gt;
backend
-&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update]
-&gt; (Builder, [PersistValue])
</span><a href="Database.Esqueleto.Internal.Internal.html#renderUpdates"><span class="hs-identifier hs-var">renderUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679310172"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">[SqlExpr (Entity record) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310156"><span class="hs-identifier hs-var">updates</span></a></span><span class="hs-cpp">
#if MIN_VERSION_persistent(2,11,0)
</span><span>    </span><span id="local-6989586621679310175"><span class="annot"><span class="annottext">uniqueFields :: NonEmpty (FieldNameHS, FieldNameDB)
</span><a href="#local-6989586621679310175"><span class="hs-identifier hs-var hs-var">uniqueFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique record -&gt; NonEmpty (FieldNameHS, FieldNameDB)
forall record.
PersistEntity record =&gt;
Unique record -&gt; NonEmpty (FieldNameHS, FieldNameDB)
</span><span class="hs-identifier hs-var">persistUniqueToFieldNames</span></span><span> </span><span class="annot"><span class="annottext">Unique record
</span><a href="#local-6989586621679310154"><span class="hs-identifier hs-var">uniqueKey</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621679310163"><span class="annot"><span class="annottext">handler :: SqlBackend
-&gt; (EntityDef
    -&gt; NonEmpty (FieldNameHS, FieldNameDB) -&gt; Text -&gt; Text)
-&gt; ReaderT SqlBackend m (Entity record)
</span><a href="#local-6989586621679310163"><span class="hs-identifier hs-var hs-var">handler</span></a></span></span><span> </span><span id="local-6989586621679310177"><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679310177"><span class="hs-identifier hs-var">sqlB</span></a></span></span><span> </span><span id="local-6989586621679310178"><span class="annot"><span class="annottext">EntityDef -&gt; NonEmpty (FieldNameHS, FieldNameDB) -&gt; Text -&gt; Text
</span><a href="#local-6989586621679310178"><span class="hs-identifier hs-var">upsertSql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310179"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679310179"><span class="hs-identifier hs-var">updateText</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310180"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310180"><span class="hs-identifier hs-var">updateVals</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>                </span><span class="annot"><span class="annottext">SqlBackend -&gt; (Text, [PersistValue])
</span><a href="#local-6989586621679310171"><span class="hs-identifier hs-var">updatesText</span></a></span><span> </span><span class="annot"><span class="annottext">SqlBackend
</span><a href="#local-6989586621679310177"><span class="hs-identifier hs-var">sqlB</span></a></span><span>
</span><span id="line-236"></span><span>            </span><span id="local-6989586621679310181"><span class="annot"><span class="annottext">queryText :: Text
</span><a href="#local-6989586621679310181"><span class="hs-identifier hs-var hs-var">queryText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>                </span><span class="annot"><span class="annottext">EntityDef -&gt; NonEmpty (FieldNameHS, FieldNameDB) -&gt; Text -&gt; Text
</span><a href="#local-6989586621679310178"><span class="hs-identifier hs-var">upsertSql</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679310169"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (FieldNameHS, FieldNameDB)
</span><a href="#local-6989586621679310175"><span class="hs-identifier hs-var">uniqueFields</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679310179"><span class="hs-identifier hs-var">updateText</span></a></span><span>
</span><span id="line-238"></span><span>            </span><span id="local-6989586621679310182"><span class="annot"><span class="annottext">queryVals :: [PersistValue]
</span><a href="#local-6989586621679310182"><span class="hs-identifier hs-var hs-var">queryVals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>                </span><span class="annot"><span class="annottext">[PersistValue] -&gt; [PersistValue]
</span><a href="#local-6989586621679310164"><span class="hs-identifier hs-var">addVals</span></a></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310180"><span class="hs-identifier hs-var">updateVals</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span id="local-6989586621679310183"><span class="annot"><span class="annottext">[Entity record]
</span><a href="#local-6989586621679310183"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [PersistValue] -&gt; ReaderT SqlBackend m [Entity record]
forall a (m :: * -&gt; *) backend.
(RawSql a, MonadIO m, BackendCompatible SqlBackend backend) =&gt;
Text -&gt; [PersistValue] -&gt; ReaderT backend m [a]
</span><span class="hs-identifier hs-var">rawSql</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679310181"><span class="hs-identifier hs-var">queryText</span></a></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310182"><span class="hs-identifier hs-var">queryVals</span></a></span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">Entity record -&gt; ReaderT SqlBackend m (Entity record)
forall a. a -&gt; ReaderT SqlBackend m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Entity record] -&gt; Entity record
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Entity record]
</span><a href="#local-6989586621679310183"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">uDef</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toUniqueDef</span><span> </span><span class="hs-identifier">uniqueKey</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-identifier">handler</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">head</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">uncurry</span><span> </span><span class="hs-identifier">rawSql</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">(</span><span class="hs-operator">***</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">entDef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">uDef</span><span> </span><span class="hs-operator">:|</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">addVals</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">updatesText</span><span> </span><span class="hs-identifier">conn</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- | Inserts into a table the results of a query similar to 'insertSelect' but allows</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- to update values that violate a constraint during insertions.</span><span>
</span><span id="line-250"></span><span class="hs-comment">--</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- Example of usage:</span><span>
</span><span id="line-252"></span><span class="hs-comment">--</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- share [ mkPersist sqlSettings</span><span>
</span><span id="line-255"></span><span class="hs-comment">--       , mkDeleteCascade sqlSettings</span><span>
</span><span id="line-256"></span><span class="hs-comment">--       , mkMigrate &quot;migrate&quot;</span><span>
</span><span id="line-257"></span><span class="hs-comment">--       ] [persistLowerCase|</span><span>
</span><span id="line-258"></span><span class="hs-comment">--   Bar</span><span>
</span><span id="line-259"></span><span class="hs-comment">--     num Int</span><span>
</span><span id="line-260"></span><span class="hs-comment">--     deriving Eq Show</span><span>
</span><span id="line-261"></span><span class="hs-comment">--   Foo</span><span>
</span><span id="line-262"></span><span class="hs-comment">--     num Int</span><span>
</span><span id="line-263"></span><span class="hs-comment">--     UniqueFoo num</span><span>
</span><span id="line-264"></span><span class="hs-comment">--     deriving Eq Show</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- |]</span><span>
</span><span id="line-266"></span><span class="hs-comment">--</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- insertSelectWithConflict</span><span>
</span><span id="line-268"></span><span class="hs-comment">--   UniqueFoo -- (UniqueFoo undefined) or (UniqueFoo anyNumber) would also work</span><span>
</span><span id="line-269"></span><span class="hs-comment">--   (from $ \b -&gt;</span><span>
</span><span id="line-270"></span><span class="hs-comment">--     return $ Foo &lt;# (b ^. BarNum)</span><span>
</span><span id="line-271"></span><span class="hs-comment">--   )</span><span>
</span><span id="line-272"></span><span class="hs-comment">--   (\current excluded -&gt;</span><span>
</span><span id="line-273"></span><span class="hs-comment">--     [FooNum =. (current ^. FooNum) +. (excluded ^. FooNum)]</span><span>
</span><span id="line-274"></span><span class="hs-comment">--   )</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-276"></span><span class="hs-comment">--</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- Inserts to table Foo all Bar.num values and in case of conflict SomeFooUnique,</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- the conflicting value is updated to the current plus the excluded.</span><span>
</span><span id="line-279"></span><span class="hs-comment">--</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- @since 3.1.3</span><span>
</span><span id="line-281"></span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#insertSelectWithConflict"><span class="hs-identifier hs-type">insertSelectWithConflict</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679309846"><span class="annot"><a href="#local-6989586621679309846"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679309850"><span class="annot"><a href="#local-6989586621679309850"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679309849"><span class="annot"><a href="#local-6989586621679309849"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621679309851"><span class="annot"><a href="#local-6989586621679309851"><span class="hs-identifier hs-type">backend</span></a></span></span><span>
</span><span id="line-283"></span><span>     </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#FinalResult"><span class="hs-identifier hs-type">FinalResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309846"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#KnowResult"><span class="hs-identifier hs-type">KnowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309846"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unique</span></span><span> </span><span class="annot"><a href="#local-6989586621679309849"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679309850"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistEntity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309849"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackendCanWrite</span></span><span> </span><span class="annot"><a href="#local-6989586621679309851"><span class="hs-identifier hs-type">backend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679309846"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-comment">-- ^ Unique constructor or a unique, this is used just to get the name of</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-comment">-- the postgres constraint, the value(s) is(are) never used, so if you have</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-comment">-- a unique &quot;MyUnique 0&quot;, &quot;MyUnique undefined&quot; would work as well.</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlQuery"><span class="hs-identifier hs-type">SqlQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Insertion"><span class="hs-identifier hs-type">Insertion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309849"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Insert query.</span></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309849"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309849"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309849"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Update"><span class="hs-identifier hs-type">Update</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-comment">-- ^ A list of updates to be applied in case of the constraint being</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-comment">-- violated. The expression takes the current and excluded value to produce</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-comment">-- the updates.</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679309851"><span class="hs-identifier hs-type">backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309850"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span id="insertSelectWithConflict"><span class="annot"><span class="annottext">insertSelectWithConflict :: forall a (m :: * -&gt; *) val backend.
(FinalResult a, KnowResult a ~ Unique val, MonadIO m,
 PersistEntity val, SqlBackendCanWrite backend) =&gt;
a
-&gt; SqlQuery (SqlExpr (Insertion val))
-&gt; (SqlExpr (Entity val)
    -&gt; SqlExpr (Entity val)
    -&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update])
-&gt; ReaderT backend m ()
</span><a href="Database.Esqueleto.PostgreSQL.html#insertSelectWithConflict"><span class="hs-identifier hs-var hs-var">insertSelectWithConflict</span></a></span></span><span> </span><span id="local-6989586621679310205"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310205"><span class="hs-identifier hs-var">unique</span></a></span></span><span> </span><span id="local-6989586621679310206"><span class="annot"><span class="annottext">SqlQuery (SqlExpr (Insertion val))
</span><a href="#local-6989586621679310206"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span id="local-6989586621679310207"><span class="annot"><span class="annottext">SqlExpr (Entity val)
-&gt; SqlExpr (Entity val) -&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310207"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="annottext">ReaderT backend m Int64 -&gt; ReaderT backend m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(ReaderT backend m Int64 -&gt; ReaderT backend m ())
-&gt; ReaderT backend m Int64 -&gt; ReaderT backend m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
-&gt; SqlQuery (SqlExpr (Insertion val))
-&gt; (SqlExpr (Entity val)
    -&gt; SqlExpr (Entity val)
    -&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update])
-&gt; ReaderT backend m Int64
forall a val (m :: * -&gt; *) backend.
(FinalResult a, KnowResult a ~ Unique val, MonadIO m,
 PersistEntity val, SqlBackendCanWrite backend) =&gt;
a
-&gt; SqlQuery (SqlExpr (Insertion val))
-&gt; (SqlExpr (Entity val)
    -&gt; SqlExpr (Entity val)
    -&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update])
-&gt; ReaderT backend m Int64
</span><a href="Database.Esqueleto.PostgreSQL.html#insertSelectWithConflictCount"><span class="hs-identifier hs-var">insertSelectWithConflictCount</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310205"><span class="hs-identifier hs-var">unique</span></a></span><span> </span><span class="annot"><span class="annottext">SqlQuery (SqlExpr (Insertion val))
</span><a href="#local-6989586621679310206"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Entity val)
-&gt; SqlExpr (Entity val) -&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310207"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="hs-comment">-- | Same as 'insertSelectWithConflict' but returns the number of rows affected.</span><span>
</span><span id="line-299"></span><span class="hs-comment">--</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- @since 3.1.3</span><span>
</span><span id="line-301"></span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#insertSelectWithConflictCount"><span class="hs-identifier hs-type">insertSelectWithConflictCount</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679309863"><span class="annot"><a href="#local-6989586621679309863"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679309864"><span class="annot"><a href="#local-6989586621679309864"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621679309865"><span class="annot"><a href="#local-6989586621679309865"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679309866"><span class="annot"><a href="#local-6989586621679309866"><span class="hs-identifier hs-type">backend</span></a></span></span><span>
</span><span id="line-303"></span><span>     </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#FinalResult"><span class="hs-identifier hs-type">FinalResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309863"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#KnowResult"><span class="hs-identifier hs-type">KnowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309863"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Unique</span></span><span> </span><span class="annot"><a href="#local-6989586621679309864"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679309865"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PersistEntity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309864"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">SqlBackendCanWrite</span></span><span> </span><span class="annot"><a href="#local-6989586621679309866"><span class="hs-identifier hs-type">backend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679309863"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlQuery"><span class="hs-identifier hs-type">SqlQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Insertion"><span class="hs-identifier hs-type">Insertion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309864"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309864"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309864"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="annot"><a href="#local-6989586621679309864"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Update"><span class="hs-identifier hs-type">Update</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679309866"><span class="hs-identifier hs-type">backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309865"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span>
</span><span id="line-309"></span><span id="insertSelectWithConflictCount"><span class="annot"><span class="annottext">insertSelectWithConflictCount :: forall a val (m :: * -&gt; *) backend.
(FinalResult a, KnowResult a ~ Unique val, MonadIO m,
 PersistEntity val, SqlBackendCanWrite backend) =&gt;
a
-&gt; SqlQuery (SqlExpr (Insertion val))
-&gt; (SqlExpr (Entity val)
    -&gt; SqlExpr (Entity val)
    -&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update])
-&gt; ReaderT backend m Int64
</span><a href="Database.Esqueleto.PostgreSQL.html#insertSelectWithConflictCount"><span class="hs-identifier hs-var hs-var">insertSelectWithConflictCount</span></a></span></span><span> </span><span id="local-6989586621679310253"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310253"><span class="hs-identifier hs-var">unique</span></a></span></span><span> </span><span id="local-6989586621679310254"><span class="annot"><span class="annottext">SqlQuery (SqlExpr (Insertion val))
</span><a href="#local-6989586621679310254"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span id="local-6989586621679310255"><span class="annot"><span class="annottext">SqlExpr (Entity val)
-&gt; SqlExpr (Entity val) -&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310255"><span class="hs-identifier hs-var">conflictQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-310"></span><span>    </span><span id="local-6989586621679310256"><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679310256"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT backend m backend
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><span class="hs-identifier hs-var">R.ask</span></span><span>
</span><span id="line-311"></span><span>    </span><span class="annot"><span class="annottext">(Text -&gt; [PersistValue] -&gt; ReaderT backend m Int64)
-&gt; (Text, [PersistValue]) -&gt; ReaderT backend m Int64
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [PersistValue] -&gt; ReaderT backend m Int64
forall (m :: * -&gt; *) backend.
(MonadIO m, BackendCompatible SqlBackend backend) =&gt;
Text -&gt; [PersistValue] -&gt; ReaderT backend m Int64
</span><span class="hs-identifier hs-var">rawExecuteCount</span></span><span> </span><span class="annot"><span class="annottext">((Text, [PersistValue]) -&gt; ReaderT backend m Int64)
-&gt; (Text, [PersistValue]) -&gt; ReaderT backend m Int64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-312"></span><span>        </span><span class="annot"><span class="annottext">(Builder, [PersistValue])
-&gt; (Builder, [PersistValue]) -&gt; (Text, [PersistValue])
forall {a}. (Builder, [a]) -&gt; (Builder, [a]) -&gt; (Text, [a])
</span><a href="#local-6989586621679310259"><span class="hs-identifier hs-var">combine</span></a></span><span>
</span><span id="line-313"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mode
-&gt; (backend, IdentState)
-&gt; SqlQuery (SqlExpr (Insertion val))
-&gt; (Builder, [PersistValue])
forall a r backend.
(SqlSelect a r, BackendCompatible SqlBackend backend) =&gt;
Mode
-&gt; (backend, IdentState) -&gt; SqlQuery a -&gt; (Builder, [PersistValue])
</span><a href="Database.Esqueleto.Internal.Internal.html#toRawSql"><span class="hs-identifier hs-var">toRawSql</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="Database.Esqueleto.Internal.Internal.html#INSERT_INTO"><span class="hs-identifier hs-var">INSERT_INTO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679310256"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IdentState
</span><a href="Database.Esqueleto.Internal.Internal.html#initialIdentState"><span class="hs-identifier hs-var">initialIdentState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SqlQuery (SqlExpr (Insertion val))
</span><a href="#local-6989586621679310254"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">backend -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310263"><span class="hs-identifier hs-var">conflict</span></a></span><span> </span><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679310256"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="#local-6989586621679310264"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679309864"><span class="hs-identifier hs-type">val</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621679310264"><span class="annot"><span class="annottext">proxy :: Proxy val
</span><a href="#local-6989586621679310264"><span class="hs-identifier hs-var hs-var">proxy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy val
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621679310266"><span class="annot"><span class="annottext">updates :: [SqlExpr (Entity val) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310266"><span class="hs-identifier hs-var hs-var">updates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlExpr (Entity val)
-&gt; SqlExpr (Entity val) -&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310255"><span class="hs-identifier hs-var">conflictQuery</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Entity val)
</span><a href="#local-6989586621679310267"><span class="hs-identifier hs-var">entCurrent</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Entity val)
</span><a href="#local-6989586621679310268"><span class="hs-identifier hs-var">entExcluded</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621679310259"><span class="annot"><span class="annottext">combine :: (Builder, [a]) -&gt; (Builder, [a]) -&gt; (Text, [a])
</span><a href="#local-6989586621679310259"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310270"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310270"><span class="hs-identifier hs-var">tlb1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679310271"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679310271"><span class="hs-identifier hs-var">vals1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310272"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310272"><span class="hs-identifier hs-var">tlb2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679310273"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679310273"><span class="hs-identifier hs-var">vals2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><a href="Database.Esqueleto.Internal.Internal.html#builderToText"><span class="hs-identifier hs-var">builderToText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310270"><span class="hs-identifier hs-var">tlb1</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310272"><span class="hs-identifier hs-var">tlb2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679310271"><span class="hs-identifier hs-var">vals1</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679310273"><span class="hs-identifier hs-var">vals2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621679310268"><span class="annot"><span class="annottext">entExcluded :: SqlExpr (Entity val)
</span><a href="#local-6989586621679310268"><span class="hs-identifier hs-var hs-var">entExcluded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; SqlExpr (Entity val)
forall ent. PersistEntity ent =&gt; Ident -&gt; SqlExpr (Entity ent)
</span><a href="Database.Esqueleto.Internal.Internal.html#unsafeSqlEntity"><span class="hs-identifier hs-var">unsafeSqlEntity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Ident
</span><a href="Database.Esqueleto.Internal.Internal.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;excluded&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621679310295"><span class="annot"><span class="annottext">tableName :: proxy val -&gt; Text
</span><a href="#local-6989586621679310295"><span class="hs-identifier hs-var hs-var">tableName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><span class="hs-identifier hs-var">unEntityNameDB</span></span><span> </span><span class="annot"><span class="annottext">(EntityNameDB -&gt; Text)
-&gt; (proxy val -&gt; EntityNameDB) -&gt; proxy val -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><span class="hs-identifier hs-var">getEntityDBName</span></span><span> </span><span class="annot"><span class="annottext">(EntityDef -&gt; EntityNameDB)
-&gt; (proxy val -&gt; EntityDef) -&gt; proxy val -&gt; EntityNameDB
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">proxy val -&gt; EntityDef
forall record (proxy :: * -&gt; *).
PersistEntity record =&gt;
proxy record -&gt; EntityDef
forall (proxy :: * -&gt; *). proxy val -&gt; EntityDef
</span><span class="hs-identifier hs-var">entityDef</span></span><span>
</span><span id="line-322"></span><span>    </span><span id="local-6989586621679310267"><span class="annot"><span class="annottext">entCurrent :: SqlExpr (Entity val)
</span><a href="#local-6989586621679310267"><span class="hs-identifier hs-var hs-var">entCurrent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; SqlExpr (Entity val)
forall ent. PersistEntity ent =&gt; Ident -&gt; SqlExpr (Entity ent)
</span><a href="Database.Esqueleto.Internal.Internal.html#unsafeSqlEntity"><span class="hs-identifier hs-var">unsafeSqlEntity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Ident
</span><a href="Database.Esqueleto.Internal.Internal.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy val -&gt; Text
forall {proxy :: * -&gt; *}. proxy val -&gt; Text
</span><a href="#local-6989586621679310295"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy val
</span><a href="#local-6989586621679310264"><span class="hs-identifier hs-var">proxy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621679310299"><span class="annot"><span class="annottext">uniqueDef :: UniqueDef
</span><a href="#local-6989586621679310299"><span class="hs-identifier hs-var hs-var">uniqueDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; UniqueDef
forall a val.
(KnowResult a ~ Unique val, PersistEntity val, FinalResult a) =&gt;
a -&gt; UniqueDef
</span><a href="Database.Esqueleto.Internal.Internal.html#toUniqueDef"><span class="hs-identifier hs-var">toUniqueDef</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310253"><span class="hs-identifier hs-var">unique</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621679310301"><span class="annot"><span class="annottext">constraint :: Builder
</span><a href="#local-6989586621679310301"><span class="hs-identifier hs-var hs-var">constraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TLB.fromText</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Builder) -&gt; (UniqueDef -&gt; Text) -&gt; UniqueDef -&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB -&gt; Text
</span><span class="hs-identifier hs-var">unConstraintNameDB</span></span><span> </span><span class="annot"><span class="annottext">(ConstraintNameDB -&gt; Text)
-&gt; (UniqueDef -&gt; ConstraintNameDB) -&gt; UniqueDef -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UniqueDef -&gt; ConstraintNameDB
</span><span class="hs-identifier hs-var">uniqueDBName</span></span><span> </span><span class="annot"><span class="annottext">(UniqueDef -&gt; Builder) -&gt; UniqueDef -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UniqueDef
</span><a href="#local-6989586621679310299"><span class="hs-identifier hs-var">uniqueDef</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><a href="#local-6989586621679310305"><span class="hs-identifier hs-type">renderedUpdates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BackendCompatible</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SqlBackend</span></span><span> </span><span class="annot"><a href="#local-6989586621679309866"><span class="hs-identifier hs-type">backend</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679309866"><span class="hs-identifier hs-type">backend</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TLB.Builder</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PersistValue</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621679310305"><span class="annot"><span class="annottext">renderedUpdates :: BackendCompatible SqlBackend backend =&gt;
backend -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310305"><span class="hs-identifier hs-var hs-var">renderedUpdates</span></a></span></span><span> </span><span id="local-6989586621679310308"><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679310308"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">backend
-&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update]
-&gt; (Builder, [PersistValue])
forall backend val.
BackendCompatible SqlBackend backend =&gt;
backend
-&gt; [SqlExpr (Entity val) -&gt; SqlExpr Update]
-&gt; (Builder, [PersistValue])
</span><a href="Database.Esqueleto.Internal.Internal.html#renderUpdates"><span class="hs-identifier hs-var">renderUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679310308"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">[SqlExpr (Entity val) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310266"><span class="hs-identifier hs-var">updates</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679310263"><span class="annot"><span class="annottext">conflict :: backend -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310263"><span class="hs-identifier hs-var hs-var">conflict</span></a></span></span><span> </span><span id="local-6989586621679310309"><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679310309"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Builder] -&gt; Builder
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TLB.fromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ON CONFLICT ON CONSTRAINT \&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310301"><span class="hs-identifier hs-var">constraint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TLB.fromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot; DO &quot;</span></span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Builder] -&gt; [Builder] -&gt; [Builder]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[SqlExpr (Entity val) -&gt; SqlExpr Update] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[SqlExpr (Entity val) -&gt; SqlExpr Update]
</span><a href="#local-6989586621679310266"><span class="hs-identifier hs-var">updates</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TLB.fromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;NOTHING&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TLB.fromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;UPDATE SET &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310311"><span class="hs-identifier hs-var">updatesTLB</span></a></span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310312"><span class="hs-identifier hs-var">values'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679310311"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310311"><span class="hs-identifier hs-var">updatesTLB</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679310312"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310312"><span class="hs-identifier hs-var">values'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">backend -&gt; (Builder, [PersistValue])
BackendCompatible SqlBackend backend =&gt;
backend -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310305"><span class="hs-identifier hs-var">renderedUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">backend
</span><a href="#local-6989586621679310309"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="hs-comment">-- | Allow aggregate functions to take a filter clause.</span><span>
</span><span id="line-339"></span><span class="hs-comment">--</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- Example of usage:</span><span>
</span><span id="line-341"></span><span class="hs-comment">--</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- share [mkPersist sqlSettings] [persistLowerCase|</span><span>
</span><span id="line-344"></span><span class="hs-comment">--   User</span><span>
</span><span id="line-345"></span><span class="hs-comment">--     name Text</span><span>
</span><span id="line-346"></span><span class="hs-comment">--     deriving Eq Show</span><span>
</span><span id="line-347"></span><span class="hs-comment">--   Task</span><span>
</span><span id="line-348"></span><span class="hs-comment">--     userId UserId</span><span>
</span><span id="line-349"></span><span class="hs-comment">--     completed Bool</span><span>
</span><span id="line-350"></span><span class="hs-comment">--     deriving Eq Show</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- |]</span><span>
</span><span id="line-352"></span><span class="hs-comment">--</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- select $ from $ \(users `InnerJoin` tasks) -&gt; do</span><span>
</span><span id="line-354"></span><span class="hs-comment">--   on $ users ^. UserId ==. tasks ^. TaskUserId</span><span>
</span><span id="line-355"></span><span class="hs-comment">--   groupBy $ users ^. UserId</span><span>
</span><span id="line-356"></span><span class="hs-comment">--   return</span><span>
</span><span id="line-357"></span><span class="hs-comment">--    ( users ^. UserId</span><span>
</span><span id="line-358"></span><span class="hs-comment">--    , count (tasks ^. TaskId) `filterWhere` (tasks ^. TaskCompleted ==. val True)</span><span>
</span><span id="line-359"></span><span class="hs-comment">--    , count (tasks ^. TaskId) `filterWhere` (tasks ^. TaskCompleted ==. val False)</span><span>
</span><span id="line-360"></span><span class="hs-comment">--    )</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-362"></span><span class="hs-comment">--</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- @since 3.3.3.3</span><span>
</span><span id="line-364"></span><span id="local-6989586621679309907"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#filterWhere"><span class="hs-identifier hs-type">filterWhere</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309907"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Aggregate function</span></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Filter clause</span></span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlExpr"><span class="hs-identifier hs-type">SqlExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309907"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-370"></span><span id="filterWhere"><span class="annot"><span class="annottext">filterWhere :: forall a.
SqlExpr (Value a) -&gt; SqlExpr (Value Bool) -&gt; SqlExpr (Value a)
</span><a href="Database.Esqueleto.PostgreSQL.html#filterWhere"><span class="hs-identifier hs-var hs-var">filterWhere</span></a></span></span><span> </span><span id="local-6989586621679310321"><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310321"><span class="hs-identifier hs-var">aggExpr</span></a></span></span><span> </span><span id="local-6989586621679310322"><span class="annot"><span class="annottext">SqlExpr (Value Bool)
</span><a href="#local-6989586621679310322"><span class="hs-identifier hs-var">clauseExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlExprMeta
-&gt; (NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; SqlExpr (Value a)
forall a.
SqlExprMeta
-&gt; (NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; SqlExpr a
</span><a href="Database.Esqueleto.Internal.Internal.html#ERaw"><span class="hs-identifier hs-var">ERaw</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExprMeta
</span><a href="Database.Esqueleto.Internal.Internal.html#noMeta"><span class="hs-identifier hs-var">noMeta</span></a></span><span> </span><span class="annot"><span class="annottext">((NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
 -&gt; SqlExpr (Value a))
-&gt; (NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; SqlExpr (Value a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">NeedParens
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679310323"><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310323"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679310324"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310324"><span class="hs-identifier hs-var">aggBuilder</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310325"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310325"><span class="hs-identifier hs-var">aggValues</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310321"><span class="hs-identifier hs-var">aggExpr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-372"></span><span>            </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#ERaw"><span class="hs-identifier hs-type">ERaw</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExprMeta
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679310326"><span class="annot"><span class="annottext">NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310326"><span class="hs-identifier hs-var">aggF</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310326"><span class="hs-identifier hs-var">aggF</span></a></span><span> </span><span class="annot"><span class="annottext">NeedParens
</span><a href="Database.Esqueleto.Internal.Internal.html#Never"><span class="hs-identifier hs-var">Never</span></a></span><span> </span><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310323"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679310327"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310327"><span class="hs-identifier hs-var">clauseBuilder</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310328"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310328"><span class="hs-identifier hs-var">clauseValues</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value Bool)
</span><a href="#local-6989586621679310322"><span class="hs-identifier hs-var">clauseExpr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#ERaw"><span class="hs-identifier hs-type">ERaw</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExprMeta
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679310329"><span class="annot"><span class="annottext">NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310329"><span class="hs-identifier hs-var">clauseF</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310329"><span class="hs-identifier hs-var">clauseF</span></a></span><span> </span><span class="annot"><span class="annottext">NeedParens
</span><a href="Database.Esqueleto.Internal.Internal.html#Never"><span class="hs-identifier hs-var">Never</span></a></span><span> </span><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310323"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310324"><span class="hs-identifier hs-var">aggBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; FILTER (WHERE &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679310327"><span class="hs-identifier hs-var">clauseBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-376"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310325"><span class="hs-identifier hs-var">aggValues</span></a></span><span> </span><span class="annot"><span class="annottext">[PersistValue] -&gt; [PersistValue] -&gt; [PersistValue]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310328"><span class="hs-identifier hs-var">clauseValues</span></a></span><span>
</span><span id="line-377"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="hs-comment">-- | Allows to use `VALUES (..)` in-memory set of values</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- in RHS of `from` expressions. Useful for JOIN's on</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- known values which also can be additionally preprocessed</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- somehow on db side with usage of inner PostgreSQL capabilities.</span><span>
</span><span id="line-384"></span><span class="hs-comment">--</span><span>
</span><span id="line-385"></span><span class="hs-comment">--</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- Example of usage:</span><span>
</span><span id="line-387"></span><span class="hs-comment">--</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- share [mkPersist sqlSettings] [persistLowerCase|</span><span>
</span><span id="line-390"></span><span class="hs-comment">--   User</span><span>
</span><span id="line-391"></span><span class="hs-comment">--     name Text</span><span>
</span><span id="line-392"></span><span class="hs-comment">--     age Int</span><span>
</span><span id="line-393"></span><span class="hs-comment">--     deriving Eq Show</span><span>
</span><span id="line-394"></span><span class="hs-comment">--</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- select $ do</span><span>
</span><span id="line-396"></span><span class="hs-comment">--  bound :&amp; user &lt;- from $</span><span>
</span><span id="line-397"></span><span class="hs-comment">--      values (   (val (10 :: Int), val (&quot;ten&quot; :: Text))</span><span>
</span><span id="line-398"></span><span class="hs-comment">--            :| [ (val 20, val &quot;twenty&quot;)</span><span>
</span><span id="line-399"></span><span class="hs-comment">--               , (val 30, val &quot;thirty&quot;) ]</span><span>
</span><span id="line-400"></span><span class="hs-comment">--            )</span><span>
</span><span id="line-401"></span><span class="hs-comment">--      `InnerJoin` table User</span><span>
</span><span id="line-402"></span><span class="hs-comment">--      `on` (\((bound, _boundName) :&amp; user) -&gt; user^.UserAge &gt;=. bound)</span><span>
</span><span id="line-403"></span><span class="hs-comment">--  groupBy bound</span><span>
</span><span id="line-404"></span><span class="hs-comment">--  pure (bound, count @Int $ user^.UserName)</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-406"></span><span class="hs-comment">--</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- @since 3.5.2.3</span><span>
</span><span id="line-408"></span><span id="local-6989586621679309909"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#values"><span class="hs-identifier hs-type">values</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#ToSomeValues"><span class="hs-identifier hs-type">ToSomeValues</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309909"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.Experimental.ToAliasReference.html#ToAliasReference"><span class="hs-identifier hs-type">Ex.ToAliasReference</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309909"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Esqueleto.Experimental.ToAlias.html#ToAlias"><span class="hs-identifier hs-type">Ex.ToAlias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309909"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679309909"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Experimental.From.html#From"><span class="hs-identifier hs-type">Ex.From</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309909"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-409"></span><span id="values"><span class="annot"><span class="annottext">values :: forall a.
(ToSomeValues a, ToAliasReference a, ToAlias a) =&gt;
NonEmpty a -&gt; From a
</span><a href="Database.Esqueleto.PostgreSQL.html#values"><span class="hs-identifier hs-var hs-var">values</span></a></span></span><span> </span><span id="local-6989586621679310371"><span class="annot"><span class="annottext">NonEmpty a
</span><a href="#local-6989586621679310371"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlQuery (a, NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; From a
forall a.
SqlQuery (a, NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; From a
</span><a href="Database.Esqueleto.Experimental.From.html#From"><span class="hs-identifier hs-var">Ex.From</span></a></span><span> </span><span class="annot"><span class="annottext">(SqlQuery (a, NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
 -&gt; From a)
-&gt; SqlQuery
     (a, NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; From a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621679310373"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679310373"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DBName -&gt; SqlQuery Ident
</span><a href="Database.Esqueleto.Internal.Internal.html#newIdentFor"><span class="hs-identifier hs-var">newIdentFor</span></a></span><span> </span><span class="annot"><span class="annottext">(DBName -&gt; SqlQuery Ident) -&gt; DBName -&gt; SqlQuery Ident
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; DBName
</span><a href="Database.Esqueleto.Internal.Internal.html#DBName"><span class="hs-identifier hs-var">DBName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;vq&quot;</span></span><span>
</span><span id="line-411"></span><span>    </span><span id="local-6989586621679310376"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310376"><span class="hs-identifier hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; SqlQuery a
forall a. ToAlias a =&gt; a -&gt; SqlQuery a
</span><a href="Database.Esqueleto.Experimental.ToAlias.html#toAlias"><span class="hs-identifier hs-var">Ex.toAlias</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; SqlQuery a) -&gt; a -&gt; SqlQuery a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty a -&gt; a
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">NE.head</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty a
</span><a href="#local-6989586621679310371"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span id="local-6989586621679310379"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310379"><span class="hs-identifier hs-var">ref</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ident -&gt; a -&gt; SqlQuery a
forall a. ToAliasReference a =&gt; Ident -&gt; a -&gt; SqlQuery a
</span><a href="Database.Esqueleto.Experimental.ToAliasReference.html#toAliasReference"><span class="hs-identifier hs-var">Ex.toAliasReference</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679310373"><span class="hs-identifier hs-var">ident</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310376"><span class="hs-identifier hs-var">alias</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679310381"><span class="annot"><span class="annottext">aliasIdents :: [Ident]
</span><a href="#local-6989586621679310381"><span class="hs-identifier hs-var hs-var">aliasIdents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeValue -&gt; Maybe Ident) -&gt; [SomeValue] -&gt; [Ident]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679310383"><span class="annot"><span class="annottext">SomeValue
</span><a href="#local-6989586621679310383"><span class="hs-identifier hs-var">someVal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeValue
</span><a href="#local-6989586621679310383"><span class="hs-identifier hs-var">someVal</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-414"></span><span>            </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SomeValue"><span class="hs-identifier hs-type">SomeValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#ERaw"><span class="hs-identifier hs-type">ERaw</span></a></span><span> </span><span id="local-6989586621679310385"><span class="annot"><span class="annottext">SqlExprMeta
</span><a href="#local-6989586621679310385"><span class="hs-identifier hs-var">aliasMeta</span></a></span></span><span> </span><span class="annot"><span class="annottext">NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue])
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SqlExprMeta -&gt; Maybe Ident
</span><a href="Database.Esqueleto.Internal.Internal.html#sqlExprMetaAlias"><span class="hs-identifier hs-var">sqlExprMetaAlias</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExprMeta
</span><a href="#local-6989586621679310385"><span class="hs-identifier hs-var">aliasMeta</span></a></span><span>
</span><span id="line-415"></span><span>            </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SomeValue] -&gt; [Ident]) -&gt; [SomeValue] -&gt; [Ident]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [SomeValue]
forall a. ToSomeValues a =&gt; a -&gt; [SomeValue]
</span><a href="Database.Esqueleto.Internal.Internal.html#toSomeValues"><span class="hs-identifier hs-var">toSomeValues</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310379"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><span class="annottext">(a, NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; SqlQuery
     (a, NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
forall a. a -&gt; SqlQuery a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310379"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue])
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">((IdentInfo -&gt; (Builder, [PersistValue]))
 -&gt; NeedParens -&gt; IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; (IdentInfo -&gt; (Builder, [PersistValue]))
-&gt; NeedParens
-&gt; IdentInfo
-&gt; (Builder, [PersistValue])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; [Ident] -&gt; IdentInfo -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310389"><span class="hs-identifier hs-var">mkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679310373"><span class="hs-identifier hs-var">ident</span></a></span><span> </span><span class="annot"><span class="annottext">[Ident]
</span><a href="#local-6989586621679310381"><span class="hs-identifier hs-var">aliasIdents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><a href="#local-6989586621679310390"><span class="hs-identifier hs-type">someValueToSql</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#IdentInfo"><span class="hs-identifier hs-type">IdentInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SomeValue"><span class="hs-identifier hs-type">SomeValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TLB.Builder</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PersistValue</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>    </span><span id="local-6989586621679310390"><span class="annot"><span class="annottext">someValueToSql :: IdentInfo -&gt; SomeValue -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310390"><span class="hs-identifier hs-var hs-var">someValueToSql</span></a></span></span><span> </span><span id="local-6989586621679310391"><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310391"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SomeValue"><span class="hs-identifier hs-type">SomeValue</span></a></span><span> </span><span id="local-6989586621679310392"><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310392"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdentInfo -&gt; SqlExpr (Value a) -&gt; (Builder, [PersistValue])
forall a.
IdentInfo -&gt; SqlExpr (Value a) -&gt; (Builder, [PersistValue])
</span><a href="Database.Esqueleto.Internal.Internal.html#materializeExpr"><span class="hs-identifier hs-var">materializeExpr</span></a></span><span> </span><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310391"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExpr (Value a)
</span><a href="#local-6989586621679310392"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><a href="#local-6989586621679310394"><span class="hs-identifier hs-type">mkValuesRowSql</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#IdentInfo"><span class="hs-identifier hs-type">IdentInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SomeValue"><span class="hs-identifier hs-type">SomeValue</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TLB.Builder</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PersistValue</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>    </span><span id="local-6989586621679310394"><span class="annot"><span class="annottext">mkValuesRowSql :: IdentInfo -&gt; [SomeValue] -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310394"><span class="hs-identifier hs-var hs-var">mkValuesRowSql</span></a></span></span><span> </span><span id="local-6989586621679310395"><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310395"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621679310396"><span class="annot"><span class="annottext">[SomeValue]
</span><a href="#local-6989586621679310396"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679310397"><span class="annot"><span class="annottext">materialized :: [(Builder, [PersistValue])]
</span><a href="#local-6989586621679310397"><span class="hs-identifier hs-var hs-var">materialized</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdentInfo -&gt; SomeValue -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310390"><span class="hs-identifier hs-var">someValueToSql</span></a></span><span> </span><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310395"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeValue -&gt; (Builder, [PersistValue]))
-&gt; [SomeValue] -&gt; [(Builder, [PersistValue])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SomeValue]
</span><a href="#local-6989586621679310396"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-424"></span><span>            </span><span id="local-6989586621679310399"><span class="annot"><span class="annottext">valsSql :: [Text]
</span><a href="#local-6989586621679310399"><span class="hs-identifier hs-var hs-var">valsSql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><span class="hs-identifier hs-var">TLB.toLazyText</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Text)
-&gt; ((Builder, [PersistValue]) -&gt; Builder)
-&gt; (Builder, [PersistValue])
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Builder, [PersistValue]) -&gt; Builder
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Builder, [PersistValue]) -&gt; Text)
-&gt; [(Builder, [PersistValue])] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Builder, [PersistValue])]
</span><a href="#local-6989586621679310397"><span class="hs-identifier hs-var">materialized</span></a></span><span>
</span><span id="line-425"></span><span>            </span><span id="local-6989586621679310402"><span class="annot"><span class="annottext">params :: [PersistValue]
</span><a href="#local-6989586621679310402"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Builder, [PersistValue]) -&gt; [PersistValue])
-&gt; [(Builder, [PersistValue])] -&gt; [PersistValue]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(Builder, [PersistValue]) -&gt; [PersistValue]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Builder, [PersistValue])]
</span><a href="#local-6989586621679310397"><span class="hs-identifier hs-var">materialized</span></a></span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TLB.fromLazyText</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Builder) -&gt; Text -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">TL.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679310399"><span class="hs-identifier hs-var">valsSql</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310402"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-comment">-- (VALUES (v11, v12,..), (v21, v22,..)) as &quot;vq&quot;(&quot;v1&quot;, &quot;v2&quot;,..)</span><span>
</span><span id="line-429"></span><span>    </span><span class="annot"><a href="#local-6989586621679310389"><span class="hs-identifier hs-type">mkExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#IdentInfo"><span class="hs-identifier hs-type">IdentInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TLB.Builder</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PersistValue</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621679310389"><span class="annot"><span class="annottext">mkExpr :: Ident -&gt; [Ident] -&gt; IdentInfo -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310389"><span class="hs-identifier hs-var hs-var">mkExpr</span></a></span></span><span> </span><span id="local-6989586621679310407"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679310407"><span class="hs-identifier hs-var">valsIdent</span></a></span></span><span> </span><span id="local-6989586621679310408"><span class="annot"><span class="annottext">[Ident]
</span><a href="#local-6989586621679310408"><span class="hs-identifier hs-var">colIdents</span></a></span></span><span> </span><span id="local-6989586621679310409"><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310409"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-431"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679310410"><span class="annot"><span class="annottext">materialized :: [(Builder, [PersistValue])]
</span><a href="#local-6989586621679310410"><span class="hs-identifier hs-var hs-var">materialized</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdentInfo -&gt; [SomeValue] -&gt; (Builder, [PersistValue])
</span><a href="#local-6989586621679310394"><span class="hs-identifier hs-var">mkValuesRowSql</span></a></span><span> </span><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310409"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">([SomeValue] -&gt; (Builder, [PersistValue]))
-&gt; (a -&gt; [SomeValue]) -&gt; a -&gt; (Builder, [PersistValue])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [SomeValue]
forall a. ToSomeValues a =&gt; a -&gt; [SomeValue]
</span><a href="Database.Esqueleto.Internal.Internal.html#toSomeValues"><span class="hs-identifier hs-var">toSomeValues</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; (Builder, [PersistValue]))
-&gt; [a] -&gt; [(Builder, [PersistValue])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty a -&gt; [a]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NE.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty a
</span><a href="#local-6989586621679310371"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-432"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679310412"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679310412"><span class="hs-identifier hs-var">valsSql</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679310413"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310413"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-433"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">TL.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Builder, [PersistValue]) -&gt; Text)
-&gt; [(Builder, [PersistValue])] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><span class="hs-identifier hs-var">TLB.toLazyText</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Text)
-&gt; ((Builder, [PersistValue]) -&gt; Builder)
-&gt; (Builder, [PersistValue])
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Builder, [PersistValue]) -&gt; Builder
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Builder, [PersistValue])]
</span><a href="#local-6989586621679310410"><span class="hs-identifier hs-var">materialized</span></a></span><span>
</span><span id="line-434"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((Builder, [PersistValue]) -&gt; [PersistValue])
-&gt; [(Builder, [PersistValue])] -&gt; [PersistValue]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(Builder, [PersistValue]) -&gt; [PersistValue]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Builder, [PersistValue])]
</span><a href="#local-6989586621679310410"><span class="hs-identifier hs-var">materialized</span></a></span><span>
</span><span id="line-435"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>            </span><span id="local-6989586621679310414"><span class="annot"><span class="annottext">colsAliases :: Text
</span><a href="#local-6989586621679310414"><span class="hs-identifier hs-var hs-var">colsAliases</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">TL.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ident -&gt; Text) -&gt; [Ident] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><span class="hs-identifier hs-var">TLB.toLazyText</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Text) -&gt; (Ident -&gt; Builder) -&gt; Ident -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IdentInfo -&gt; Ident -&gt; Builder
</span><a href="Database.Esqueleto.Internal.Internal.html#useIdent"><span class="hs-identifier hs-var">useIdent</span></a></span><span> </span><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310409"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ident]
</span><a href="#local-6989586621679310408"><span class="hs-identifier hs-var">colIdents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-438"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;(VALUES &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TLB.fromLazyText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679310412"><span class="hs-identifier hs-var">valsSql</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;) AS &quot;</span></span><span>
</span><span id="line-439"></span><span>            </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IdentInfo -&gt; Ident -&gt; Builder
</span><a href="Database.Esqueleto.Internal.Internal.html#useIdent"><span class="hs-identifier hs-var">useIdent</span></a></span><span> </span><span class="annot"><span class="annottext">IdentInfo
</span><a href="#local-6989586621679310409"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621679310407"><span class="hs-identifier hs-var">valsIdent</span></a></span><span>
</span><span id="line-440"></span><span>            </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;(&quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><span class="hs-identifier hs-var">TLB.fromLazyText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679310414"><span class="hs-identifier hs-var">colsAliases</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-441"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679310413"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-442"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-comment">-- | `NOWAIT` syntax for postgres locking</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- error will be thrown if locked rows are attempted to be selected</span><span>
</span><span id="line-446"></span><span class="hs-comment">--</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- @since 3.5.9.0</span><span>
</span><span id="line-448"></span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#noWait"><span class="hs-identifier hs-type">noWait</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#OnLockedBehavior"><span class="hs-identifier hs-type">OnLockedBehavior</span></a></span><span>
</span><span id="line-449"></span><span id="noWait"><span class="annot"><span class="annottext">noWait :: OnLockedBehavior
</span><a href="Database.Esqueleto.PostgreSQL.html#noWait"><span class="hs-identifier hs-var hs-var">noWait</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OnLockedBehavior
</span><a href="Database.Esqueleto.Internal.Internal.html#NoWait"><span class="hs-identifier hs-var">NoWait</span></a></span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span class="hs-comment">-- | `SKIP LOCKED` syntax for postgres locking</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- locked rows will be skipped</span><span>
</span><span id="line-453"></span><span class="hs-comment">--</span><span>
</span><span id="line-454"></span><span class="hs-comment">-- @since 3.5.9.0</span><span>
</span><span id="line-455"></span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#skipLocked"><span class="hs-identifier hs-type">skipLocked</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#OnLockedBehavior"><span class="hs-identifier hs-type">OnLockedBehavior</span></a></span><span>
</span><span id="line-456"></span><span id="skipLocked"><span class="annot"><span class="annottext">skipLocked :: OnLockedBehavior
</span><a href="Database.Esqueleto.PostgreSQL.html#skipLocked"><span class="hs-identifier hs-var hs-var">skipLocked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OnLockedBehavior
</span><a href="Database.Esqueleto.Internal.Internal.html#SkipLocked"><span class="hs-identifier hs-var">SkipLocked</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">-- | default behaviour of postgres locks. will attempt to wait for locks to expire</span><span>
</span><span id="line-459"></span><span class="hs-comment">--</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- @since 3.5.9.0</span><span>
</span><span id="line-461"></span><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#wait"><span class="hs-identifier hs-type">wait</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#OnLockedBehavior"><span class="hs-identifier hs-type">OnLockedBehavior</span></a></span><span>
</span><span id="line-462"></span><span id="wait"><span class="annot"><span class="annottext">wait :: OnLockedBehavior
</span><a href="Database.Esqueleto.PostgreSQL.html#wait"><span class="hs-identifier hs-var hs-var">wait</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OnLockedBehavior
</span><a href="Database.Esqueleto.Internal.Internal.html#Wait"><span class="hs-identifier hs-var">Wait</span></a></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="hs-comment">-- | `FOR UPDATE OF` syntax for postgres locking</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- allows locking of specific tables with an update lock in a view or join</span><span>
</span><span id="line-466"></span><span class="hs-comment">--</span><span>
</span><span id="line-467"></span><span class="hs-comment">-- @since 3.5.9.0</span><span>
</span><span id="line-468"></span><span id="local-6989586621679309942"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#forUpdateOf"><span class="hs-identifier hs-type">forUpdateOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#LockableEntity"><span class="hs-identifier hs-type">LockableEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679309942"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679309942"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#OnLockedBehavior"><span class="hs-identifier hs-type">OnLockedBehavior</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlQuery"><span class="hs-identifier hs-type">SqlQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-469"></span><span id="forUpdateOf"><span class="annot"><span class="annottext">forUpdateOf :: forall a. LockableEntity a =&gt; a -&gt; OnLockedBehavior -&gt; SqlQuery ()
</span><a href="Database.Esqueleto.PostgreSQL.html#forUpdateOf"><span class="hs-identifier hs-var hs-var">forUpdateOf</span></a></span></span><span> </span><span id="local-6989586621679310421"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310421"><span class="hs-identifier hs-var">lockableEntities</span></a></span></span><span> </span><span id="local-6989586621679310422"><span class="annot"><span class="annottext">OnLockedBehavior
</span><a href="#local-6989586621679310422"><span class="hs-identifier hs-var">onLockedBehavior</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-470"></span><span>  </span><span class="annot"><span class="annottext">LockingClause -&gt; SqlQuery ()
</span><a href="Database.Esqueleto.Internal.Internal.html#putLocking"><span class="hs-identifier hs-var">putLocking</span></a></span><span> </span><span class="annot"><span class="annottext">(LockingClause -&gt; SqlQuery ()) -&gt; LockingClause -&gt; SqlQuery ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PostgresLockingKind] -&gt; LockingClause
</span><a href="Database.Esqueleto.Internal.Internal.html#PostgresLockingClauses"><span class="hs-identifier hs-var">PostgresLockingClauses</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PostgresRowLevelLockStrength
-&gt; Maybe LockingOfClause -&gt; OnLockedBehavior -&gt; PostgresLockingKind
</span><a href="Database.Esqueleto.Internal.Internal.html#PostgresLockingKind"><span class="hs-identifier hs-var">PostgresLockingKind</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresRowLevelLockStrength
</span><a href="Database.Esqueleto.Internal.Internal.html#PostgresForUpdate"><span class="hs-identifier hs-var">PostgresForUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockingOfClause -&gt; Maybe LockingOfClause
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(LockingOfClause -&gt; Maybe LockingOfClause)
-&gt; LockingOfClause -&gt; Maybe LockingOfClause
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; LockingOfClause
forall a. LockableEntity a =&gt; a -&gt; LockingOfClause
</span><a href="Database.Esqueleto.Internal.Internal.html#LockingOfClause"><span class="hs-identifier hs-var">LockingOfClause</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310421"><span class="hs-identifier hs-var">lockableEntities</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OnLockedBehavior
</span><a href="#local-6989586621679310422"><span class="hs-identifier hs-var">onLockedBehavior</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="hs-comment">-- | `FOR SHARE OF` syntax for postgres locking</span><span>
</span><span id="line-473"></span><span class="hs-comment">-- allows locking of specific tables with a share lock in a view or join</span><span>
</span><span id="line-474"></span><span class="hs-comment">--</span><span>
</span><span id="line-475"></span><span class="hs-comment">-- @since 3.5.9.0</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span id="local-6989586621679310428"><span class="annot"><a href="Database.Esqueleto.PostgreSQL.html#forShareOf"><span class="hs-identifier hs-type">forShareOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#LockableEntity"><span class="hs-identifier hs-type">LockableEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679310428"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679310428"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#OnLockedBehavior"><span class="hs-identifier hs-type">OnLockedBehavior</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Esqueleto.Internal.Internal.html#SqlQuery"><span class="hs-identifier hs-type">SqlQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-478"></span><span id="forShareOf"><span class="annot"><span class="annottext">forShareOf :: forall a. LockableEntity a =&gt; a -&gt; OnLockedBehavior -&gt; SqlQuery ()
</span><a href="Database.Esqueleto.PostgreSQL.html#forShareOf"><span class="hs-identifier hs-var hs-var">forShareOf</span></a></span></span><span> </span><span id="local-6989586621679310431"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310431"><span class="hs-identifier hs-var">lockableEntities</span></a></span></span><span> </span><span id="local-6989586621679310432"><span class="annot"><span class="annottext">OnLockedBehavior
</span><a href="#local-6989586621679310432"><span class="hs-identifier hs-var">onLockedBehavior</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-479"></span><span>  </span><span class="annot"><span class="annottext">LockingClause -&gt; SqlQuery ()
</span><a href="Database.Esqueleto.Internal.Internal.html#putLocking"><span class="hs-identifier hs-var">putLocking</span></a></span><span> </span><span class="annot"><span class="annottext">(LockingClause -&gt; SqlQuery ()) -&gt; LockingClause -&gt; SqlQuery ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PostgresLockingKind] -&gt; LockingClause
</span><a href="Database.Esqueleto.Internal.Internal.html#PostgresLockingClauses"><span class="hs-identifier hs-var">PostgresLockingClauses</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PostgresRowLevelLockStrength
-&gt; Maybe LockingOfClause -&gt; OnLockedBehavior -&gt; PostgresLockingKind
</span><a href="Database.Esqueleto.Internal.Internal.html#PostgresLockingKind"><span class="hs-identifier hs-var">PostgresLockingKind</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresRowLevelLockStrength
</span><a href="Database.Esqueleto.Internal.Internal.html#PostgresForShare"><span class="hs-identifier hs-var">PostgresForShare</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockingOfClause -&gt; Maybe LockingOfClause
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(LockingOfClause -&gt; Maybe LockingOfClause)
-&gt; LockingOfClause -&gt; Maybe LockingOfClause
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; LockingOfClause
forall a. LockableEntity a =&gt; a -&gt; LockingOfClause
</span><a href="Database.Esqueleto.Internal.Internal.html#LockingOfClause"><span class="hs-identifier hs-var">LockingOfClause</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679310431"><span class="hs-identifier hs-var">lockableEntities</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OnLockedBehavior
</span><a href="#local-6989586621679310432"><span class="hs-identifier hs-var">onLockedBehavior</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-480"></span></pre></body></html>